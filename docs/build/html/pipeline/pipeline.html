<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DCML Corpus Creation Pipeline &#8212; Harmonic Annotation Guidelines 2.3.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=9afac83c" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <script src="../_static/documentation_options.js?v=c3c8ae58"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>let toggleHintShow = 'Show answer';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DCML Score Conventions" href="../scores/guidelines.html" />
    <link rel="prev" title="Quick Git Reference" href="../git/git.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          DCML Guidelines</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Other pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../onboarding.html">Becoming a DCML annotator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#working-as-an-annotator">Working as an annotator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#how-to-get-involved">How to get involved</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../workflow/workflow.html">DCML annotation workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#short-summary">Short summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#annotating">Annotating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#upgrading-annotations">Upgrading annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#reviewing-a-set-of-annotations">Reviewing a set of annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#reacting-to-a-review-reaching-expert-consensus">Reacting to a review &amp; reaching expert consensus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#what-to-do-about-the-warnings">What to do about the warnings?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../openproject/openproject.html">Work package management with OpenProject</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#user-interface">User Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#work-packages-wps">Work Packages (WPs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#taking-on-an-assignment">Taking on an assignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#logging-unit-costs">Logging unit costs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#writing-invoices">Writing invoices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Annotation Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/musescore.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/first_label.html">The first label</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/first_phrase.html">The first phrase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/detail.html">Level of detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/localkey.html">Changing the local key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/counterpoint.html">Contrapuntal patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/features.html">Some more features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../git/git.html">Quick Git Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#installing-git">Installing Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#configuring-git">Configuring Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#cloning-a-repository-from-github">Cloning a Repository from GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#selecting-the-right-branch">Selecting the right Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#applying-changes-to-the-repository">Applying Changes to the Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#uploading-changes-to-github">Uploading Changes to GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#applying-changes-to-the-origin-directly">Applying Changes to the Origin Directly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#creating-a-github-account">Creating a GitHub account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#github-desktop">GitHub Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#installing-github-desktop">Installing GitHub Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#first-start">First start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#cloning-a-repository">Cloning a repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#the-user-interface">The user interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#typical-mistakes">Typical Mistakes</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DCML Corpus Creation Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">Collect and prepare the digital edition in the latest MuseScore format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files">Creating a repository with unannotated MuseScore files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-and-adding-the-new-repo">Configuring and adding the new repo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#curating-and-enriching-metadata">Curating and enriching metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#finalizing-a-repository-for-publication">Finalizing a repository for publication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../scores/guidelines.html">DCML Score Conventions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../scores/guidelines.html#dividing-a-score-into-separate-files">Dividing a Score into separate files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scores/guidelines.html#glossary-terminology">Glossary, Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scores/guidelines.html#score-elements">Score Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scores/guidelines.html#early-music">Early Music</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scores/guidelines.html#corrections-to-automate">Corrections to automate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Annotation Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#the-syntax">The syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#the-remainder-of-the-reference-is-currently-under-reconstruction">The remainder of the Reference is currently under reconstruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/examples.html">Questions &amp; Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#modulation-and-secondary-keys">Modulation and Secondary Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#phrase-structure">Phrase Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#figured-bass">Figured Bass</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/specs.html">Technical Specifications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#what-is-being-encoded">What is being encoded?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#the-regex-regular-expression">The regEx (Regular Expression)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#feature-processing">Feature Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#missing-features">Missing Features</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">This Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">DCML Corpus Creation Pipeline</a><ul>
<li><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">Collect and prepare the digital edition in the latest MuseScore format</a><ul>
<li><a class="reference internal" href="#prior-research">Prior research</a></li>
<li><a class="reference internal" href="#look-up-and-check-existing-scores">Look up and check existing scores</a></li>
<li><a class="reference internal" href="#typeset-non-existent-files">Typeset non-existent files</a></li>
<li><a class="reference internal" href="#file-curation">File curation</a></li>
<li><a class="reference internal" href="#create-metadata">Create metadata</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files">Creating a repository with unannotated MuseScore files</a><ul>
<li><a class="reference internal" href="#variant-1-using-the-template-repository">Variant 1: Using the template repository</a></li>
<li><a class="reference internal" href="#variant-2-starting-from-scratch">Variant 2: Starting from scratch</a></li>
<li><a class="reference internal" href="#variant-3-splitting-an-existing-repository">Variant 3: Splitting an existing repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-and-adding-the-new-repo">Configuring and adding the new repo</a><ul>
<li><a class="reference internal" href="#adding-the-repo-to-one-or-several-meta-repos">Adding the repo to one or several meta-repos</a></li>
<li><a class="reference internal" href="#creating-work-packages-on-openproject">Creating work packages on OpenProject</a></li>
</ul>
</li>
<li><a class="reference internal" href="#curating-and-enriching-metadata">Curating and enriching metadata</a><ul>
<li><a class="reference internal" href="#default-fields">Default fields</a></li>
<li><a class="reference internal" href="#required-custom-fields">Required custom fields</a></li>
<li><a class="reference internal" href="#identifiers-where-available">Identifiers where available</a></li>
<li><a class="reference internal" href="#contributors-and-annotations">Contributors and annotations</a></li>
<li><a class="reference internal" href="#reconciling-metadata-with-wikidata">Reconciling metadata with Wikidata</a><ul>
<li><a class="reference internal" href="#creating-a-new-openrefine-project">Creating a new OpenRefine project</a></li>
<li><a class="reference internal" href="#reconciling-a-column">Reconciling a column</a></li>
<li><a class="reference internal" href="#reconciling-the-worktitle-column">Reconciling the <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> column</a></li>
<li><a class="reference internal" href="#pulling-additional-information">Pulling additional information</a></li>
<li><a class="reference internal" href="#future-work-sub-work-level-items">Future work: Sub-work-level items</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#finalizing-a-repository-for-publication">Finalizing a repository for publication</a><ul>
<li><a class="reference internal" href="#finalize-ongoing-work">Finalize ongoing work</a><ul>
<li><a class="reference internal" href="#check-openproject">0. Check OpenProject</a></li>
<li><a class="reference internal" href="#addressing-open-pull-requests">1. Addressing open Pull Requests</a></li>
<li><a class="reference internal" href="#check-for-unmerged-branches">2. Check for unmerged branches</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-repository-structure">Update repository structure</a><ul>
<li><a class="reference internal" href="#re-extract-everything-and-create-a-version-tag">3. Re-extract everything and create a version tag</a><ul>
<li><a class="reference internal" href="#a-re-extract-everything">3a) Re-extract everything</a></li>
<li><a class="reference internal" href="#b-assign-a-version-tag">3b) Assign a version tag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#remove-the-automated-github-workflow-and-all-deprecated-files">4. Remove the automated GitHub workflow and all deprecated files</a></li>
<li><a class="reference internal" href="#update-the-extracted-files-to-ms3-version-2">5. Update the extracted files to ms3 version 2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#eliminating-all-warnings">Eliminating all warnings</a><ul>
<li><a class="reference internal" href="#a-typical-example">A typical example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#finalizing-the-metadata">Finalizing the metadata</a><ul>
<li><a class="reference internal" href="#metadata-tsv"><code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code></a></li>
<li><a class="reference internal" href="#score-prelims-and-instrumentation">Score prelims and instrumentation</a><ul>
<li><a class="reference internal" href="#an-example">An example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#normalizing-score-layout">Normalizing score layout</a><ul>
<li><a class="reference internal" href="#header">Header</a></li>
<li><a class="reference internal" href="#score-layout">Score layout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integrating-the-repository-with-the-corpus-automatization">Integrating the repository with the corpus automatization</a><ul>
<li><a class="reference internal" href="#updating-all-subcorpora-csv">Updating <code class="docutils literal notranslate"><span class="pre">all_subcorpora.csv</span></code></a></li>
<li><a class="reference internal" href="#deploying-the-homepage">Deploying the homepage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#readme-md-and-template-filling"><code class="docutils literal notranslate"><span class="pre">README.md</span></code> and template filling</a><ul>
<li><a class="reference internal" href="#filling-the-templates-for-multiple-repositories">Filling the templates for multiple repositories</a></li>
<li><a class="reference internal" href="#filling-the-templates-for-a-single-repository">Filling the templates for a single repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#zenodo-integration">Zenodo integration</a><ul>
<li><a class="reference internal" href="#activating-the-integration-for-a-corpus-repository">Activating the integration for a corpus repository</a></li>
<li><a class="reference internal" href="#getting-the-zenodo-badge-id">Getting the Zenodo badge ID</a></li>
<li><a class="reference internal" href="#setting-up-the-zenodo-json-metadata-file">Setting up the <code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> metadata file</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../git/git.html" title="Previous Chapter: Quick Git Reference"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Quick Git Reference</span>
    </a>
  </li>
  <li>
    <a href="../scores/guidelines.html" title="Next Chapter: DCML Score Conventions"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DCML Score Co... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/pipeline/pipeline.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="dcml-corpus-creation-pipeline">
<h1>DCML Corpus Creation Pipeline<a class="headerlink" href="#dcml-corpus-creation-pipeline" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format" id="id29">Collect and prepare the digital edition in the latest MuseScore format</a></p>
<ul>
<li><p><a class="reference internal" href="#prior-research" id="id30">Prior research</a></p></li>
<li><p><a class="reference internal" href="#look-up-and-check-existing-scores" id="id31">Look up and check existing scores</a></p></li>
<li><p><a class="reference internal" href="#typeset-non-existent-files" id="id32">Typeset non-existent files</a></p></li>
<li><p><a class="reference internal" href="#file-curation" id="id33">File curation</a></p></li>
<li><p><a class="reference internal" href="#create-metadata" id="id34">Create metadata</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files" id="id35">Creating a repository with unannotated MuseScore files</a></p>
<ul>
<li><p><a class="reference internal" href="#variant-1-using-the-template-repository" id="id36">Variant 1: Using the template repository</a></p></li>
<li><p><a class="reference internal" href="#variant-2-starting-from-scratch" id="id37">Variant 2: Starting from scratch</a></p></li>
<li><p><a class="reference internal" href="#variant-3-splitting-an-existing-repository" id="id38">Variant 3: Splitting an existing repository</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-and-adding-the-new-repo" id="id39">Configuring and adding the new repo</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-the-repo-to-one-or-several-meta-repos" id="id40">Adding the repo to one or several meta-repos</a></p></li>
<li><p><a class="reference internal" href="#creating-work-packages-on-openproject" id="id41">Creating work packages on OpenProject</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#curating-and-enriching-metadata" id="id42">Curating and enriching metadata</a></p>
<ul>
<li><p><a class="reference internal" href="#default-fields" id="id43">Default fields</a></p></li>
<li><p><a class="reference internal" href="#required-custom-fields" id="id44">Required custom fields</a></p></li>
<li><p><a class="reference internal" href="#identifiers-where-available" id="id45">Identifiers where available</a></p></li>
<li><p><a class="reference internal" href="#contributors-and-annotations" id="id46">Contributors and annotations</a></p></li>
<li><p><a class="reference internal" href="#reconciling-metadata-with-wikidata" id="id47">Reconciling metadata with Wikidata</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-a-new-openrefine-project" id="id48">Creating a new OpenRefine project</a></p></li>
<li><p><a class="reference internal" href="#reconciling-a-column" id="id49">Reconciling a column</a></p></li>
<li><p><a class="reference internal" href="#reconciling-the-worktitle-column" id="id50">Reconciling the <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> column</a></p></li>
<li><p><a class="reference internal" href="#pulling-additional-information" id="id51">Pulling additional information</a></p></li>
<li><p><a class="reference internal" href="#future-work-sub-work-level-items" id="id52">Future work: Sub-work-level items</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#finalizing-a-repository-for-publication" id="id53">Finalizing a repository for publication</a></p>
<ul>
<li><p><a class="reference internal" href="#finalize-ongoing-work" id="id54">Finalize ongoing work</a></p>
<ul>
<li><p><a class="reference internal" href="#check-openproject" id="id55">0. Check OpenProject</a></p></li>
<li><p><a class="reference internal" href="#addressing-open-pull-requests" id="id56">1. Addressing open Pull Requests</a></p></li>
<li><p><a class="reference internal" href="#check-for-unmerged-branches" id="id57">2. Check for unmerged branches</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#update-repository-structure" id="id58">Update repository structure</a></p>
<ul>
<li><p><a class="reference internal" href="#re-extract-everything-and-create-a-version-tag" id="id59">3. Re-extract everything and create a version tag</a></p>
<ul>
<li><p><a class="reference internal" href="#a-re-extract-everything" id="id60">3a) Re-extract everything</a></p></li>
<li><p><a class="reference internal" href="#b-assign-a-version-tag" id="id61">3b) Assign a version tag</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#remove-the-automated-github-workflow-and-all-deprecated-files" id="id62">4. Remove the automated GitHub workflow and all deprecated files</a></p></li>
<li><p><a class="reference internal" href="#update-the-extracted-files-to-ms3-version-2" id="id63">5. Update the extracted files to ms3 version 2</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#eliminating-all-warnings" id="id64">Eliminating all warnings</a></p>
<ul>
<li><p><a class="reference internal" href="#a-typical-example" id="id65">A typical example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#finalizing-the-metadata" id="id66">Finalizing the metadata</a></p>
<ul>
<li><p><a class="reference internal" href="#metadata-tsv" id="id67"><code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code></a></p></li>
<li><p><a class="reference internal" href="#score-prelims-and-instrumentation" id="id68">Score prelims and instrumentation</a></p>
<ul>
<li><p><a class="reference internal" href="#an-example" id="id69">An example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#normalizing-score-layout" id="id70">Normalizing score layout</a></p>
<ul>
<li><p><a class="reference internal" href="#header" id="id71">Header</a></p></li>
<li><p><a class="reference internal" href="#score-layout" id="id72">Score layout</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#integrating-the-repository-with-the-corpus-automatization" id="id73">Integrating the repository with the corpus automatization</a></p>
<ul>
<li><p><a class="reference internal" href="#updating-all-subcorpora-csv" id="id74">Updating <code class="docutils literal notranslate"><span class="pre">all_subcorpora.csv</span></code></a></p></li>
<li><p><a class="reference internal" href="#deploying-the-homepage" id="id75">Deploying the homepage</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#readme-md-and-template-filling" id="id76"><code class="docutils literal notranslate"><span class="pre">README.md</span></code> and template filling</a></p>
<ul>
<li><p><a class="reference internal" href="#filling-the-templates-for-multiple-repositories" id="id77">Filling the templates for multiple repositories</a></p></li>
<li><p><a class="reference internal" href="#filling-the-templates-for-a-single-repository" id="id78">Filling the templates for a single repository</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#zenodo-integration" id="id79">Zenodo integration</a></p>
<ul>
<li><p><a class="reference internal" href="#activating-the-integration-for-a-corpus-repository" id="id80">Activating the integration for a corpus repository</a></p></li>
<li><p><a class="reference internal" href="#getting-the-zenodo-badge-id" id="id81">Getting the Zenodo badge ID</a></p></li>
<li><p><a class="reference internal" href="#setting-up-the-zenodo-json-metadata-file" id="id82">Setting up the <code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> metadata file</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">
<span id="get-scores"></span><h2><a class="toc-backref" href="#id29" role="doc-backlink">Collect and prepare the digital edition in the latest MuseScore format</a><a class="headerlink" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format" title="Link to this heading">¶</a></h2>
<section id="prior-research">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Prior research</a><a class="headerlink" href="#prior-research" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Check which pieces make up the collection</p></li>
<li><p>how they are grouped</p></li>
<li><p>what naming or numbering conventions exist</p></li>
<li><p>which editions there are</p></li>
<li><p>if different versions of the pieces exist.</p></li>
<li><p>Come up with a list (and hierarchy) of names. Here, you can already think of a good naming/numbering convention for the corpus.</p></li>
<li><p>It might be good to create the list of the overarching group of works even if your corpus will contain only parts of it, for the sake of a better overview.</p></li>
<li><p>Example: Going from the <a class="reference external" href="http://www3.cpdl.org/wiki/index.php/Claudio_Monteverdi">list of Monteverdi’s Madrigal books</a>
to an <a class="reference external" href="https://github.com/DCMLab/monteverdi_madrigals/">initial README file</a>.</p></li>
</ul>
</section>
<section id="look-up-and-check-existing-scores">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">Look up and check existing scores</a><a class="headerlink" href="#look-up-and-check-existing-scores" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>All scores available need to be checked and compared:</dt><dd><ul>
<li><p>reference edition</p></li>
<li><p>completeness</p></li>
<li><p>quality &amp; errors</p></li>
<li><p>license (later publication!)</p></li>
<li><p>file format and expected conversion losses</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Where to check</dt><dd><ul>
<li><p>First: musescore.com because the scores are in the target format</p></li>
<li><p>musicalion.com (not free to publish: need to ask first)</p></li>
<li><p>choral music: CPDL</p></li>
<li><p><a class="reference external" href="http://kern.ccarh.org/">http://kern.ccarh.org/</a> lossless humdrum 2 musescore conversion needed</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="typeset-non-existent-files">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">Typeset non-existent files</a><a class="headerlink" href="#typeset-non-existent-files" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>pick reference edition and send commission to transcriber</p></li>
<li><p>depending on the music, prices may vary between 5 and 20 CHF per page</p></li>
</ul>
</section>
<section id="file-curation">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">File curation</a><a class="headerlink" href="#file-curation" title="Link to this heading">¶</a></h3>
<p>The scores need to be corrected on the basis of a reference edition/manuscript.
This documentation contains a page containing the <a class="reference internal" href="../scores/guidelines.html"><span class="doc">DCML Score Conventions</span></a> which
stipulate which information from the reference edition/manuscript needs to be encoded in what way.
Please send a request to be added to the document.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Convert to MuseScore format</dt><dd><ul>
<li><p>XML, CAP: can be done with MuseScore’s batch converter plugin or with <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">convert</span></code></p></li>
<li><p>CAPX: Conversion to CAP or XML with DCML’s Capella license</p></li>
<li><p>MUSX: Conversion to XML with private Finale copy</p></li>
<li><p>SIB: Conversion to XML with Sibelius on DCML’s iMac</p></li>
<li><p>LY: no good conversion available</p></li>
<li><p>KRN: hum2xml can be used but it would be preferable to have our own converter to MuseScore</p></li>
<li><p>results need to be checked; especially markup such as slurs, arpeggios, trills etc. often get screwed</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Renaming</dt><dd><ul>
<li><p>Decide on naming convention and create a map (without extensions) from old to new filenames</p></li>
<li><dl class="simple">
<dt>Sometimes, files need to be split at that point because they contain several movements</dt><dd><ul>
<li><p>For this, you introduce section breaks separating the movements</p></li>
<li><p>After every section break, you have to re-insert the time and key signature or add it into the split file</p></li>
<li><p>Start with the last movement, select it and do <cite>File -&gt; Save Selection</cite></p></li>
<li><p>Repeat for all movements</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Rename the files</p></li>
<li><p>Possibly add a small script that automatically renames the source files</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Use parser/checking tool and/or manual checks for consistency</dt><dd><ul>
<li><dl class="simple">
<dt>certain bars need to be excluded from the bar count:</dt><dd><ul>
<li><p>anacrusis</p></li>
<li><p>pickup measures throughout the piece</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>alternative endings are different versions of the same measure numbers</dt><dd><ul>
<li><p>to make sure that the second ending has the same measure number as the first one, go to the “Measure properties”
of the first one and enter in the field “Add to measure count:” the negative number of bars of the first ending.</p></li>
<li><p>In the example of two endings with the default measure numbers <code class="docutils literal notranslate"><span class="pre">[15|16][17|18]</span></code>, we add <code class="docutils literal notranslate"><span class="pre">-2</span></code> to the measure
count of <code class="docutils literal notranslate"><span class="pre">17</span></code> and thus achieve <code class="docutils literal notranslate"><span class="pre">[15|16][15|16]</span></code>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>irregular measure lengths need to complete each other</dt><dd><ul>
<li><p>e.g. when a repeated section starts with a pickup measure, the last measure of the repeated section needs to be shorter</p></li>
<li><p>anacrusis is substracted from the last bar</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>if in the reference edition the bar count restarts in the middle of the piece (e.g. in some variation movements), you can</dt><dd><ul>
<li><p>either: split the movement into individual files (not preferable if you want to keep the movement as one coherent unit)</p></li>
<li><p>or: have two versions, one working version with continuous (unambiguous) measure numbers that depart from the reference edition, and one that is provided separately, that has the original (ambiguous) measure numbering but is not used for computational purposes. The reset of the counter should not be done via “add to measure count” using a negative number, but rather via section breaks.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="create-metadata">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">Create metadata</a><a class="headerlink" href="#create-metadata" title="Link to this heading">¶</a></h3>
<p>All metadata fields are automatically extracted by the dcml_corpus_workflow and represented in the repository’s
<code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file. However, at the beginning this file needs to be created using the command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span> <span class="pre">-a</span></code>.
The first column, <code class="docutils literal notranslate"><span class="pre">fname</span></code>, is used as IDs for the corpus and needs to be checked. In case the corpus contains
several alternative scores for the same piece, the main MuseScore file should have the shortest file name and the
alternative scores’ file names should begin with the same <code class="docutils literal notranslate"><span class="pre">fname</span></code> plus a suffix or a different file extension.
Upon creation of the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file, all scores will be listed and you can safely remove the rows corresponding
to the alternative versions to prevent them being processed by ms3.</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> is there and contains one row per piece, metadata curation is as straightforward as
updating values and adding columns to the file and then calling
<code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span></code> to write the updated values into the corresponding Musescore files. Be aware that calling
<code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code> will overwrite the manual changes in the TSV file with any value existing in the MuseScore files.
so make sure to commit your manual modifications to not loose them.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Although many editors open TSV files, many of them silently change values, e.g. by removing
<code class="docutils literal notranslate"><span class="pre">.0</span></code> from decimal values (LibreOffice) or turning a <code class="docutils literal notranslate"><span class="pre">4/4</span></code> time signature into a date (Excel,
Numbers). One editor that doesn’t to that is VScode. Make sure to <strong>always</strong> view the diff before
committing changes to <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> to avoid unwanted modifications or, worse, loss of data.</p>
</div>
<p>Once the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> is there and contains one row per piece, you can either continue with the following section
and create the new Git repository or <a class="reference internal" href="#enriching-metadata"><span class="std std-ref">enrich the metadata</span></a> first. Since enriching metadata
involves modifying the scores, however, it is preferable to make metadata curation part of the Git history.</p>
</section>
</section>
<section id="creating-a-repository-with-unannotated-musescore-files">
<span id="score-repo"></span><h2><a class="toc-backref" href="#id35" role="doc-backlink">Creating a repository with unannotated MuseScore files</a><a class="headerlink" href="#creating-a-repository-with-unannotated-musescore-files" title="Link to this heading">¶</a></h2>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>After we start the annotation workflow, no MuseScore files should be added. removed, or renamed! The edition
needs to be complete and the file names final.</p>
</div>
<p>Before starting annotating a corpus, a repo with the standard folder structure needs to be created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── MS3
└── pdf
</pre></div>
</div>
<p>The directory <code class="docutils literal notranslate"><span class="pre">MS3</span></code> contains the unannotated MuseScore files and <code class="docutils literal notranslate"><span class="pre">PDF</span></code> the print edition or manuscript which they
encode. In order to activate the annotation workflow (i.e. the automatic scripts triggered on the GitHub servers
by certain events related to annotation and review), the folder <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code> needs to be copied from
the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a>. It also contains our
standard <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file which prevents temporary files from being tracked and uploaded.</p>
<section id="variant-1-using-the-template-repository">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Variant 1: Using the template repository</a><a class="headerlink" href="#variant-1-using-the-template-repository" title="Link to this heading">¶</a></h3>
<p>You can create the new repo directly from the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a>
by heading there and clicking on ‘Use this template’. In this variant, every push to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch results
in metadata, measures and notes being extracted from all changed <code class="docutils literal notranslate"><span class="pre">.mscx</span></code> files. Note that renaming and deleting
files will lead to undesired effects that will have to be checked and corrected manually.</p>
</section>
<section id="variant-2-starting-from-scratch">
<h3><a class="toc-backref" href="#id37" role="doc-backlink">Variant 2: Starting from scratch</a><a class="headerlink" href="#variant-2-starting-from-scratch" title="Link to this heading">¶</a></h3>
<p>Or you simply create the new repo with the above-mentioned folder structure and add the workflow scripts when
the scores are prepared. In this case, you will have to use the <a class="reference external" href="https://pypi.org/project/ms3">Python library ms3</a>
to extract metadata, notes, and measures manually.</p>
</section>
<section id="variant-3-splitting-an-existing-repository">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">Variant 3: Splitting an existing repository</a><a class="headerlink" href="#variant-3-splitting-an-existing-repository" title="Link to this heading">¶</a></h3>
<p>This is for the special case that the MuseScore files in question are already sitting in a subfolder of an existing
repository which is to be transferred into the new repo including the files’ Git histories. This variant is a bit
more involved and requires prior installation of the <a class="reference external" href="https://github.com/newren/git-filter-repo">git filter-repo</a>
command which is recommended by the Git developers for replacing <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">filter-branch</span></code>.</p>
<dl>
<dt>Setting</dt><dd><p>As an example, we will create a new repository <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> (Repo B) which will include all files situated in the
existing repository <code class="docutils literal notranslate"><span class="pre">corpora</span></code> (Repo A) in the subfolder <code class="docutils literal notranslate"><span class="pre">annotations/Chopin-Mazurkas</span></code>, with the workflow scripts
added on top.</p>
</dd>
<dt>Create the new repo B</dt><dd><p>On GitHub, we use the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a> to create
the target repo <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> with the workflow files and the standard <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>. Locally, we initialize
an empty Git repo that will be connected upstream at a later point:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">chopin_mazurkas</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">chopin_mazurkas</span> <span class="o">&amp;&amp;</span> <span class="n">git</span> <span class="n">init</span>
</pre></div>
</div>
<p>Make sure that your Git is configured to use the name <code class="docutils literal notranslate"><span class="pre">main</span></code> for the default branch, which can be achieved using
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">--global</span> <span class="pre">init.defaultBranch</span> <span class="pre">main</span></code>.</p>
</dd>
<dt>Clone repo A and transfer files</dt><dd><p>We start off with a fresh clone of <code class="docutils literal notranslate"><span class="pre">corpora</span></code>, head into it and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="nb">filter</span><span class="o">-</span><span class="n">repo</span> <span class="o">--</span><span class="n">subdirectory</span><span class="o">-</span><span class="nb">filter</span> <span class="n">annotations</span><span class="o">/</span><span class="n">Chopin</span><span class="o">-</span><span class="n">Mazurkas</span><span class="o">/</span> <span class="o">--</span><span class="n">target</span> <span class="o">../</span><span class="n">chopin_mazurkas</span>
</pre></div>
</div>
<p>which will copy all files from <code class="docutils literal notranslate"><span class="pre">annotations/Chopin-Mazurkas/</span></code> to the freshly initialized repo
<code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> together with their full commit histories. If there is a README file, rename it to <code class="docutils literal notranslate"><span class="pre">README.md</span></code>.</p>
</dd>
<dt>Connect local repo B to the remote repo B</dt><dd><p>The local <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> now contains the files at the top level together with the full commit
history (check out <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code>). Now we can connect it to the remote and merge the workflow scripts from there:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">origin</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">DCMLab</span><span class="o">/</span><span class="n">chopin_mazurkas</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">pull</span> <span class="n">origin</span> <span class="n">main</span> <span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">unrelated</span><span class="o">-</span><span class="n">histories</span>
<span class="n">git</span> <span class="n">push</span> <span class="o">-</span><span class="n">u</span> <span class="n">origin</span> <span class="n">main</span>
</pre></div>
</div>
</dd>
<dt>Clean metadata</dt><dd><p>In case there was an older <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> it should now be automatically updated and you might have to clean it.
This may involve naming the first two columns <code class="docutils literal notranslate"><span class="pre">rel_paths</span></code> and <code class="docutils literal notranslate"><span class="pre">fnames</span></code>. For the Mazurka example,
<a class="reference external" href="https://github.com/DCMLab/chopin_mazurkas/pull/1">this Pull Request</a> shows the metadata cleaning and update
of the existing files from an older MuseScore and annotation standard.</p>
</dd>
</dl>
</section>
</section>
<section id="configuring-and-adding-the-new-repo">
<h2><a class="toc-backref" href="#id39" role="doc-backlink">Configuring and adding the new repo</a><a class="headerlink" href="#configuring-and-adding-the-new-repo" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Set the standard repo settings on GitHub:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/pr_settings.png"><img alt="Repository settings on GitHub" src="../_images/pr_settings.png" style="width: 387.5px; height: 273.5px;" /></a>
</figure>
</li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Branches</span></code>, create a branch protection rule for the main branch:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/branch_protection.png"><img alt="Protecting the main branch on GitHub" src="../_images/branch_protection.png" style="width: 392.0px; height: 250.0px;" /></a>
</figure>
</li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Collaborators</span> <span class="pre">and</span> <span class="pre">teams</span></code> give write access to the <code class="docutils literal notranslate"><span class="pre">annotators</span></code> team.</p></li>
<li><p>Add the new repo to the corresponding meta-repositories (at least to <code class="docutils literal notranslate"><span class="pre">all_subcorpora</span></code>, see below).</p></li>
<li><p>Add the new repo to the annotation workflow (drop-down menus, OpenProject, WebHooks, workflow_deployment repo etc.)</p></li>
</ul>
<section id="adding-the-repo-to-one-or-several-meta-repos">
<span id="metarepos"></span><h3><a class="toc-backref" href="#id40" role="doc-backlink">Adding the repo to one or several meta-repos</a><a class="headerlink" href="#adding-the-repo-to-one-or-several-meta-repos" title="Link to this heading">¶</a></h3>
<p>The individual subcorpora can be embedded as submodules in meta-repositories. These meta-repos are listed in the private
<a class="reference external" href="https://github.com/DCMLab/meta_repositories">meta_repositories</a> repo. Currently, the most important ones are:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/DCMLab/dcml_corpora">dcml_corpora</a> for published corpora</p></li>
<li><p><a class="reference external" href="https://github.com/DCMLab/all_subcorpora">all_subcorpora</a> (private) for all published and unpublished corpora.</p></li>
</ol>
<p>To add the new repo, head into the meta-repo and do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">submodule</span> <span class="n">add</span> <span class="o">-</span><span class="n">b</span> <span class="n">main</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">DCMLab</span><span class="o">/</span><span class="n">chopin_mazurkas</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Just to be sure, update all submodules: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--remote</span></code> and push the whole thing.</p>
</section>
<section id="creating-work-packages-on-openproject">
<h3><a class="toc-backref" href="#id41" role="doc-backlink">Creating work packages on OpenProject</a><a class="headerlink" href="#creating-work-packages-on-openproject" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Follow the instructions for <cite>create_work_packages.py</cite> under <a class="reference external" href="https://github.com/DCMLab/openproject_scripts/">https://github.com/DCMLab/openproject_scripts/</a></p>
<ul class="simple">
<li><p>set the column <code class="docutils literal notranslate"><span class="pre">parent</span></code> to the name of the repository</p></li>
<li><p>rename the columns <code class="docutils literal notranslate"><span class="pre">fnames</span> <span class="pre">=&gt;</span> <span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">last_mn</span> <span class="pre">=&gt;</span> <span class="pre">measures</span></code></p></li>
<li><p>if the new work packages are for annotation upgrades rather than new annotations, add the column <code class="docutils literal notranslate"><span class="pre">work_package_type</span></code>
with value <code class="docutils literal notranslate"><span class="pre">Annotation</span> <span class="pre">Upgrade</span></code></p></li>
<li><p>find out the status of all pieces and fill the column <code class="docutils literal notranslate"><span class="pre">status</span></code>. Accordingly:</p></li>
<li><p>if annotations are present and need to be updated, rename <code class="docutils literal notranslate"><span class="pre">annotators</span> <span class="pre">=&gt;</span> <span class="pre">reviewer</span></code> and make sure that every cell contains exactly one
user name (<code class="docutils literal notranslate"><span class="pre">First</span> <span class="pre">Last</span></code>) known to OpenProject;</p></li>
<li><p>if review is done or ongoing, do the same for the renamed column <code class="docutils literal notranslate"><span class="pre">reviewers</span> <span class="pre">=&gt;</span> <span class="pre">reviewer</span></code></p></li>
<li><p>if annotations are present and finalized, the work package, in theory, does not need to be created; if it is,
it should have status “Not available”. Filling the fields <code class="docutils literal notranslate"><span class="pre">assignee</span></code> and <code class="docutils literal notranslate"><span class="pre">reviewer</span></code>, is not needed unless for invoicing purposes</p></li>
</ul>
</li>
<li><p>Create a new view in OpenProject:</p>
<ul class="simple">
<li><p>open any of the existing corpora views</p></li>
<li><p>replace the <code class="docutils literal notranslate"><span class="pre">Parent</span></code> filter with the repo name</p></li>
<li><p>in the menu, select <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">as...</span></code></p></li>
<li><p>enter the repo name and check <code class="docutils literal notranslate"><span class="pre">Public</span></code></p></li>
</ul>
</li>
<li><p>Add the webhook to the repo</p>
<ul class="simple">
<li><p>go to a repo for which the webhook is already set up</p></li>
<li><p>in the repo settings, go to <code class="docutils literal notranslate"><span class="pre">Webhooks</span></code>, click <code class="docutils literal notranslate"><span class="pre">Edit</span></code>, and copy the <code class="docutils literal notranslate"><span class="pre">Payload</span> <span class="pre">URL</span></code></p></li>
<li><p>in the new repo, go to <code class="docutils literal notranslate"><span class="pre">Settings</span> <span class="pre">-&gt;</span> <span class="pre">Webhooks</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">webhook</span></code> and insert the copied <code class="docutils literal notranslate"><span class="pre">Payload</span> <span class="pre">URL</span></code></p></li>
<li><p>set the <code class="docutils literal notranslate"><span class="pre">Content</span> <span class="pre">type</span></code> to “application/json”</p></li>
<li><p>Below, select “Send me <strong>everything</strong>” and click <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">webhook</span></code></p></li>
</ul>
</li>
<li><p>Add the new work packages to the master sheet for the administrative staff</p></li>
</ol>
</section>
</section>
<section id="curating-and-enriching-metadata">
<span id="enriching-metadata"></span><h2><a class="toc-backref" href="#id42" role="doc-backlink">Curating and enriching metadata</a><a class="headerlink" href="#curating-and-enriching-metadata" title="Link to this heading">¶</a></h2>
<p>In MuseScore, metadata is stored as <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">-&gt;</span> <span class="pre">value</span></code> pairs and can be accessed and modified via the menu
<code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Score</span> <span class="pre">Properties...</span></code>. Some fields are there by default, others have to be created using the <code class="docutils literal notranslate"><span class="pre">New</span></code> button.
It is very important that the fields are named correctly (double-check for spelling mistakes) and all lowercase.
The command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code> extracts the metadata fields from the MuseScore files, updating the
<code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file in a way that every row corresponds to a MuseScore file where every <code class="docutils literal notranslate"><span class="pre">key</span></code> is a column showing
the <code class="docutils literal notranslate"><span class="pre">value</span></code> from the corresponding file. Likewise, this can be used to batch-edit the metadata of several or all
MuseScore files in the corpus by editing the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file and calling the command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before manipulating <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> make sure to call <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code>, ensuring that it is up to date
with the metadata contained in the MuseScore files. Otherwise the command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span></code> would overwrite
newer values, resulting in the criminal offense of undoing other people’s work.</p>
</div>
<p>DCML corpora usually come with one MuseScore file per movement, hence we follow the convention that anything related to
<code class="docutils literal notranslate"><span class="pre">work</span></code> describes the whole group (Suite, Symphony, etc.) or cycle (e.g. song cycle), and fields containing
<code class="docutils literal notranslate"><span class="pre">movement</span></code> or <code class="docutils literal notranslate"><span class="pre">mvt</span></code> its individual parts. It follows that in the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file titles, catalogue numbers,
URIs etc. may be repeated and identical for the parts of a <code class="docutils literal notranslate"><span class="pre">work</span></code>. Identifiers for individual movements are often
hard to come by, but <a class="reference external" href="https://musicbrainz.org/">MusicBrainz</a> has already a good number of them. For compositions
where the subdivision into parts is somewhat arbitrary (consider the grouping into tracks for recordings of the same
opera), the question of unique identification is an open problem.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Whereas in filenames we avoid all diacritical signs, accents, Umlaute etc., the metadata needs to include them
accurately encoded in UTF-8. For example, write <code class="docutils literal notranslate"><span class="pre">Antonín</span> <span class="pre">Dvořák</span></code>, not <code class="docutils literal notranslate"><span class="pre">Antonin</span> <span class="pre">Dvorak</span></code>. Whenever in doubt,
go with the English Wikidata/Wikipedia.</p>
</div>
<section id="default-fields">
<h3><a class="toc-backref" href="#id43" role="doc-backlink">Default fields</a><a class="headerlink" href="#default-fields" title="Link to this heading">¶</a></h3>
<p>The following default fields should be populated where applicable:</p>
<dl class="simple">
<dt>composer</dt><dd><p>Full name as displayed in the English Wikipedia. For example,
<a class="reference external" href="https://en.wikipedia.org/wiki/Pyotr_Ilyich_Tchaikovsky">Tchaikovsky</a> gets <code class="docutils literal notranslate"><span class="pre">Pyotr</span> <span class="pre">Ilyich</span> <span class="pre">Tchaikovsky</span></code>.</p>
</dd>
<dt>workTitle</dt><dd><p>Name of the entire work/cycle, e.g. <code class="docutils literal notranslate"><span class="pre">Winterreise</span></code> or <code class="docutils literal notranslate"><span class="pre">Piano</span> <span class="pre">Sonata</span> <span class="pre">No.</span> <span class="pre">1</span> <span class="pre">in</span> <span class="pre">C</span> <span class="pre">major</span></code> without any catalogue
or opus numbers. The title should largely correspond to the English <code class="docutils literal notranslate"><span class="pre">label</span></code> of the corresponding (or future)
Wikidata item.</p>
</dd>
<dt>workNumber</dt><dd><p>This is where opus and catalogue numbers go, e.g. <code class="docutils literal notranslate"><span class="pre">Op.</span> <span class="pre">33,</span> <span class="pre">No.</span> <span class="pre">3,</span> <span class="pre">BI</span> <span class="pre">115-3</span></code>.</p>
</dd>
<dt>movementNumer</dt><dd><p>Ordinal number of the movement or part. Should be an arabic integer, e.g. <code class="docutils literal notranslate"><span class="pre">2</span></code> (not <code class="docutils literal notranslate"><span class="pre">2.</span></code>, not <code class="docutils literal notranslate"><span class="pre">II</span></code>).</p>
</dd>
<dt>movementTitle</dt><dd><p>Title of the part, e.g. song title, or <code class="docutils literal notranslate"><span class="pre">Andante</span></code> (not <code class="docutils literal notranslate"><span class="pre">II.</span> <span class="pre">Andante</span></code>). If unclear, CD track titles might serve
as an orientation.</p>
</dd>
<dt>source</dt><dd><p>URL of the adapted digital edition, e.g. a link to musescore.com or kern.humdrum.org.</p>
</dd>
</dl>
</section>
<section id="required-custom-fields">
<h3><a class="toc-backref" href="#id44" role="doc-backlink">Required custom fields</a><a class="headerlink" href="#required-custom-fields" title="Link to this heading">¶</a></h3>
<p>The following fields need to be populated.</p>
<dl id="composition-year-columns">
<dt>composed_start, composed_end</dt><dd><p>Each of these two fields needs to contain a 4-digit year number such that taken together they represent the time span
during which the piece was composed according to <code class="docutils literal notranslate"><span class="pre">composed_source</span></code>. If the time span lies within the same year,
both fields contain the same number. If the source indicates an open interval (e.g. <code class="docutils literal notranslate"><span class="pre">?-1789</span></code>), we use the
<a class="reference external" href="https://www.loc.gov/standards/datetime/">EDTF</a> convention to indicate the unknown date (here <code class="docutils literal notranslate"><span class="pre">composed_start</span></code>)
as <code class="docutils literal notranslate"><span class="pre">..</span></code>. If no composition date is known, we use the following dates as fallback, in that order:</p>
<ol class="arabic simple">
<li><p>year of the princeps edition</p></li>
<li><p>musicologically informed time span (e.g. the composer’s “sad phase” from x-y)</p></li>
<li><p>composer’s life span</p></li>
</ol>
<p>In any of these cases, an explaining comment should be added to the <code class="docutils literal notranslate"><span class="pre">composed_source</span></code> field.</p>
</dd>
<dt>composed_source</dt><dd><p>The reference to where the <code class="docutils literal notranslate"><span class="pre">composed_start</span></code> and <code class="docutils literal notranslate"><span class="pre">composed_end</span></code> dates come from. Could be a URL such as
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_compositions_by_Edvard_Grieg">https://en.wikipedia.org/wiki/List_of_compositions_by_Edvard_Grieg</a>, the name of a dictionary or work catalogue,
or bibliographical data of a book. The latter would be required in the case of using a “musicologically informed
time span” (see above). This field is free text and, in the absence of composition dates, should contain additional
information on what exactly the years represent, e.g.
<code class="docutils literal notranslate"><span class="pre">dates</span> <span class="pre">represent</span> <span class="pre">the</span> <span class="pre">&quot;late</span> <span class="pre">period&quot;</span> <span class="pre">of</span> <span class="pre">composer</span> <span class="pre">X's</span> <span class="pre">work,</span> <span class="pre">as</span> <span class="pre">proposed</span> <span class="pre">by</span> <span class="pre">author</span> <span class="pre">Y</span> <span class="pre">in</span> <span class="pre">book</span> <span class="pre">Z,</span> <span class="pre">page</span> <span class="pre">n</span></code>.</p>
</dd>
</dl>
</section>
<section id="identifiers-where-available">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">Identifiers where available</a><a class="headerlink" href="#identifiers-where-available" title="Link to this heading">¶</a></h3>
<p>Identifiers are important for making data findable and interoperable but might not always be available. Nevertheless,
the goal should be to find minimum one of the work or part-of-work identifiers listed below. Wikidata identifiers
are the gold standard because they often come with a mapping to all sorts of other identifiers. In addition,
Wikidata is a knowledge graph which lets us easily pull additional metadata. The site has the drawback
that identifiers for less known works are mostly missing as of yet and so are identifiers for individual movements.
Until the fundamental problem of community-wide work identifiers is solved, we should aim at completing missing
Wikidata items and foster the graph’s function as a Linked Open Data hub and registry for all other sorts of
identifiers.</p>
<dl class="simple">
<dt>wikidata</dt><dd><p>This field is used to identify the <code class="docutils literal notranslate"><span class="pre">work</span></code> with the full URL of its corresponding Wikidata item, e.g.
<a class="reference external" href="http://www.wikidata.org/entity/Q2194957">http://www.wikidata.org/entity/Q2194957</a>. If the <code class="docutils literal notranslate"><span class="pre">composer</span></code> and <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> field are properly filled in,
they can be reconciled with, i.e. matched to,
Wikidata <a class="reference external" href="https://openrefine.org/docs/manual/reconciling">using OpenRefine</a>.
<strong>Tip:</strong> If you happen to have the Wikipedia page open, you can quickly access the Wikidata item by clicking on
<code class="docutils literal notranslate"><span class="pre">Wikidata</span> <span class="pre">item</span></code> the <code class="docutils literal notranslate"><span class="pre">Tools</span></code> menu in the upper right (new layout) or in the left sidebar (old layout).</p>
</dd>
<dt>musicbrainz</dt><dd><p>musicbrainz.org has a whole lot of different identifiers, in particular for identifying individual recordings down
to the level of CD tracks. The ones we’re interested here are work identifiers (make sure the URI starts with
<code class="docutils literal notranslate"><span class="pre">https://musicbrainz.org/work/</span></code>). The project is very advanced with creating identifiers on the
sub-work (movement) level and we use those whenever available (see screenshot below).
If not, we repeat the work ID for each movement.</p>
</dd>
</dl>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="../_images/musicbrainz_work.png"><img alt="Example for a work displayed on musicbrainz." src="../_images/musicbrainz_work.png" style="width: 534.8px; height: 387.09999999999997px;" /></a>
<figcaption>
<p><span class="caption-text">Example of a work displayed on musicbrainz (note the URL). In this case, it lists identifiers for its three
movements so we would be using these.</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<dl class="simple">
<dt>viaf</dt><dd><p>Work URI, e.g. <a class="reference external" href="https://viaf.org/viaf/181040674">https://viaf.org/viaf/181040674</a></p>
</dd>
<dt>imslp</dt><dd><p>URL of the work’s Wiki page, e.g.
<a class="reference external" href="https://imslp.org/wiki/Piano_Sonata_No.1_in_C_major%2C_K.279/189d_%28Mozart%2C_Wolfgang_Amadeus%29">https://imslp.org/wiki/Piano_Sonata_No.1_in_C_major%2C_K.279/189d_%28Mozart%2C_Wolfgang_Amadeus%29</a></p>
</dd>
<dt>pdf</dt><dd><p>We use this field, if applicable and available, to store the permanent link to the source PDF which the
digital score is supposed to represent. Most often this will be an IMSLP “permlink” pointing to a particular
edition through its ID, such as <a class="reference external" href="https://imslp.org/wiki/Special:ReverseLookup/1689">https://imslp.org/wiki/Special:ReverseLookup/1689</a> (the corresponding PDF file
name starts with <code class="docutils literal notranslate"><span class="pre">IMSLP01689</span></code>). Such a permlink is available via the edition’s menu, by clicking on
<code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">permlink</span></code>.</p>
</dd>
<dt>P&lt;number&gt; (&lt;description&gt;)</dt><dd><p>Columns with a Wikidata “P-number” are used for storing a reconciliation with the Wikidata knowledge graph. For
example, the column <code class="docutils literal notranslate"><span class="pre">P86</span> <span class="pre">(composer)</span></code> contains both the ID of the
<a class="reference external" href="https://www.wikidata.org/wiki/Property:P86">property ‘composer’</a> and in parenthesis the English label of the
property. The values of the column are the “Q-numbers” of the composer item. For more information, refer to
<a class="reference internal" href="#reconciling"><span class="std std-ref">Reconciling metadata with Wikidata</span></a> below.</p>
</dd>
</dl>
</section>
<section id="contributors-and-annotations">
<h3><a class="toc-backref" href="#id46" role="doc-backlink">Contributors and annotations</a><a class="headerlink" href="#contributors-and-annotations" title="Link to this heading">¶</a></h3>
<p>Custom fields to give credit to contributors and to keep track of versions of annotation standards and the likes.
The preferred identifiers for persons are ORCIDs such as <code class="docutils literal notranslate"><span class="pre">0000-0002-1986-9545</span></code> or given as URL, such as
<a class="reference external" href="https://orcid.org/0000-0002-1986-9545">https://orcid.org/0000-0002-1986-9545</a>.</p>
<dl class="simple">
<dt>typesetter</dt><dd><p>Name/identifier/homepage of the person(s) or company who engraved the digital edition or major parts of it.</p>
</dd>
<dt>score_integrity</dt><dd><p>Name/identifier/homepage of the person(s) or company who reviewed and corrected the score to make it
match the reference edition/manuscript (potentially referenced under <code class="docutils literal notranslate"><span class="pre">pdf</span></code>).</p>
</dd>
<dt>annotators</dt><dd><p>Name/identifier of each person who contributed new labels. If the file contains several types/versions/iterations,
specify in parenthesis who did what.</p>
</dd>
<dt>reviewers</dt><dd><p>Name/identifier of each person who reviewed annotation labels, potentially modifying them.
If a review pertained only to a particular type/version/iteration, specify in parenthesis which one.</p>
</dd>
<dt>harmony_version</dt><dd><p>Version of the DCML harmony annotation standard used, e.g. <code class="docutils literal notranslate"><span class="pre">2.3.0</span></code>.</p>
</dd>
</dl>
</section>
<section id="reconciling-metadata-with-wikidata">
<span id="reconciling"></span><h3><a class="toc-backref" href="#id47" role="doc-backlink">Reconciling metadata with Wikidata</a><a class="headerlink" href="#reconciling-metadata-with-wikidata" title="Link to this heading">¶</a></h3>
<p>Wikidata is a knowledge graph in which</p>
<ul class="simple">
<li><p>each node (a noun considered as subject or object of a relation) is identified by a “Q-number” such as <code class="docutils literal notranslate"><span class="pre">Q636399</span></code>
(<a class="reference external" href="https://www.wikidata.org/wiki/Q636399">the song “Smoke on the Water”</a>),</p></li>
<li><p>each edge (a verb or property) by a “P-number” such as <code class="docutils literal notranslate"><span class="pre">P921</span></code>
(<a class="reference external" href="https://www.wikidata.org/wiki/Property:P921">the property “main subject”</a>, in this example pointing to the node
<a class="reference external" href="https://www.wikidata.org/wiki/Q81085137">Q81085137</a>).</p></li>
</ul>
<p>Reconciling metadata with Wikidata means linking values to nodes in the graph by assigning the relevant Q-numbers,
which can be comfortably achieved with the software <code class="docutils literal notranslate"><span class="pre">OpenRefine</span> <span class="pre">&lt;https://openrefine.org/&gt;</span></code>. As an example,
we take the insufficiently populated <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> from the Annotated Beethoven Corpus version 2.1
(<a class="reference external" href="https://raw.githubusercontent.com/DCMLab/ABC/v2.1/metadata.tsv">link</a>).
The goal of this step-by-step guide is to reconcile the composer and his 16 string quartets with Wikidata.</p>
<section id="creating-a-new-openrefine-project">
<h4><a class="toc-backref" href="#id48" role="doc-backlink">Creating a new OpenRefine project</a><a class="headerlink" href="#creating-a-new-openrefine-project" title="Link to this heading">¶</a></h4>
<p>As a first step, we need to make sure
that our metadata table contains values that OpenRefine can reconcile with Wikidata’s node labels. Here, we can
use the file names and some regular expression magic to fill the columns:</p>
<figure class="align-default" id="id4">
<a class="reference internal image-reference" href="../_images/abc_metadata.png"><img alt="ABC metadata.tsv with populated columns." src="../_images/abc_metadata.png" style="width: 825.6px; height: 387.20000000000005px;" /></a>
<figcaption>
<p><span class="caption-text">ABC metadata.tsv with populated <code class="docutils literal notranslate"><span class="pre">composer</span></code>, <code class="docutils literal notranslate"><span class="pre">workTitle</span></code>, <code class="docutils literal notranslate"><span class="pre">movementNumber</span></code>, and <code class="docutils literal notranslate"><span class="pre">workNumber</span></code> columns.</span><a class="headerlink" href="#id4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Next, we load the file into OpenRefine, click on <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">»</span></code>, check the preview, adapt the setting for loading the
TSV file if needed (usually it isn’t), name the project and click on <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">project</span> <span class="pre">»</span></code>.</p>
<figure class="align-default" id="id5">
<a class="reference internal image-reference" href="../_images/openrefine_project.png"><img alt="Creating a project by loading the metadata.tsv file into OpenRefine." src="../_images/openrefine_project.png" style="width: 484.0px; height: 274.40000000000003px;" /></a>
<figcaption>
<p><span class="caption-text">Creating a project by loading the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file into OpenRefine.</span><a class="headerlink" href="#id5" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="reconciling-a-column">
<h4><a class="toc-backref" href="#id49" role="doc-backlink">Reconciling a column</a><a class="headerlink" href="#reconciling-a-column" title="Link to this heading">¶</a></h4>
<p>Now we can start reconciling the values of a column by opening it’s menu <code class="docutils literal notranslate"><span class="pre">Reconcile</span> <span class="pre">-&gt;</span> <span class="pre">Start</span> <span class="pre">reconciling...</span></code>.</p>
<figure class="align-default" id="id6">
<a class="reference internal image-reference" href="../_images/openrefine_start.png"><img alt="Opening the reconciliation pane in OpenRefine." src="../_images/openrefine_start.png" style="width: 372.8px; height: 372.0px;" /></a>
<figcaption>
<p><span class="caption-text">Opening the reconciliation pane in OpenRefine.</span><a class="headerlink" href="#id6" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The upcoming pane has a list of services on the left side that should include at least <code class="docutils literal notranslate"><span class="pre">Wikidata</span> <span class="pre">(en)</span></code>, which is
what we click on. OpenRefine tries to guess the item type that the values could be matched with and correctly suggests
<code class="docutils literal notranslate"><span class="pre">Q5</span> <span class="pre">(human)</span></code>. Since the correct type Q5 is already selected we can go ahead with <code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">reconciling...</span></code>. Once
the process is complete, a new facet appears on the left side that lets us view the different types of match results.
In this example, all 70 movements have type <code class="docutils literal notranslate"><span class="pre">none</span></code> and we need to pick the correct item that corresponds to the
composer in question.</p>
<figure class="align-default" id="id7">
<a class="reference internal image-reference" href="../_images/openrefine_match.png"><img alt="Selecting the corresponding Wikidata item." src="../_images/openrefine_match.png" style="width: 779.8px; height: 236.6px;" /></a>
<figcaption>
<p><span class="caption-text">Selecting the corresponding Wikidata item to automatically assign it to all cells.</span><a class="headerlink" href="#id7" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Sometimes, OpenRefine does not suggest any item. In this case, supposing an item does indeed exist, we can go to
the column’s menu <code class="docutils literal notranslate"><span class="pre">Reconcile</span> <span class="pre">-&gt;</span> <span class="pre">Actions</span> <span class="pre">-&gt;</span> <span class="pre">Match</span> <span class="pre">all</span> <span class="pre">filtered</span> <span class="pre">cells</span> <span class="pre">to...</span></code> and manually search for the item.</p>
<p>Once everything has been correctly matched, we can automatically create a new column to store the Q-numbers.
This is as easy as accessing the column menu <code class="docutils literal notranslate"><span class="pre">Reconcile</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">entity</span> <span class="pre">identifiers</span> <span class="pre">column...</span></code>. When asked for the
new column name, we use the
<a class="reference external" href="https://www.wikidata.org/wiki/Help:QuickStatements#CSV_file_syntax">QuickStatements CSV logic</a> which boils down to
thinking of each row as the subject of a <code class="docutils literal notranslate"><span class="pre">(subject,</span> <span class="pre">verb,</span> <span class="pre">object)</span></code> triple, and storing <code class="docutils literal notranslate"><span class="pre">object</span></code> Q-numbers in
<code class="docutils literal notranslate"><span class="pre">verb</span></code> columns. In this example, we are storing Q-numbers that correspond to the pieces’
<a class="reference external" href="https://www.wikidata.org/wiki/Property:P86">‘composer’ property</a> and therefore we name the new column
<code class="docutils literal notranslate"><span class="pre">P86</span> <span class="pre">(composer)</span></code>:</p>
<figure class="align-default" id="id8">
<a class="reference internal image-reference" href="../_images/openrefine_composer_ids.png"><img alt="Metadata table with the newly created column &quot;P86 (composer)&quot; pointing to the matched Q-number(s)." src="../_images/openrefine_composer_ids.png" style="width: 198.79999999999998px; height: 265.3px;" /></a>
<figcaption>
<p><span class="caption-text">Metadata table with the newly created column <code class="docutils literal notranslate"><span class="pre">P86</span> <span class="pre">(composer)</span></code> pointing to the matched Q-number(s).</span><a class="headerlink" href="#id8" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The result can now easily written back to the original file using the menu <code class="docutils literal notranslate"><span class="pre">Export</span> <span class="pre">-&gt;</span> <span class="pre">Tab-separated</span> <span class="pre">value</span></code> in order
to then insert the new values into the MuseScore files. Please make sure to check the diff of the updated
<code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> before committing to prevent committing unwanted changes or, even worse, having them written
into the scores.</p>
</section>
<section id="reconciling-the-worktitle-column">
<h4><a class="toc-backref" href="#id50" role="doc-backlink">Reconciling the <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> column</a><a class="headerlink" href="#reconciling-the-worktitle-column" title="Link to this heading">¶</a></h4>
<p>Many Wikidata items can be expected to bear labels such as <code class="docutils literal notranslate"><span class="pre">String</span> <span class="pre">Quartet</span> <span class="pre">No.</span> <span class="pre">1</span></code> and therefore there is quite some
ambiguity involved in matching. Since we have already reconciled the <code class="docutils literal notranslate"><span class="pre">composer</span></code> column, we can use it to constrain
the reconciliation of the <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> column to pieces that have been composed by Beethoven.</p>
<p>To achieve that, we bring up the reconciliation pane and, once more, OpenRefine correctly infers the type of the
items that we are trying to match, <code class="docutils literal notranslate"><span class="pre">Q105543609</span> <span class="pre">(musical</span> <span class="pre">work/composition)</span></code>. On the right side, we assign the
property <code class="docutils literal notranslate"><span class="pre">P86</span> <span class="pre">(composer)</span></code> to the <code class="docutils literal notranslate"><span class="pre">composer</span></code> column by typing <code class="docutils literal notranslate"><span class="pre">composer</span></code> and selecting the correct property.</p>
<figure class="align-default" id="id9">
<a class="reference internal image-reference" href="../_images/openrefine_constrain.png"><img alt="Matching the workTitle column constraint by the reconciled composer column." src="../_images/openrefine_constrain.png" style="width: 629.3px; height: 410.2px;" /></a>
<figcaption>
<p><span class="caption-text">Matching the workTitle column constraint by the reconciled composer column.</span><a class="headerlink" href="#id9" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>In this case, we can try to additionally use the <code class="docutils literal notranslate"><span class="pre">workNumber</span></code> column. This makes sense without prior reconciliation
because the corresponding property <code class="docutils literal notranslate"><span class="pre">P10855</span> <span class="pre">(opus</span> <span class="pre">number)</span></code> has a literal data type, string. In other words,
Wikidata users populate this property with free text rather than with a Q-number. We cannot be sure that the property
is present at all and, if it is, whether the strings follow a consistent format. Another source of inconsistency
could be a confusion with <code class="docutils literal notranslate"><span class="pre">P528</span> <span class="pre">(catalog</span> <span class="pre">code)</span></code>,
<a class="reference external" href="https://www.wikidata.org/wiki/Wikidata:Property_proposal/opus_number#%7B%7Bint%3ATalk%7D%7D">as discussed here</a>.
In an ideal world we would not only consume metadata from the knowledge graph but also help cleaning it up for our
domain…..</p>
<figure class="align-default" id="id10">
<a class="reference internal image-reference" href="../_images/openrefine_work_ids.png"><img alt="Matching Beethoven string quartets with the correct Wikidata items." src="../_images/openrefine_work_ids.png" style="width: 590.8px; height: 301.0px;" /></a>
<figcaption>
<p><span class="caption-text">Matching Beethoven string quartets with the correct Wikidata items.</span><a class="headerlink" href="#id10" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The screenshot shows that 53 were matched automatically and 17 are ambiguous. In theory we could automatically
match them based on their match score but, as we can see, this would wrongly match our <code class="docutils literal notranslate"><span class="pre">String</span> <span class="pre">Quartet</span> <span class="pre">No.</span> <span class="pre">15</span></code>
with the item <code class="docutils literal notranslate"><span class="pre">Q270886</span> <span class="pre">(String</span> <span class="pre">Quartet</span> <span class="pre">No.</span> <span class="pre">8)</span></code>, meaning we need to go through the works and select the right match
carefully. However, once we have matched No. 15 with the correct item and see that for the other ambiguous pieces
the correct items have the highest match score respectively, we can use the
<code class="docutils literal notranslate"><span class="pre">Reconcile</span> <span class="pre">-&gt;</span> <span class="pre">Actions</span> <span class="pre">-&gt;</span> <span class="pre">Match</span> <span class="pre">each</span> <span class="pre">cell</span> <span class="pre">to</span> <span class="pre">its</span> <span class="pre">best</span> <span class="pre">candidate</span></code> shortcut to finalize the task.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the name of thoroughness, we also need to take a look at the automatically matched items to avoid
false positives.</p>
</div>
</section>
<section id="pulling-additional-information">
<h4><a class="toc-backref" href="#id51" role="doc-backlink">Pulling additional information</a><a class="headerlink" href="#pulling-additional-information" title="Link to this heading">¶</a></h4>
<p>Obviously, with all cells having the same composer value we would have been faster to create the <code class="docutils literal notranslate"><span class="pre">P86</span> <span class="pre">(composer)</span></code>
column manually, filling in the value <code class="docutils literal notranslate"><span class="pre">Q255</span></code> for all cells. But using
OpenRefine gives us the advantage that, once reconciled, we can pull additional information on the composer item
from the Wikidata knowledge graph. For that we simply access the matched composer column’s menu
<code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">column</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">columns</span> <span class="pre">from</span> <span class="pre">reconciled</span> <span class="pre">values</span></code> which will lead us to a list of properties that we can simply
click on to create additional columns. For example, we can easily add columns called
“country of citizenship”, “native language”, “place of birth”, “place of death” and “religion or worldview”.</p>
<p>This step can be repeated for the added columns. The screenshot shows the column <code class="docutils literal notranslate"><span class="pre">country</span></code> that was created by
pulling the property <code class="docutils literal notranslate"><span class="pre">P17</span> <span class="pre">(country)</span></code> for the <code class="docutils literal notranslate"><span class="pre">Electorate</span> <span class="pre">of</span> <span class="pre">Cologne</span></code> items. In addition the columns
<code class="docutils literal notranslate"><span class="pre">MusicBrainz</span> <span class="pre">work</span> <span class="pre">ID</span></code>, <code class="docutils literal notranslate"><span class="pre">publication</span> <span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">tonality</span></code>, and <code class="docutils literal notranslate"><span class="pre">IMSLP</span> <span class="pre">ID</span></code> have been created from the
reconciled work IDs.</p>
<figure class="align-default" id="id11">
<a class="reference internal image-reference" href="../_images/openrefine_result.png"><img alt="Additional columns pulled from the Wikidata knowledge graph based on the reconciled composer items." src="../_images/openrefine_result.png" style="width: 1204.0px; height: 784.6999999999999px;" /></a>
<figcaption>
<p><span class="caption-text">Additional columns pulled from the Wikidata knowledge graph based on the reconciled composer items;
displayed for the 16 first movements.</span><a class="headerlink" href="#id11" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>After exporting the newly gained values to our original <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code>, we can process them further, for example,</p>
<ul class="simple">
<li><p>by turning the publication dates that come in ISO format into our default
<a class="reference internal" href="#composition-year-columns"><span class="std std-ref">composition year columns</span></a> which contain only a year number;</p></li>
<li><p>by integrating the values in the <code class="docutils literal notranslate"><span class="pre">tonality</span></code> column into the <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> column (to get something along the lines
of <code class="docutils literal notranslate"><span class="pre">String</span> <span class="pre">Quartet</span> <span class="pre">No.</span> <span class="pre">1</span> <span class="pre">in</span> <span class="pre">F</span> <span class="pre">major</span></code>, for example);</p></li>
<li><p>by renaming the column <code class="docutils literal notranslate"><span class="pre">IMSLP</span> <span class="pre">ID</span></code> to its default name <code class="docutils literal notranslate"><span class="pre">imslp</span></code>;</p></li>
<li><p>by using the column <code class="docutils literal notranslate"><span class="pre">MusicBrainz</span> <span class="pre">work</span> <span class="pre">ID</span></code> for automatically retrieving IDs for the individual movements for our
default column <code class="docutils literal notranslate"><span class="pre">musicbrainz</span></code>; as well as values for the column <code class="docutils literal notranslate"><span class="pre">movementTitle</span></code>, for example.</p></li>
</ul>
</section>
<section id="future-work-sub-work-level-items">
<h4><a class="toc-backref" href="#id52" role="doc-backlink">Future work: Sub-work-level items</a><a class="headerlink" href="#future-work-sub-work-level-items" title="Link to this heading">¶</a></h4>
<p>Wikidata has a simple mechanism for linking a work to its parts, such as movements. Consider for example the item
for Joseph Haydn’s Trumpet Concerto in E-flat major, Hob. VIIe:1, <a class="reference external" href="https://www.wikidata.org/wiki/Q1585960">Q1585960</a>.
The property <code class="docutils literal notranslate"><span class="pre">P527</span> <span class="pre">(has</span> <span class="pre">part(s))</span></code> links it to the three items that represent its three movements, each of which is
linked to its parent item via <code class="docutils literal notranslate"><span class="pre">P361</span> <span class="pre">(part</span> <span class="pre">of)</span></code>. The problem is that in the majority of cases, such sub-work-level
items do not exist yet. MusicBrainz work IDs, on the other hand, are often available (because they are required
to identify CD tracks). Once we have reconciled our scores representing individual movements with Wikidata work IDs,
it would be actually a small step to go ahead and create items for the movements automatically via OpenRefine.
We should consider doing this at least for the cases where sub-work-level IDs are already available on
MusicBrainz. We could also consider to link the items to our scores in one go.</p>
</section>
</section>
</section>
<section id="finalizing-a-repository-for-publication">
<h2><a class="toc-backref" href="#id53" role="doc-backlink">Finalizing a repository for publication</a><a class="headerlink" href="#finalizing-a-repository-for-publication" title="Link to this heading">¶</a></h2>
<p>This section describes some of the steps that might be necessary to clean up a repository and make it presentable to
the public. Rather than a fixed sequence of steps, this process is driven by the expected shape and completeness
allowing the repo to qualify as uniform with other published DCML corpora. It requires knowledge of the commandline,
very good familiarity with git, and experience with using <code class="docutils literal notranslate"><span class="pre">ms3</span></code> commands.</p>
<p>This section is from July 2023 and coined to the particular case where a long range of repos need to be (carfully)
updated with new filenames &amp; additional JSON metadata files generated by the bleeding-edge <code class="docutils literal notranslate"><span class="pre">ms3</span></code> version 2. It
requires being able to use both the old <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">1.2.12</span></code> and the latest version in alternation, e.g. using virtual
environments or <code class="docutils literal notranslate"><span class="pre">pipx</span></code> (see below). To date, it also requires access to DCML’s private repos.</p>
<p>In a nutshell:</p>
<ol class="arabic simple">
<li><p>All currently ongoing work needs to be <a class="reference internal" href="#ongoing-work"><span class="std std-ref">finalized</span></a> first before the repo itself can be finalized.</p></li>
<li><p>(Work package type <code class="docutils literal notranslate"><span class="pre">Harmonize</span> <span class="pre">repo</span> <span class="pre">structure</span> <span class="pre">&amp;</span> <span class="pre">versions</span></code>) The repository <a class="reference internal" href="#repo-structure"><span class="std std-ref">structure</span></a> needs
to be checked and updated if necessary. Once the PR is merged, the remaining two work packages can be addressed
in parallel:</p></li>
<li><p>(WP type <code class="docutils literal notranslate"><span class="pre">Eliminate</span> <span class="pre">warnings</span></code>) All warnings need to be <a class="reference internal" href="#eliminating-warnings"><span class="std std-ref">eliminated</span></a> and</p></li>
<li><p>(WP type <code class="docutils literal notranslate"><span class="pre">Metadata</span></code>) the metadata needs <a class="reference internal" href="#finalizing-metadata"><span class="std std-ref">finalizing</span></a>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a general principle, whenever you discover an oddity concerning a repository and/or a particular score which
will need to be fixed at a later point, please create a concise issue making ample use of screenshots. This does
not include anomalies that are covered by a WARNING message.</p>
</div>
<p>As a running example, let’s consider this
<a class="reference external" href="https://github.com/DCMLab/peri_euridice/tree/2129571849c267bee97d293b8fcc9fc3a27603b8">pre-clean commit of peri_euridice</a>.</p>
<section id="finalize-ongoing-work">
<span id="ongoing-work"></span><h3><a class="toc-backref" href="#id54" role="doc-backlink">Finalize ongoing work</a><a class="headerlink" href="#finalize-ongoing-work" title="Link to this heading">¶</a></h3>
<section id="check-openproject">
<h4><a class="toc-backref" href="#id55" role="doc-backlink">0. Check OpenProject</a><a class="headerlink" href="#check-openproject" title="Link to this heading">¶</a></h4>
<p>If there are work packages for this repo, we should make sure that all of them have been marked as “Done”.</p>
<figure class="align-default" id="id12">
<a class="reference internal image-reference" href="../_images/peri_workpackages_done.png"><img alt="Screenshot from OpenProject showing that all work packages for the repo have been marked as &quot;Done&quot;." src="../_images/peri_workpackages_done.png" style="width: 398.29999999999995px; height: 221.2px;" /></a>
<figcaption>
<p><span class="caption-text">Screenshot from OpenProject showing that all work packages for the repo have been marked as “Done”.</span><a class="headerlink" href="#id12" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="addressing-open-pull-requests">
<h4><a class="toc-backref" href="#id56" role="doc-backlink">1. Addressing open Pull Requests</a><a class="headerlink" href="#addressing-open-pull-requests" title="Link to this heading">¶</a></h4>
<p>If there are open PRs, we need to check their nature and ping  the people involved, asking them for progress.</p>
</section>
<section id="check-for-unmerged-branches">
<h4><a class="toc-backref" href="#id57" role="doc-backlink">2. Check for unmerged branches</a><a class="headerlink" href="#check-for-unmerged-branches" title="Link to this heading">¶</a></h4>
<p>By first clicking on <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">branches</span></code> and then on <code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">branches</span></code>, you see the current state of affairs:</p>
<figure class="align-default" id="id13">
<a class="reference internal image-reference" href="../_images/peri_old_branches.png"><img alt="Screenshot from GitHub showing that there are few stale branches and some that have not been merged." src="../_images/peri_old_branches.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Screenshot from GitHub showing that there are few stale branches and some that have not been merged, including
one open PR.</span><a class="headerlink" href="#id13" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The little bar charts show, towards the left, by how many commits a branch is behind <code class="docutils literal notranslate"><span class="pre">main</span></code> and, towards the right,
by how many commits it is ahead of <code class="docutils literal notranslate"><span class="pre">main</span></code>. If the latter is larger than zero, this branch contains work in progress
that has not been merged yet!</p>
<p>Here is how the branches are to be cleaned up:</p>
<ul class="simple">
<li><p>The branch <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> needs to be ignored entirely and left as it is!</p></li>
<li><p>All branches that are not ahead of <code class="docutils literal notranslate"><span class="pre">main</span></code> should be deleted at this point. This is the case for the six branches
showing that their PR has been merged, their bar charts show zero on the right side.</p></li>
<li><p>If there is still a branch with a PR “Open”, as in the example, that means we haven’t done step 1 yet, i.e., we need
to get all PRs finalized (after merging, the branch can be deleted).</p></li>
<li><p>If there are other branches with work in progress (in the screenshot, <code class="docutils literal notranslate"><span class="pre">scene_0_workflow_update</span></code>), we need to be
extra careful to take the right decision and to check with the author(s).
Several scenarios are possible:</p>
<ul>
<li><p>They are still working on it and we should wait for their work to be reviewed in a PR and then merged.</p></li>
<li><p>The commits are irrelevant and the branch can be deleted.</p></li>
<li><p>The commits have been rebased onto another branch and merged into <code class="docutils literal notranslate"><span class="pre">main</span></code> from there. Rebased commits have
other hashes than their originals so GitHub would not recognize if this the case. That’s why it is important to
remove an original branch if it has been rebased and merged.</p></li>
</ul>
</li>
</ul>
<p>This step is completed once we are left with the branches <code class="docutils literal notranslate"><span class="pre">main</span></code> and <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> only.</p>
</section>
</section>
<section id="update-repository-structure">
<span id="repo-structure"></span><h3><a class="toc-backref" href="#id58" role="doc-backlink">Update repository structure</a><a class="headerlink" href="#update-repository-structure" title="Link to this heading">¶</a></h3>
<div class="caution admonition">
<p class="admonition-title">The short version</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>checkout<span class="w"> </span>main<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>pull
git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>repo_structure
ms31<span class="w"> </span>extract<span class="w"> </span>-M<span class="w"> </span>-N<span class="w"> </span>-X<span class="w"> </span>-F<span class="w"> </span>-D
git<span class="w"> </span>add<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;ms3 extract -M -N -X -F -D (v1.2.12)&quot;</span>
git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span>v1.0<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Corpus fully annotated and extracted with ms3 v1.2.12 before finalizing it for publication&quot;</span>
git<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span>.github<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;removes annotation workflow&quot;</span>
git<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span>tonicizations<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;removes tonicizations&quot;</span>
git<span class="w"> </span>rm<span class="w"> </span>warnings.log<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;removes warnings.log&quot;</span>
</pre></div>
</div>
<p>Manually remove the folders <code class="docutils literal notranslate"><span class="pre">reviewed</span></code>, <code class="docutils literal notranslate"><span class="pre">measures</span></code>, <code class="docutils literal notranslate"><span class="pre">notes</span></code>, and <code class="docutils literal notranslate"><span class="pre">harmonies</span></code> which will be replaced in the
following (don’t commit the deletion separately).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ms32<span class="w"> </span>review<span class="w"> </span>-M<span class="w"> </span>-N<span class="w"> </span>-X<span class="w"> </span>-F<span class="w"> </span>-D<span class="w"> </span>-c<span class="w"> </span>v1.0
git<span class="w"> </span>add<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;ms3 review -M -N -X -F -D -c v1.0 (v2.1.1)&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>--atomic
</pre></div>
</div>
</div>
<p>All steps in this section are to be performed locally and, once completed, to be merged through a reviewed PR. This
section requires using two different versions of <code class="docutils literal notranslate"><span class="pre">ms3</span></code>, namely the latest 1.x version, <code class="docutils literal notranslate"><span class="pre">ms3&lt;2.0.0</span></code>, and the latest
2.x version, <code class="docutils literal notranslate"><span class="pre">ms3&gt;=2</span></code>. This can be achieved by using virtual environments. One very practical solution to this,
which we use in this documentation, is through the <code class="docutils literal notranslate"><span class="pre">pipx</span></code> package. It lets us install the two different versions and
add a suffix to each so we have both versions available without having to switch environments.
After <a class="reference external" href="https://pypa.github.io/pipx/installation/">installing pipx</a>, we use the following setup:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pipx<span class="w"> </span>install<span class="w"> </span>--suffix<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s2">&quot;ms3&lt;2.0.0&quot;</span>
pipx<span class="w"> </span>install<span class="w"> </span>--suffix<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;ms3&gt;=2.0.0&quot;</span>
</pre></div>
</div>
<p>This lets us use the old version as <code class="docutils literal notranslate"><span class="pre">ms31</span></code> and the new one as <code class="docutils literal notranslate"><span class="pre">ms32</span></code>. We can check our setup via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pipx<span class="w"> </span>list
<span class="c1"># Output (latest versions as per the 17th of July 2023):</span>
<span class="c1"># package ms3 1.2.12 (ms31), installed using Python 3.10.11</span>
<span class="c1">#  - ms31</span>
<span class="c1"># package ms3 2.0.0 (ms32), installed using Python 3.10.11</span>
<span class="c1">#  - ms32</span>
</pre></div>
</div>
<p>And we can test the commands like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ms31<span class="w"> </span>--version
<span class="c1"># Output: 1.2.12</span>
ms32<span class="w"> </span>--version
<span class="c1"># Output: 2.0.0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please upgrade your <code class="docutils literal notranslate"><span class="pre">ms32</span></code> frequently to the latest version of ms3 version 2 by executing
<code class="docutils literal notranslate"><span class="pre">pipx</span> <span class="pre">install</span> <span class="pre">--force</span> <span class="pre">--pip-args=-U</span> <span class="pre">--suffix</span> <span class="pre">2</span> <span class="pre">&quot;ms3&gt;=2.0.0&quot;</span></code>.</p>
</div>
<section id="re-extract-everything-and-create-a-version-tag">
<h4><a class="toc-backref" href="#id59" role="doc-backlink">3. Re-extract everything and create a version tag</a><a class="headerlink" href="#re-extract-everything-and-create-a-version-tag" title="Link to this heading">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Version tags are attached to one particular commit and can be used instead of the commit SHA to refer to it.
This is particularly useful in the present context when the <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span></code> command is called with the
<code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">[GIT_REVISION]</span></code> flag which allows us, for example, to create a comparison between the current version and
the version tagged “v1.0” by calling <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span> <span class="pre">-c</span> <span class="pre">v1.0</span></code>.</p>
</div>
<p>Now that there is no work in progress is the perfect time for creating a version tag in order to describe the current
status of the repository for future reference. The documentation assumes that you have checked out and pulled <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p>
<p>From here, we create the new branch, e.g. “repo_structure”, which will take all commits added in the following
sections.</p>
<section id="a-re-extract-everything">
<h5><a class="toc-backref" href="#id60" role="doc-backlink">3a) Re-extract everything</a><a class="headerlink" href="#a-re-extract-everything" title="Link to this heading">¶</a></h5>
<p>Before we pin a version number to the current state of the repository, and before updating it with ms3 v2, we extract
the default TSV facets one last time with ms3 v1 by executing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ms31<span class="w"> </span>extract<span class="w"> </span>-M<span class="w"> </span>-N<span class="w"> </span>-X<span class="w"> </span>-F<span class="w"> </span>-D
</pre></div>
</div>
<p>(for measure, notes, expanded, form, and metadata). Please make sure that the folders <code class="docutils literal notranslate"><span class="pre">notes</span></code> and <code class="docutils literal notranslate"><span class="pre">measures</span></code>
contain the same number of TSV files as the folder <code class="docutils literal notranslate"><span class="pre">MS3</span></code> contains MSCX files and that the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> contains
that same number of rows (plus one for the column headers). If this is not the case, please refer to the first point
under <a class="reference internal" href="#metadata-tsv"><span class="std std-ref">metadata.tsv</span></a> and/or ask on Mattermost how to proceed.</p>
<p>Then we commit everything with the message <code class="docutils literal notranslate"><span class="pre">&quot;ms3</span> <span class="pre">extract</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">(v1.2.12)&quot;</span></code>
(assuming that the latest v1 is <code class="docutils literal notranslate"><span class="pre">v1.2.12</span></code>).</p>
</section>
<section id="b-assign-a-version-tag">
<span id="version-tags"></span><h5><a class="toc-backref" href="#id61" role="doc-backlink">3b) Assign a version tag</a><a class="headerlink" href="#b-assign-a-version-tag" title="Link to this heading">¶</a></h5>
<p>The syntax is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span>&lt;version&gt;<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;&lt;description&gt;&quot;</span>
</pre></div>
</div>
<p>Every version number has the form <code class="docutils literal notranslate"><span class="pre">v&lt;ms3&gt;.&lt;counter&gt;</span></code>, which means it</p>
<ul class="simple">
<li><p>starts with a “v” (for “version”)</p></li>
<li><p>is followed by the major version of ms3 used to extract the data (i.e., “0” for ms3&lt;1.0.0, “1” for versions 1.0.0 -
1.2.12, and “2” for versions &gt;= 2.0.0)</p></li>
<li><p>followed by a dot</p></li>
<li><p>and a monotonic counter starting from 0 that is incremented by one for every new version.</p></li>
</ul>
<p>In the default case, right now, the current version has been extracted through the workflow with <code class="docutils literal notranslate"><span class="pre">ms3</span></code> version 1.
If you want to be sure you can either</p>
<ul class="simple">
<li><p>check the column <code class="docutils literal notranslate"><span class="pre">ms3_version</span></code> in <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code>, or</p></li>
<li><p>the file extensions of the TSV files: Starting with version 2, they include the facet name such that, for example,
all files in the folder <code class="docutils literal notranslate"><span class="pre">notes</span></code> end with <code class="docutils literal notranslate"><span class="pre">.notes.tsv</span></code>. If this is not the case, as is expected, the new
version should start with “1”.</p></li>
</ul>
<p>In order to find out the next version number, we need to look at the existing tags. We can see the full list with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>tag<span class="w"> </span>-n
</pre></div>
</div>
<p>And we can see the latest version with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>git<span class="w"> </span>describe<span class="w"> </span>--tags<span class="w"> </span>--abbrev<span class="o">=</span><span class="m">0</span><span class="w">        </span><span class="c1"># for the tag only</span>
v2.0
</pre></div>
</div>
<p>which will output “fatal: No names found, cannot describe anything.” if there are no tags yet. Depending on the output
we assign:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">v1.0</span></code> if there are no tags yet or only tags starting with “v0”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v1.1</span></code> if the latest tag is <code class="docutils literal notranslate"><span class="pre">v1.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v1.10</span></code> if the latest tag is <code class="docutils literal notranslate"><span class="pre">v1.9</span></code></p></li>
<li><p>etc.</p></li>
</ul>
<p>We assign the tag to the current commit together with a message (just like in a commit), for example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span>v1.0<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Corpus fully annotated and extracted with ms3 v1.2.12 before finalizing it for publication&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>--tags
</pre></div>
</div>
<p>The second command pushes the tag to GitHub (but we don’t create the Pull Request yet, only after step 5).</p>
<p>Please note that this specification has been newly added (July 2023) and you may encounter a repository that has
already a version above “v1”: In such a case, please discuss with DCML members how to proceed.</p>
</section>
</section>
<section id="remove-the-automated-github-workflow-and-all-deprecated-files">
<h4><a class="toc-backref" href="#id62" role="doc-backlink">4. Remove the automated GitHub workflow and all deprecated files</a><a class="headerlink" href="#remove-the-automated-github-workflow-and-all-deprecated-files" title="Link to this heading">¶</a></h4>
<p>Now that we have pinned the version, we can start streamlining the repository structur.
During finalization we will be performing the workflow tasks manually
using the <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span></code> command. So we want to first
<strong>deactivate the GitHub actions</strong> by simply removing the folder <code class="docutils literal notranslate"><span class="pre">.github</span></code> (using the command <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rm</span> <span class="pre">-r</span> <span class="pre">.github</span></code>)
and committing the change.</p>
<p><strong>Important update (September 2023)</strong></p>
<p>At this point, it is important to prevent the automatic re-installation of the workflow by the automatic
<a class="reference external" href="https://github.com/DCMLab/workflow_deployment/">workflow_deployment</a>. The relevant change needs to be committed
to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch of this repo and consists in deleting a value in the file <code class="docutils literal notranslate"><span class="pre">all_subcorpora.csv</span></code>, namely:</p>
<ul class="simple">
<li><p>in the row corresponding to the corpus repository in question</p></li>
<li><p>removing the value in the column <code class="docutils literal notranslate"><span class="pre">workflow_version</span></code>;</p></li>
<li><p>in case the workflow is to be automatically replaced with the lastest workflow version, instead of removing the value,
the cell should be overwritten with the value <code class="docutils literal notranslate"><span class="pre">latest</span></code>.</p></li>
</ul>
<p>Then we streamline the repository to harmonize it with the other ones.
By default, every repo should come with the files</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">README.md</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code></p></li>
</ul>
<p>and with the folders</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MS3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">harmonies</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">measures</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">notes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pdf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reviewed</span></code></p></li>
</ul>
<p>each containing one file per row in <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> (with the exception of <code class="docutils literal notranslate"><span class="pre">pdf</span></code> which often includes fewer files).
If form annotations are present, the repo will also have a <code class="docutils literal notranslate"><span class="pre">form_labels</span></code> folder. Apart from that,
some repos might also include some of the following files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.gitignore</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IGNORED_WARNINGS</span></code></p></li>
</ul>
<p>They should be left untouched.</p>
<p>Things to be removed, if present (one commit for each list item):</p>
<ul class="simple">
<li><p>the folder <code class="docutils literal notranslate"><span class="pre">tonicizations</span></code></p></li>
<li><p>top-level files ending on <code class="docutils literal notranslate"><span class="pre">.log</span></code></p></li>
<li><p>in the <code class="docutils literal notranslate"><span class="pre">MS3</span></code> folder: Files ending on <code class="docutils literal notranslate"><span class="pre">_reviewed.mscx</span></code> (in the Peri case here there were two of them).</p></li>
</ul>
<p>Once again, you can use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rm</span> <span class="pre">&lt;file&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rm</span> <span class="pre">-r</span> <span class="pre">&lt;folder&gt;</span></code> and commit each deletion separately.</p>
<p>For all other things, please ask on Mattermost before deleting.</p>
<p>The command sequence used in the present Peri example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>rm<span class="w"> </span>MS3/*_reviewed.mscx
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;removes superfluous _reviewed files&quot;</span>
git<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span>.github
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;removes annotation workflow&quot;</span>
git<span class="w"> </span>rm<span class="w"> </span>warnings.log
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;removes warnings.log&quot;</span>
git<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span>tonicizations
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;removes tonicizations&quot;</span>
</pre></div>
</div>
</section>
<section id="update-the-extracted-files-to-ms3-version-2">
<span id="update-with-ms32"></span><h4><a class="toc-backref" href="#id63" role="doc-backlink">5. Update the extracted files to ms3 version 2</a><a class="headerlink" href="#update-the-extracted-files-to-ms3-version-2" title="Link to this heading">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Annotators are familiar with the comparisons between labels in the <code class="docutils literal notranslate"><span class="pre">_reviewed.mscx</span></code> files in the <code class="docutils literal notranslate"><span class="pre">reviewed</span></code>
folder. So far, these comparisons have been used, rather ineffectively, to display the differences from one push
to another in the same pull request. Now, August 2023, we are starting to make better use of this principle, by
accumulating all differences between the current set of labels and those at the time of the last version tag.
In the future, this will become part of the semi-automated DCML annotation workflow, but, for now, we achieve this
by passing the flag <code class="docutils literal notranslate"><span class="pre">-c</span></code> to the <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span></code> command (which, in return, passes it to <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">compare</span></code> in the
background). Without passing a Git revision to the flag, the comparison would be performed against the set of TSVs
currently present in the <code class="docutils literal notranslate"><span class="pre">harmonies</span></code> folder (which was what happened during a PR with annotation labels). In the
present context, however, we want to pass a git revision, which could be a commit SHA (full or shortened), a branch
name, Git sugar such as <code class="docutils literal notranslate"><span class="pre">HEAD~2</span></code> (two commits before the current one), or, importantly, a tag.</p>
</div>
<p>With the repo readily streamlined we update the data to ms3 v2 in three steps:</p>
<ul class="simple">
<li><p>First, we delete the folders <code class="docutils literal notranslate"><span class="pre">reviewed</span></code>, <code class="docutils literal notranslate"><span class="pre">measures</span></code>, <code class="docutils literal notranslate"><span class="pre">notes</span></code>, and <code class="docutils literal notranslate"><span class="pre">harmonies</span></code> (and any other facet folders
that might be present, such as <code class="docutils literal notranslate"><span class="pre">form_labels</span></code>), without committing the change (e.g., in your file browser).</p></li>
<li><p>Then we find out (or remember) the latest v1.x <a class="reference internal" href="#version-tags"><span class="std std-ref">version tag</span></a>, let’s assume its <code class="docutils literal notranslate"><span class="pre">v1.0</span></code>, and
run <code class="docutils literal notranslate"><span class="pre">ms32</span> <span class="pre">review</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">-c</span> <span class="pre">v1.0</span></code>.</p></li>
<li><p>commit everything with the message <code class="docutils literal notranslate"><span class="pre">&quot;ms3</span> <span class="pre">review</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">-c</span> <span class="pre">v1.0</span> <span class="pre">(v2.1.1)&quot;</span></code>, i.e., the command you have
executed, followed by the ms3 version number that was used.</p></li>
</ul>
<p>The review command will also create <code class="docutils literal notranslate"><span class="pre">.warnings</span></code> files in the <code class="docutils literal notranslate"><span class="pre">reviewed</span></code> folder which reflect the health of the
dataset.</p>
<p>The branch is now ready to be reviewed and then merged through a Pull Request:</p>
<figure class="align-default" id="id14">
<a class="reference internal image-reference" href="../_images/peri_harmonization_pr.png"><img alt="Screenshot showing a Pull Request harmonizing the repository by deleting and updating files." src="../_images/peri_harmonization_pr.png" style="width: 713.6px; height: 492.8px;" /></a>
<figcaption>
<p><span class="caption-text">Screenshot showing a Pull Request harmonizing the repository by deleting and updating files. Note that the
description links the PR to the work package on OpenProject and that the label corresponds to the work package type.</span><a class="headerlink" href="#id14" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Once the PR has been created, you can update the work package status to “Needs review”.
Only when the PR has been reviewed and merged can we proceed with either metadata cleaning or eliminating warnings.
The person who merges should then assign a new version tag,
e.g. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span> <span class="pre">-a</span> <span class="pre">v2.0</span> <span class="pre">-m</span> <span class="pre">&quot;Extracted</span> <span class="pre">facets</span> <span class="pre">using</span> <span class="pre">ms3</span> <span class="pre">version</span> <span class="pre">2.1.1&quot;</span></code>.</p>
</section>
</section>
<section id="eliminating-all-warnings">
<span id="eliminating-warnings"></span><h3><a class="toc-backref" href="#id64" role="doc-backlink">Eliminating all warnings</a><a class="headerlink" href="#eliminating-all-warnings" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please keep in mind that the validator is simply a tool for detecting potential problems. If you have checked a
particular place and found that the warning is not justified, please add it to the <a class="reference internal" href="../workflow/workflow.html#ignored-warnings"><span class="std std-ref">IGNORED_WARNINGS</span></a> file, followed
by a concise comment, which <em>can</em> replace the indented warning text following the header that includes the logger name,
but <em>must</em> begin each new line with a TAB. The comment should clarify for future readers why the warning is
ill-founded. If you are not sure, please ask on Mattermost. Over the course of time and based on these questions, we
will complete this section with concrete instructions on how individual warnings should/can be addressed (and/or
fix the validator).</p>
</div>
<p>This work package, once again, is addressed by committing to a single branch which is to be merged via a reviewed
pull request. The status transition works the same way, i.e.</p>
<ul class="simple">
<li><p>accept package –&gt; <code class="docutils literal notranslate"><span class="pre">In</span> <span class="pre">progress</span></code></p></li>
<li><p>create PR –&gt; <code class="docutils literal notranslate"><span class="pre">Needs</span> <span class="pre">review</span></code></p></li>
<li><p>collaborator reviews &amp; merges –&gt; <code class="docutils literal notranslate"><span class="pre">Done</span></code></p></li>
</ul>
<p>This work package, normally, is made available only after finalizing the repo structure, that is, there should be
some v2.x tag. By eliminating all warnings we are creating a new version and want all changes applied to the labels
to be reflected in the <code class="docutils literal notranslate"><span class="pre">_reviewed.mscx</span></code> files (as mentioned in the <a class="reference internal" href="#update-with-ms32"><span class="std std-ref">info box above</span></a>). Hence,
whenever we call <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span></code> (which will be a lot), we need to pass the current version tag to the <code class="docutils literal notranslate"><span class="pre">-c</span></code> flag
(e.g. <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">v2.0</span></code>). The documentation will therefore say <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;version</span> <span class="pre">tag&gt;</span></code> where we fill in the latest version tag.
This we can easily retrieve using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">describe</span> <span class="pre">--tags</span> <span class="pre">--abbrev=0</span></code>.</p>
<p>Since the repository has been updated with <code class="docutils literal notranslate"><span class="pre">ms3</span></code> version 2, only this version should be used for the remaining tasks.
The first step is to create a new branch for the task, e.g. “warnings” and to update the current state of warnings by
using</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">-c</span> <span class="pre">&lt;version</span> <span class="pre">tag&gt;</span></code> (or, if you continue with the setup above,
<code class="docutils literal notranslate"><span class="pre">ms32</span> <span class="pre">review</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">-c</span> <span class="pre">&lt;version</span> <span class="pre">tag&gt;</span></code>) and</p></li>
<li><p>committing the changes (if any) with the message <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">-c</span> <span class="pre">&lt;version</span> <span class="pre">tag&gt;</span> <span class="pre">(v2.1.1)</span></code>, i.e.,
the command you have executed, followed by the ms3 version number that was used.</p></li>
</ul>
<p>Our goal is to eliminate the presence of any file ending on <code class="docutils literal notranslate"><span class="pre">.warnings</span></code> in the <code class="docutils literal notranslate"><span class="pre">reviewed</span></code> folder (they are simple
text files). The review command stores occurring warnings in one such file per piece and deletes those files where all
warnings have been dealt with. In other words, when no <code class="docutils literal notranslate"><span class="pre">&lt;piece&gt;.warnings</span></code> is present, we’re done already (if, however,
you spotted a warning in the output of the review command that wasn’t captured, that’s probably a bug, please let us
know).</p>
<p>Otherwise, we need to fix the warnings one after the other. For more detailed instructions, please refer to the
<a class="reference internal" href="../workflow/workflow.html#warnings"><span class="std std-ref">What to do about the warnings?</span></a> section of the annotation workflow. To quickly sum it up, there are three ways to deal with a warning:</p>
<ul class="simple">
<li><p>Fix it, execute <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">-c</span> <span class="pre">&lt;version</span> <span class="pre">tag&gt;</span> <span class="pre">-i</span> <span class="pre">&lt;filename&gt;</span></code> to see if it has disappeared, and commit
all changes at once.</p></li>
<li><p>Declare it a false positive.</p></li>
<li><p>Create an issue to make sure someone deals with it later.</p></li>
</ul>
<p>Proceed that way until all <code class="docutils literal notranslate"><span class="pre">.warnings</span></code> files are gone (or contain only warnings that you have created an issue for)
and then open a Pull Request for review.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When fixing other people’s labels, please try to intuit the solution that integrates optimally with the
analytical context, i.e. the surrounding labels, rather than what you think would be the optimal solution, because
that would probably entail a complete review to ensure a consistent set of labels. The purpose of this work package
is mainly to get rid of typos and blatant inconsistencies.</p>
</div>
<section id="a-typical-example">
<h4><a class="toc-backref" href="#id65" role="doc-backlink">A typical example</a><a class="headerlink" href="#a-typical-example" title="Link to this heading">¶</a></h4>
<p>The file <code class="docutils literal notranslate"><span class="pre">peri_euridice_scene_1.warnings</span></code> looks as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Warnings<span class="w"> </span>encountered<span class="w"> </span>during<span class="w"> </span>the<span class="w"> </span>last<span class="w"> </span>execution<span class="w"> </span>of<span class="w"> </span>ms3<span class="w"> </span><span class="nv">review</span>
<span class="o">============================================================</span>

INCOMPLETE_MC_WRONGLY_COMPLETED_WARNING<span class="w"> </span><span class="o">(</span><span class="m">3</span>,<span class="w"> </span><span class="m">46</span><span class="o">)</span><span class="w"> </span>ms3.Parse.peri_euridice.peri_euridice_scene_1
<span class="w">  </span>The<span class="w"> </span>incomplete<span class="w"> </span>MC<span class="w"> </span><span class="m">46</span><span class="w"> </span><span class="o">(</span>timesig<span class="w"> </span><span class="m">3</span>/2,<span class="w"> </span>act_dur<span class="w"> </span><span class="m">1</span>/2<span class="o">)</span><span class="w"> </span>is<span class="w"> </span>completed<span class="w"> </span>by<span class="w"> </span><span class="m">1</span><span class="w"> </span>incorrect<span class="w"> </span>duration<span class="w"> </span><span class="o">(</span>expected:<span class="w"> </span><span class="m">1</span><span class="o">)</span>:
<span class="w">  </span><span class="o">{</span><span class="m">47</span>:<span class="w"> </span>Fraction<span class="o">(</span><span class="m">3</span>,<span class="w"> </span><span class="m">1</span><span class="o">)}</span>
FIRST_BAR_MISSING_TEMPO_MARK_WARNING<span class="w"> </span><span class="o">(</span><span class="m">29</span>,<span class="o">)</span><span class="w"> </span>ms3.Parse.peri_euridice.peri_euridice_scene_1
<span class="w">  </span>No<span class="w"> </span>metronome<span class="w"> </span>mark<span class="w"> </span>found<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>very<span class="w"> </span>first<span class="w"> </span>measure<span class="w"> </span>nor<span class="w"> </span>anywhere<span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>score.
<span class="w">  </span>*<span class="w"> </span>Please<span class="w"> </span>add<span class="w"> </span>one<span class="w"> </span>at<span class="w"> </span>the<span class="w"> </span>very<span class="w"> </span>beginning<span class="w"> </span>and<span class="w"> </span>hide<span class="w"> </span>it<span class="w"> </span><span class="k">if</span><span class="w"> </span>it<span class="s1">&#39;s not from the original print edition.</span>
<span class="s1">  * Make sure to choose the rhythmic unit that corresponds to beats in this piece and to set another mark wherever that unit changes.</span>
<span class="s1">  * The tempo marks can be rough estimates, maybe cross-checked with a recording.</span>
<span class="s1">DCML_NON_CHORD_TONES_ABOVE_THRESHOLD_WARNING (19, 64, &#39;</span><span class="m">1</span>/2<span class="s1">&#39;, &#39;</span>VIIM7<span class="s1">&#39;) ms3.Parse.peri_euridice.peri_euridice_scene_1</span>
<span class="s1">  The label &#39;</span>VIIM7<span class="s1">&#39; in m. 62, onset 1/2 (MC 64, onset 1/2) seems not to correspond well to the score (which does not necessarily mean it is wrong).</span>
<span class="s1">  In the context of G.i, it expresses the scale degrees (&#39;</span><span class="m">7</span><span class="s1">&#39;, &#39;</span><span class="m">2</span><span class="s1">&#39;, &#39;</span><span class="m">4</span><span class="s1">&#39;, &#39;</span><span class="c1">#6&#39;) [(&#39;F&#39;, &#39;A&#39;, &#39;C&#39;, &#39;E&#39;)].</span>
<span class="w">  </span>The<span class="w"> </span>corresponding<span class="w"> </span>score<span class="w"> </span>segment<span class="w"> </span>has<span class="w"> </span><span class="m">0</span><span class="w"> </span>within-label<span class="w"> </span>and<span class="w"> </span><span class="m">2</span><span class="w"> </span>out-of-label<span class="w"> </span>note<span class="w"> </span>onsets,<span class="w"> </span>a<span class="w"> </span>ratio<span class="w"> </span>of<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span>.6<span class="w"> </span><span class="o">(</span>the<span class="w"> </span>current,<span class="w"> </span>arbitrary,<span class="w"> </span>threshold<span class="o">)</span>.
<span class="w">  </span>If<span class="w"> </span>it<span class="w"> </span>turns<span class="w"> </span>out<span class="w"> </span>the<span class="w"> </span>label<span class="w"> </span>is<span class="w"> </span>correct,<span class="w"> </span>please<span class="w"> </span>add<span class="w"> </span>the<span class="w"> </span>header<span class="w"> </span>of<span class="w"> </span>this<span class="w"> </span>warning<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>IGNORED_WARNINGS,<span class="w"> </span>ideally<span class="w"> </span>followed<span class="w"> </span>by<span class="w"> </span>a<span class="w"> </span>free-text<span class="w"> </span>comment<span class="w"> </span><span class="k">in</span><span class="w"> </span>subsequent<span class="w"> </span>lines<span class="w"> </span>starting<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>space<span class="w"> </span>or<span class="w"> </span>tab.
DCML_NON_CHORD_TONES_ABOVE_THRESHOLD_WARNING<span class="w"> </span><span class="o">(</span><span class="m">19</span>,<span class="w"> </span><span class="m">72</span>,<span class="w"> </span><span class="s1">&#39;3/2&#39;</span>,<span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="o">)</span><span class="w"> </span>ms3.Parse.peri_euridice.peri_euridice_scene_1
<span class="w">  </span>The<span class="w"> </span>label<span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>m.<span class="w"> </span><span class="m">70</span>,<span class="w"> </span>onset<span class="w"> </span><span class="m">3</span>/2<span class="w"> </span><span class="o">(</span>MC<span class="w"> </span><span class="m">72</span>,<span class="w"> </span>onset<span class="w"> </span><span class="m">3</span>/2<span class="o">)</span><span class="w"> </span>seems<span class="w"> </span>not<span class="w"> </span>to<span class="w"> </span>correspond<span class="w"> </span>well<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>score<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>necessarily<span class="w"> </span>mean<span class="w"> </span>it<span class="w"> </span>is<span class="w"> </span>wrong<span class="o">)</span>.
<span class="w">  </span>In<span class="w"> </span>the<span class="w"> </span>context<span class="w"> </span>of<span class="w"> </span>G.i,<span class="w"> </span>it<span class="w"> </span>expresses<span class="w"> </span>the<span class="w"> </span>scale<span class="w"> </span>degrees<span class="w"> </span><span class="o">(</span><span class="s1">&#39;5&#39;</span>,<span class="w"> </span><span class="s1">&#39;#7&#39;</span>,<span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">[(</span><span class="s1">&#39;D&#39;</span>,<span class="w"> </span><span class="s1">&#39;F#&#39;</span>,<span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="o">)]</span>.
<span class="w">  </span>The<span class="w"> </span>corresponding<span class="w"> </span>score<span class="w"> </span>segment<span class="w"> </span>has<span class="w"> </span><span class="m">0</span><span class="w"> </span>within-label<span class="w"> </span>and<span class="w"> </span><span class="m">2</span><span class="w"> </span>out-of-label<span class="w"> </span>note<span class="w"> </span>onsets,<span class="w"> </span>a<span class="w"> </span>ratio<span class="w"> </span>of<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span>.6<span class="w"> </span><span class="o">(</span>the<span class="w"> </span>current,<span class="w"> </span>arbitrary,<span class="w"> </span>threshold<span class="o">)</span>.
<span class="w">  </span>If<span class="w"> </span>it<span class="w"> </span>turns<span class="w"> </span>out<span class="w"> </span>the<span class="w"> </span>label<span class="w"> </span>is<span class="w"> </span>correct,<span class="w"> </span>please<span class="w"> </span>add<span class="w"> </span>the<span class="w"> </span>header<span class="w"> </span>of<span class="w"> </span>this<span class="w"> </span>warning<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>IGNORED_WARNINGS,<span class="w"> </span>ideally<span class="w"> </span>followed<span class="w"> </span>by<span class="w"> </span>a<span class="w"> </span>free-text<span class="w"> </span>comment<span class="w"> </span><span class="k">in</span><span class="w"> </span>subsequent<span class="w"> </span>lines<span class="w"> </span>starting<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>space<span class="w"> </span>or<span class="w"> </span>tab.
DCML_NON_CHORD_TONES_ABOVE_THRESHOLD_WARNING<span class="w"> </span><span class="o">(</span><span class="m">19</span>,<span class="w"> </span><span class="m">94</span>,<span class="w"> </span><span class="s1">&#39;0&#39;</span>,<span class="w"> </span><span class="s1">&#39;III6&#39;</span><span class="o">)</span><span class="w"> </span>ms3.Parse.peri_euridice.peri_euridice_scene_1
<span class="w">  </span>The<span class="w"> </span>label<span class="w"> </span><span class="s1">&#39;III6&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>m.<span class="w"> </span><span class="m">92</span>,<span class="w"> </span>onset<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">(</span>MC<span class="w"> </span><span class="m">94</span>,<span class="w"> </span>onset<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w"> </span>seems<span class="w"> </span>not<span class="w"> </span>to<span class="w"> </span>correspond<span class="w"> </span>well<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>score<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>necessarily<span class="w"> </span>mean<span class="w"> </span>it<span class="w"> </span>is<span class="w"> </span>wrong<span class="o">)</span>.
<span class="w">  </span>In<span class="w"> </span>the<span class="w"> </span>context<span class="w"> </span>of<span class="w"> </span>G.i,<span class="w"> </span>it<span class="w"> </span>expresses<span class="w"> </span>the<span class="w"> </span>scale<span class="w"> </span>degrees<span class="w"> </span><span class="o">(</span><span class="s1">&#39;5&#39;</span>,<span class="w"> </span><span class="s1">&#39;7&#39;</span>,<span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">[(</span><span class="s1">&#39;D&#39;</span>,<span class="w"> </span><span class="s1">&#39;F&#39;</span>,<span class="w"> </span><span class="s1">&#39;Bb&#39;</span><span class="o">)]</span>.
<span class="w">  </span>The<span class="w"> </span>corresponding<span class="w"> </span>score<span class="w"> </span>segment<span class="w"> </span>has<span class="w"> </span><span class="m">1</span><span class="w"> </span>within-label<span class="w"> </span>and<span class="w"> </span><span class="m">2</span><span class="w"> </span>out-of-label<span class="w"> </span>note<span class="w"> </span>onsets,<span class="w"> </span>a<span class="w"> </span>ratio<span class="w"> </span>of<span class="w"> </span><span class="m">0</span>.6666666666666666<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span>.6<span class="w"> </span><span class="o">(</span>the<span class="w"> </span>current,<span class="w"> </span>arbitrary,<span class="w"> </span>threshold<span class="o">)</span>.
<span class="w">  </span>If<span class="w"> </span>it<span class="w"> </span>turns<span class="w"> </span>out<span class="w"> </span>the<span class="w"> </span>label<span class="w"> </span>is<span class="w"> </span>correct,<span class="w"> </span>please<span class="w"> </span>add<span class="w"> </span>the<span class="w"> </span>header<span class="w"> </span>of<span class="w"> </span>this<span class="w"> </span>warning<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>IGNORED_WARNINGS,<span class="w"> </span>ideally<span class="w"> </span>followed<span class="w"> </span>by<span class="w"> </span>a<span class="w"> </span>free-text<span class="w"> </span>comment<span class="w"> </span><span class="k">in</span><span class="w"> </span>subsequent<span class="w"> </span>lines<span class="w"> </span>starting<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>space<span class="w"> </span>or<span class="w"> </span>tab.
</pre></div>
</div>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">INCOMPLETE_MC_WRONGLY_COMPLETED_WARNING</span></code></dt><dd><p>It turns out that the inconsistency is due to an unconventional, not to say wrong, modernisation of the metric
structure. Since we are not going to fix this right now, we
<a class="reference external" href="https://github.com/DCMLab/peri_euridice/issues/12">create an issue</a> describing the warning, potentially
suggesting a fix, depending on how deep we have looked into the matter. This means that the <code class="docutils literal notranslate"><span class="pre">.warnings</span></code> file will
persist with this warning and later in the pull request we mention the issue (by typing <code class="docutils literal notranslate"><span class="pre">#12</span></code> in this case) to
explain why the .warnings file still exists.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">FIRST_BAR_MISSING_TEMPO_MARK_WARNING</span></code></dt><dd><p>Very frequent warning. We fix it by adding one or several <a class="reference internal" href="../scores/guidelines.html#metronome-marks"><span class="std std-ref">Metronome marks</span></a>. As with all warnings, we save the
changed .mscx file, run <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">-c</span> <span class="pre">2.0</span> <span class="pre">-i</span> <span class="pre">scene_1</span></code> and, if the warning has
disappeared, we commit all changes at once with a message such as “adds metronome mark to first measure” or
“eliminates FIRST_BAR_MISSING_TEMPO_MARK_WARNING” (i.e., no need to mention that <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span></code> was used).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DCML_NON_CHORD_TONES_ABOVE_THRESHOLD_WARNING</span> <span class="pre">(19,</span> <span class="pre">64,</span> <span class="pre">'1/2',</span> <span class="pre">'VIIM7')</span></code></dt><dd><p>As we learn from the warning, the label <code class="docutils literal notranslate"><span class="pre">VIIM7</span></code> of G minor does not match the notes in the score. It turns out that
<code class="docutils literal notranslate"><span class="pre">VIM7</span></code> was meant, so we fix the label, save the file, run <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">review</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span> <span class="pre">-c</span> <span class="pre">2.0</span> <span class="pre">-i</span> <span class="pre">scene_1</span></code> and
commit everything with a message as we would find it in an annotation review, e.g. “62: VIIM7 =&gt; VIM7”.
The files that would typically be modified in such a commit, apart from the score, include</p>
<ul class="simple">
<li><p>the TSV file in <code class="docutils literal notranslate"><span class="pre">harmonies</span></code> (changed label)</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">.warnings</span></code> file in <code class="docutils literal notranslate"><span class="pre">reviewed</span></code> (removed warning)</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">_reviewed.mscx</span></code> file (removed label in red, new label in green, notes colored differently or not anymore)</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">_reviewed.tsv</span></code> file with the updated note colouring report</p></li>
<li><p>if your version of ms3 is newer than that of the last extraction, this will also be reflected in <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code>
and several <code class="docutils literal notranslate"><span class="pre">resource.json</span></code> metadata files.</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DCML_NON_CHORD_TONES_ABOVE_THRESHOLD_WARNING</span> <span class="pre">(19,</span> <span class="pre">72,</span> <span class="pre">'3/2',</span> <span class="pre">'V')</span></code></dt><dd><p>Same as above. Should have been <code class="docutils literal notranslate"><span class="pre">V/VII</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DCML_NON_CHORD_TONES_ABOVE_THRESHOLD_WARNING</span> <span class="pre">(19,</span> <span class="pre">94,</span> <span class="pre">'0',</span> <span class="pre">'III6')</span></code></dt><dd><p>With this warning we demonstrate how to fix a warning that cannot be viewed as false positive, but without having
the change escalate into a full review of the piece.</p>
<figure class="align-default" id="id15">
<a class="reference internal image-reference" href="../_images/peri_scene_1_m91f.png"><img alt="Screenshot showing the Peri example in question, mm. 91-93" src="../_images/peri_scene_1_m91f.png" style="width: 641.4px; height: 523.5px;" /></a>
<figcaption>
<p><span class="caption-text">Screenshot showing <code class="docutils literal notranslate"><span class="pre">peri_euridice_scene_1.mscx</span></code>, mm. 91-93. The label in question is <code class="docutils literal notranslate"><span class="pre">III6</span></code>.</span><a class="headerlink" href="#id15" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><code class="docutils literal notranslate"><span class="pre">III</span></code> in G minor expresses a B major harmony. The music in m. 92 can be interepreted as the beginning of a
B major - F major pendulum (continued in the following bar, not shown). In that sense, the label is inconsistent in
that it covers the entire first half of the bar. At this moment one might be tempted to suggest some different
interpretation of the passage but one should resist it: Otherwise one would have to read through the entire
analysis and perform a full review lest one introduces a new inconsistency. Instead, we content ourselves by
introducing a <code class="docutils literal notranslate"><span class="pre">V/III</span></code> on b. 2, which seems to be the least controversial solution that consistently integrates
with the given context and resolves the warning (“m. 92, b. 2: introduces V/III as minimally invasive fix of the
DCML_NON_CHORD_TONES_ABOVE_THRESHOLD_WARNING”).</p>
<p>If, in addition to this fix, the whole passage strikes us as far-fetched, we could create an issue, potentially
assigning the original annotator to it.</p>
</dd>
</dl>
</section>
</section>
<section id="finalizing-the-metadata">
<span id="finalizing-metadata"></span><h3><a class="toc-backref" href="#id66" role="doc-backlink">Finalizing the metadata</a><a class="headerlink" href="#finalizing-the-metadata" title="Link to this heading">¶</a></h3>
<p>This last and important step has a lot of overlap with <a class="reference internal" href="#enriching-metadata"><span class="std std-ref">Curating and enriching metadata</span></a> above. That is because metadata can
(and should) be added at any given point in time.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/love_note.png"><img alt="Repository settings on GitHub" src="../_images/love_note.png" style="width: 503.09999999999997px; height: 375.59999999999997px;" /></a>
</figure>
<p>If you’re lucky, the repository has been created using the DCML corpus creation
pipeline documented here and the metadata is already in a good state. However, quite a number of repositories
have been created before the inception of this pipeline and have to be brought up to speed.</p>
<p>This section is currently (September 2023) focused on roundabout 20 repositories that have a long and
pretty wild history (which does not always involve a lot of metadata love, unfortunately) so that this task may
involve a considerable amount of detective’s work, digging through commit histories to find out the origin of a file,
comparing a score with one found on musescore.com to discover its original source, etc. The golden rule is: Everything
is allowed as long as it contributes to a better presentable dataset.</p>
<p>The finalization focuses on the following aspects:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="#metadata-tsv"><span class="std std-ref">metadata.tsv</span></a> file and the corresponding metadata fields in the MuseScore files it describes.</p></li>
<li><p>The <a class="reference internal" href="#score-prelims"><span class="std std-ref">Score prelims and instrumentation</span></a>, i.e. the header presenting a movement’s title, composer, as well as the instruments
assigned to each staff (likewise manageable through the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file).</p></li>
<li><p>The <a class="reference internal" href="#template-filling"><span class="std std-ref">README.md</span></a> with some standardized general information and some corpus-specific text
blobs.</p></li>
<li><p>The <a class="reference internal" href="#workflow-deployment-integration"><span class="std std-ref">all_subcorpora.csv</span></a> file that is used to automatically deploy a corpus-specific website based on filling a homepage template with the values
in that table.</p></li>
</ul>
<p>Once a repository is made public, it will additionally undergo the <a class="reference internal" href="#zenodo-integration"><span class="std std-ref">Zenodo integration</span></a> and receive a
<code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> file.</p>
<section id="metadata-tsv">
<span id="id1"></span><h4><a class="toc-backref" href="#id67" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code></a><a class="headerlink" href="#metadata-tsv" title="Link to this heading">¶</a></h4>
<p>Please make sure that the fields documented above under <a class="reference internal" href="#enriching-metadata"><span class="std std-ref">Curating and enriching metadata</span></a> are filled to the best possible extent.
For quick reference:</p>
<dl class="simple">
<dt>Check that <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> contains exactly one row per MuseScore file in the <code class="docutils literal notranslate"><span class="pre">MS3</span></code> folder.</dt><dd><p>Background info: By default, <code class="docutils literal notranslate"><span class="pre">ms3</span></code> commands select only files listed in the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> for parsing,
which is a mechanism that allows for the inclusion of other, auxiliary or corpus-external scores. To be 100% sure
that all files are included we can call  <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span> <span class="pre">-a</span></code>. The only case that that cannot be automatically fixed is
is when <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> contains rows pertaining to files that do not exist anymore (for instance when they have
been renamed or split). In such a case, please delete the corresponding rows manually.</p>
</dd>
<dt>Bring the file up to date using <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code>.</dt><dd><p>Making sure that the TSV file corresponds to the current state of the metadata in the MuseScore files.</p>
</dd>
<dt>Make your edits to the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file, commiting each change individually.</dt><dd><p>For example, add and fill the columns <code class="docutils literal notranslate"><span class="pre">composed_start</span></code>, <code class="docutils literal notranslate"><span class="pre">composed_end</span></code> and <code class="docutils literal notranslate"><span class="pre">composed_source</span></code> and commit them
with the message “adds composition dates” (or similar).</p>
</dd>
<dt>Once all columns have been cleaned to your satisfaction, update the corresponding fields in the MuseScore files.</dt><dd><p>For that you execute <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span></code>, inspect the changes using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> and, if everything is looking good
(e.g., there are no unwanted changes such as newly added but empty XML tags due to a misnamed column),
you re-extract via <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code> (which usually results in a re-ordering of manually added columns and commit
the changes with the message “writes updated metadata into MuseScore files”, or similar.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the correspondence between columns in <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> and fields in the MuseScore files relies on
<em>exact</em> string matching and, to minimize erroneous mismatches, all field names are lowercased. In case you discover
a misspelled column, you can rename (or remove) it and call <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span> <span class="pre">--remove</span></code>. This will remove the
metadata fields (that is, the corresponding XML tags) for which no corresponding column exists in <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code>
from the MuseScore files.</p>
</div>
</section>
<section id="score-prelims-and-instrumentation">
<span id="score-prelims"></span><h4><a class="toc-backref" href="#id68" role="doc-backlink">Score prelims and instrumentation</a><a class="headerlink" href="#score-prelims-and-instrumentation" title="Link to this heading">¶</a></h4>
<p>The prelims are the header of a score that contains information about the piece. In MuseScore, they consist of up to
five text fields which can be arbitrarily arranged within the “Vertical box” at the top of the MuseScore file:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/prelims_tchaikovsky_op37a06.png"><img alt="Prelims of Tchaikovsky op. 37a, no. 6" src="../_images/prelims_tchaikovsky_op37a06.png" style="width: 747.6px; height: 306.6px;" /></a>
</figure>
<p>The values of these fields are extracted and updated just like the metadata fields. The command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code>
writes the values for the existing fields into the columns:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">title_text</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subtitle_text</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lyricist_text</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">composer_text</span></code></p></li>
<li><p>(<code class="docutils literal notranslate"><span class="pre">part_text</span></code>, not used, automatically filled when extracting staves as individual parts such as “Violin II”)</p></li>
</ol>
<p>These columns should appear next to each other in the table so you can see if some of them are not present, in which
case you can simply add those that you want to use. Once you have updated the values in question, you commit the change
to the TSV file first and then run <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span> <span class="pre">--prelims</span></code> in order to write the changes into the file.</p>
<p>Usually you can compose these columns from the metadata fields that you have already cleaned in the previous step. For
example, you can simply copy the <code class="docutils literal notranslate"><span class="pre">composer</span></code> column into <code class="docutils literal notranslate"><span class="pre">composer_text</span></code> column and commit. The lyricist field is
generally used for vocal music; or in special cases such as the Tchaikovsky piece shown above that comes with a poem.
For a dataset of sonatas, the title column could be composed, for example, by using the <code class="docutils literal notranslate"><span class="pre">CONCATENATE</span></code> function of
your spreadsheet in order to combine the <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> column with the <code class="docutils literal notranslate"><span class="pre">workNumber</span></code> column in some meaningful way.</p>
<p>In general, there are two possibilities to use title and subtitle. When unsure, please ask on Mattermost.</p>
<ul class="simple">
<li><p>Title for the work, subtitle for the movement. Would be typical for a sonata movement.</p></li>
<li><p>Title for the part-of-work, subtitle for the cycle, typical for a cycle (as shown above).</p></li>
</ul>
<p>The instrumentation can be changed by filling in default instrument names into the columns for the respective staves,
e.g. <code class="docutils literal notranslate"><span class="pre">staff_1_instrument</span></code> for the upper staff. The new values are written into the document by running
<code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span> <span class="pre">--instrumentation</span></code>.</p>
<p>Once the scores have been updated/created, you will need to open each MuseScore file to check on their visual
arrangement because it does not happen automatically. Please do not modify the default font settings (except for
restoring the defaults) unless strictly necessary.
The arrangement is arbitrary and should be somewhat satisfying visually (again, take the Tchaikovsky example above).
Arranging the layout may involve enlarging the vertical box in the vertical dimension.</p>
<section id="an-example">
<h5><a class="toc-backref" href="#id69" role="doc-backlink">An example</a><a class="headerlink" href="#an-example" title="Link to this heading">¶</a></h5>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Quick reminder to load all columns the TSV files as “Text”, preventing the automatic type inference that modern
spreadsheets are prone to perform, modifying your data without you noticing.</p>
</div>
<p>Let us consider the <a class="reference external" href="https://github.com/DCMLab/wagner_overtures/releases/tag/v2.1">wagner_overtures &#64; v2.1</a> repository.
A glance at the relevant columns of <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> reveals the following situation:</p>
<figure class="align-default" id="id16">
<a class="reference internal image-reference" href="../_images/wagner_metadata_tsv.png"><img alt="Metadata columns related to score prelims and instrumentation that need cleaning up." src="../_images/wagner_metadata_tsv.png" style="width: 98%;" /></a>
<figcaption>
<p><span class="caption-text">Metadata columns related to score prelims and instrumentation that need cleaning up.</span><a class="headerlink" href="#id16" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>1. Inspecting the metadata</strong></p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">title_text</span></code> is defined for both pieces, the <code class="docutils literal notranslate"><span class="pre">subtitle_text</span></code> only for the first one, and the <code class="docutils literal notranslate"><span class="pre">composer_text</span></code>
is missing for both and therefore does not have a column. (<code class="docutils literal notranslate"><span class="pre">lyricist_text</span></code> is not needed in this case.) All present
values encode typesetting information through HTML tags which we want to get rid off.</p></li>
<li><p>The two instrument columns have the value “Piano (2)”, which we want to standardize.</p></li>
</ul>
<p><strong>2. Update ``metadata.tsv`` &amp; commit</strong></p>
<p>The following image shows the updated values:</p>
<figure class="align-default" id="id17">
<a class="reference internal image-reference" href="../_images/wagner_metadata_editing.png"><img alt="Metadata columns related to score prelims and instrumentation after cleaning them up." src="../_images/wagner_metadata_editing.png" style="width: 98%;" /></a>
<figcaption>
<p><span class="caption-text">Metadata columns related to score prelims and instrumentation after cleaning them up.</span><a class="headerlink" href="#id17" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>inserted a <code class="docutils literal notranslate"><span class="pre">composer_text</span></code> column (it does not matter where) and copied the values from the <code class="docutils literal notranslate"><span class="pre">composer</span></code> column</p></li>
<li><p>removed the HTML tags from the <code class="docutils literal notranslate"><span class="pre">title_text</span></code> and <code class="docutils literal notranslate"><span class="pre">subtitle_text</span></code> columns</p></li>
<li><p>as can be seen in the screenshot above, the <code class="docutils literal notranslate"><span class="pre">title_text</span></code> column has been fully re-created using the formula
<code class="docutils literal notranslate"><span class="pre">=CONCATENATE(V2,</span> <span class="pre">&quot;,</span> <span class="pre">&quot;,</span> <span class="pre">Y2)</span></code>, yielding a concatenation of the <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> and <code class="docutils literal notranslate"><span class="pre">workNumber</span></code> columns. This
might seem like an overkill in this two-row example but is very convenient when dealing with larger corpora.</p></li>
<li><p>Moved the subtitle “Vorspiel” from the <code class="docutils literal notranslate"><span class="pre">title_text</span></code> to the <code class="docutils literal notranslate"><span class="pre">subtitle_text</span></code> column for the second piece.</p></li>
<li><p>Changed all instrument values to “Piano” (case insensitive, so “piano” would work as well and would be standardized
while updating the MuseScore files).</p></li>
</ul>
<p>Commit the changes with a commit message such as “updates metadata.tsv with prelims and instrumentation”.</p>
<p><strong>3. Execute ``ms3 metadata –prelims –instrumentation``</strong></p>
<figure class="align-center" id="id18">
<a class="reference internal image-reference" href="../_images/meistersinger_header_before.png"><img alt="Header of the Meistersinger score before cleaning up prelims and instrumentation" src="../_images/meistersinger_header_before.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Header of the Meistersinger score <strong>before</strong> cleaning up prelims and instrumentation.</span><a class="headerlink" href="#id18" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id19">
<a class="reference internal image-reference" href="../_images/meistersinger_header_after.png"><img alt="Header of the Meistersinger score after cleaning up prelims and instrumentation" src="../_images/meistersinger_header_after.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Header of the Meistersinger score <strong>after</strong> cleaning up prelims and instrumentation. Font and positions
correspond to the defaults.</span><a class="headerlink" href="#id19" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id20">
<a class="reference internal image-reference" href="../_images/meistersinger_header_adjusted.png"><img alt="Header of the Meistersinger score after manually adjusting it" src="../_images/meistersinger_header_adjusted.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Header of the Meistersinger Vorspiel after manually adjusting it. See the following section on
<a class="reference internal" href="#adjusting-header"><span class="std std-ref">how to adjust the header</span></a> to make it more appealing.</span><a class="headerlink" href="#id20" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>4. Inspect and commit</strong></p>
<figure class="align-center" id="id21">
<a class="reference internal image-reference" href="../_images/meistersinger_diff.png"><img alt="Diff of the MuseScore file corresponding to the changes made by ``ms3 metadata --prelims --instrumentation``" src="../_images/meistersinger_diff.png" style="width: 98%;" /></a>
<figcaption>
<p><span class="caption-text">Diff of the MuseScore file corresponding to the changes introduced by <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span> <span class="pre">--prelims</span> <span class="pre">--instrumentation</span></code>.
The screenshot is taken from the <a class="reference external" href="https://github.com/DCMLab/wagner_overtures/commit/2965f51f1eab4508e6f52d93f44f616cd535cc9c#diff-d897a19a1076385ca259162d48767a7ad4fc2398af0ba7c96d2e3913c210f06b">commit on GitHub</a>.</span><a class="headerlink" href="#id21" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Check the changes in the MuseScore files by opening them and using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> and.
Everything is alright if</p>
<ul class="simple">
<li><p>the score can still be opened in MuseScore 3 without throwing an error message</p></li>
<li><p>no serious glitch has been introduced (e.g., a clef was replaced with another clef)</p></li>
<li><p>the score is playback with the appropriate instrument sound banks</p></li>
<li><p>the diff does not show any suspicious changes that seem uncalled for</p></li>
</ul>
<p>It is OK for the header at this point to look a bit wonky, we are going to clean it up in the next section.
Suggested commit message: “writes updated prelims and instrumentation into MuseScore files”.</p>
</section>
</section>
<section id="normalizing-score-layout">
<h4><a class="toc-backref" href="#id70" role="doc-backlink">Normalizing score layout</a><a class="headerlink" href="#normalizing-score-layout" title="Link to this heading">¶</a></h4>
<p>Since we have the scores opened already, we might as well give them a few final brushstrokes to standardize how
they look.</p>
<section id="header">
<span id="adjusting-header"></span><h5><a class="toc-backref" href="#id71" role="doc-backlink">Header</a><a class="headerlink" href="#header" title="Link to this heading">¶</a></h5>
<p>The header of the Meistersinger score in the screenshot above has benefitted from the following manual adjustments:</p>
<ol class="arabic simple">
<li><p>The vertical box was enlarged vertically (by selecting it and dragging the handle) for it to fit the default prelims.
This affects the beginning of the music.</p></li>
<li><p>Each score needs to have a metronome marking. This one already had one, but since it’s not part of the
original PDF we need to hide it (select and press <code class="docutils literal notranslate"><span class="pre">V</span></code> as in “visible”). Also, most people will intuitively clap in
halves to this, so this is also a good moment to replace the metronome mark accordingly.</p></li>
<li><p>Upon hiding the tempo marking it disappeared completely, which is a sign that <code class="docutils literal notranslate"><span class="pre">View</span> <span class="pre">-&gt;</span> <span class="pre">Show</span> <span class="pre">invisible</span></code> should be
checked for this score so that hidden elements do not go unnoticed.</p></li>
<li><p>The verbal tempo indication has been completed with the words that were missing from the PDF. Then it was
moved closer to the beginning of the music, as well as the metronome marking (even when hidden, its large
distance from the music was causing a gap).</p></li>
</ol>
<p>These steps uncovered a cascade of other necessities, which is a typical characteristic of the finalization process:</p>
<ul class="simple">
<li><p>The original PDF had been missing, a good occasion to go find and include it.</p></li>
<li><p>Including the PDF from IMSLP involves adding the “reverse lookup” link to the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file (see
<a class="reference internal" href="#enriching-metadata"><span class="std std-ref">Curating and enriching metadata</span></a> above). It turns out that the identifiers have not been added to the metadata yet.
Having the IMSLP page open already leaves us in a good position to add them on the go.</p></li>
<li><p>Those for the Tristan score are missing as well and are completed on the fly.</p></li>
</ul>
</section>
<section id="score-layout">
<h5><a class="toc-backref" href="#id72" role="doc-backlink">Score layout</a><a class="headerlink" href="#score-layout" title="Link to this heading">¶</a></h5>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is experimental and can be skipped.</p>
</div>
<p>This is a quick routine for resetting the layout of a score to the default values. It is generally a good idea to do
so, but one needs to make sure that no information is lost and that no layout atrocities are introduced by the process.
So as basic rules:</p>
<ul class="simple">
<li><p>If any of the steps result in a score that looks worse than before, it should be undone and not committed.</p></li>
<li><p>As a security measure, after each step one should execute <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-M</span> <span class="pre">-N</span> <span class="pre">-X</span> <span class="pre">-F</span> <span class="pre">-D</span></code> to make sure that no
elements have changed during the process, otherwise one should undo and not commit, maybe leaving a note.</p></li>
<li><p>Each step should be committed individually so that it can be reverted if needed.</p></li>
<li><p>However, the same step maybe applied to all scores, and committed (without any changes introduced by <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span></code>,
which should be have occurred either way).</p></li>
</ul>
<p>The steps are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Format</span> <span class="pre">-&gt;</span> <span class="pre">Style</span> <span class="pre">-&gt;</span> <span class="pre">Reset</span> <span class="pre">All</span> <span class="pre">Styles</span> <span class="pre">to</span> <span class="pre">Default</span> <span class="pre">-&gt;</span> <span class="pre">OK</span></code>. Suggested commit message: “resets all styles to default”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Format</span> <span class="pre">-&gt;</span> <span class="pre">Add/Remove</span> <span class="pre">System</span> <span class="pre">Breaks</span> <span class="pre">-&gt;</span> <span class="pre">Remove</span> <span class="pre">current</span> <span class="pre">system</span> <span class="pre">breaks</span> <span class="pre">-&gt;</span> <span class="pre">OK</span></code>. Suggested commit message: “removes
all system breaks”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Format</span> <span class="pre">-&gt;</span> <span class="pre">Reset</span> <span class="pre">Text</span> <span class="pre">Style</span> <span class="pre">Overrides</span></code>. Suggested commit message: “resets text style overrides”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Format</span> <span class="pre">-&gt;</span> <span class="pre">Page</span> <span class="pre">Settings</span> <span class="pre">-&gt;</span> <span class="pre">Reset</span> <span class="pre">All</span> <span class="pre">Page</span> <span class="pre">Settings</span> <span class="pre">to</span> <span class="pre">Default</span></code>. Suggested commit message: “resets all page
settings to default”</p></li>
</ul>
</section>
</section>
<section id="integrating-the-repository-with-the-corpus-automatization">
<span id="workflow-deployment-integration"></span><h4><a class="toc-backref" href="#id73" role="doc-backlink">Integrating the repository with the corpus automatization</a><a class="headerlink" href="#integrating-the-repository-with-the-corpus-automatization" title="Link to this heading">¶</a></h4>
<p>As a prerequisite for this section, please clone the <a class="reference external" href="https://github.com/DCMLab/workflow_deployment">DCMLab/workflow_deployment/</a> repo recursively:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>git@github.com:DCMLab/workflow_deployment.git
</pre></div>
</div>
<p>In brief, this chore consists in making sure that</p>
<ul class="simple">
<li><p>the repository is listed in <a class="reference external" href="https://github.com/DCMLab/workflow_deployment/blob/main/all_subcorpora.csv">DCMLab/workflow_deployment/all_subcorpora.csv</a></p></li>
<li><p>the columns are filled with values that are appropriate for this corpus (or deliberately left blank).</p></li>
</ul>
<p>The cells in this CSV file correspond to template variables that are used to fill in the <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">placeholders</span> <span class="pre">}}</span></code> in
multiple text files. These files are included in the workflow_deployment repository in the form of submodules:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">corpus_docs</span></code> includes the <a class="reference external" href="https://github.com/DCMLab/corpus_docs/">documentation homepage template</a> that is automatically deployed for each
corpus</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">template_repository</span></code> includes (other than the current version of the GitHub workflow) basic skeletons for a
<code class="docutils literal notranslate"><span class="pre">README.md</span></code> and a <code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> file (see further below).</p></li>
</ul>
<section id="updating-all-subcorpora-csv">
<h5><a class="toc-backref" href="#id74" role="doc-backlink">Updating <code class="docutils literal notranslate"><span class="pre">all_subcorpora.csv</span></code></a><a class="headerlink" href="#updating-all-subcorpora-csv" title="Link to this heading">¶</a></h5>
<p>For a “normal” corpus, the variables that need to be filled are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pretty_repo_name</span></code> Human-readable title that appears as first heading in the README and as homepage title, e.g.
“Richard Wagner – Overtures” (note the en dash used through the column).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example_fname</span></code> an example filename (without file extension), generally the one in the <code class="docutils literal notranslate"><span class="pre">piece</span></code> column of
<code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code>, e.g. “WWV090_Tristan_01_Vorspiel-Prelude_Ricordi1888Floridia”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example_full_title</span></code> the full title of the example piece that is implanted into a phrase, e.g.
“the “Vorspiel” of <em>Tristan und Isolde</em>” (note the use of restructuredText syntax for italics)</p></li>
</ul>
<p>You can take inspiration from already existing entries in other rows, too.
Once these are updated, they change can be committed directly to main in this exceptional case.
Suggested commit message: “adds template values for &lt;corpus_name&gt;”.</p>
</section>
<section id="deploying-the-homepage">
<h5><a class="toc-backref" href="#id75" role="doc-backlink">Deploying the homepage</a><a class="headerlink" href="#deploying-the-homepage" title="Link to this heading">¶</a></h5>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/run_update_homepage.png"><img alt="Running the update_homepage workflow" src="../_images/run_update_homepage.png" style="width: 30%;" /></a>
</figure>
<p>In <code class="docutils literal notranslate"><span class="pre">workflow_deployment/actions</span></code> select “update_homepage” from the menu on the left or
<a class="reference external" href="https://github.com/DCMLab/workflow_deployment/actions/workflows/update_homepages.yml">click here</a>.
Then click on “Run workflow” and then on the green “Run workflow” button. This will iterate through the rows of
<code class="docutils literal notranslate"><span class="pre">all_subcorpora.csv</span></code> and re-build the homepages where necessary.</p>
<p>Coming back after a few minutes the action has hopefully terminated successfully. To be very sure, you can checkout the
<code class="docutils literal notranslate"><span class="pre">docs</span></code> branch of the corpus repo and check if the bot has recently pushed files. Then you can go to the GitHub page
of the repo, click on the little cogwheel next to the “About” panel, under “Website”, activate the checkbox
“Use your GitHub Pages website”, and click on “Save changes.” Clicking on the pages link should bring you to the
newly built homepage.</p>
</section>
</section>
<section id="readme-md-and-template-filling">
<span id="template-filling"></span><h4><a class="toc-backref" href="#id76" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">README.md</span></code> and template filling</a><a class="headerlink" href="#readme-md-and-template-filling" title="Link to this heading">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TL;DR: <a class="reference external" href="https://github.com/DCMLab/bach_chorales/pull/1">Checkout the example PR</a>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note that everything under <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Overview</span></code> is automatically generated and everything you change beneath will be
relentlessly overwritten!</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file is the first thing that people see when they visit the repository on GitHub. Likewise, it
is the start page of the automatically deployed documentation homepage. That’s why our READMEs follow the same
template, which in the beginning adds a few badgets and generic links explaining this fact for easy navigation.</p>
<p>Often, if you’re cleaning up a README, you’re faced with something like this:</p>
<figure class="align-default" id="id22">
<a class="reference internal image-reference" href="../_images/wagner_readme.png"><img alt="README.md file of the wagner_overtures repositories, needing to be cleaned" src="../_images/wagner_readme.png" style="width: 565.6px; height: 368.8px;" /></a>
<figcaption>
<p><span class="caption-text">This README.md contains only a template text and an automatically generated overview table.</span><a class="headerlink" href="#id22" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Everything described in the following could be replaced by editing the README.md manually to achieve the desired
result. However, if you find yourself cleaning up the READMEs for multiple repos, you will probably benefit from
using the template filling approach.</p>
<section id="filling-the-templates-for-multiple-repositories">
<h5><a class="toc-backref" href="#id77" role="doc-backlink">Filling the templates for multiple repositories</a><a class="headerlink" href="#filling-the-templates-for-multiple-repositories" title="Link to this heading">¶</a></h5>
<p>In order to run the template filler script, here’s a very quick setup of a conda environment (assuming you have conda
installed) that you can execute in your clone of the <code class="docutils literal notranslate"><span class="pre">workflow_deployment</span></code> repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>jinja<span class="w"> </span>pip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>conda<span class="w"> </span>activate<span class="w"> </span>jinja
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>src/requirements.txt
</pre></div>
</div>
<p>Note that there is another <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file in the root directory of the repository, which has a whole lot
more dependencies, needed for compiling the corpus documentation homepage. Since we don’t need to do this locally,
the <code class="docutils literal notranslate"><span class="pre">src/requirements.txt</span></code> file contains the bare necessities for executing the template filler. To see if and how
it works, view its help message:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>src/jinja_filler.py<span class="w"> </span>-h
</pre></div>
</div>
<p>Most parameters correspond to columns in the <code class="docutils literal notranslate"><span class="pre">all_subcorpora.csv</span></code> table; meaning that if you need to fill in the
<code class="docutils literal notranslate"><span class="pre">template_repository/README.md</span></code> file, for multiple repositories, you might be faster off creating a CSV file,
e.g. <code class="docutils literal notranslate"><span class="pre">subset.csv</span></code>, by removing irrelevant rows from <code class="docutils literal notranslate"><span class="pre">all_subcorpora.csv</span></code> and calling</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># make sure to fill in and commit all_subcorpora.csv first before creating the subset.csv</span>
python<span class="w"> </span>src/jinja_filler.py<span class="w"> </span>-csv<span class="w"> </span>subset.csv
</pre></div>
</div>
<p>The first argument to the script, <code class="docutils literal notranslate"><span class="pre">-f</span></code> defaults to the <code class="docutils literal notranslate"><span class="pre">template_repository</span></code> folder and will produce one filled-in
folder per row in the CSV file. From there you can go and copy the contents of the README.md file into the README.md
of the corresponding corpus repository, adapting it as needed.</p>
</section>
<section id="filling-the-templates-for-a-single-repository">
<h5><a class="toc-backref" href="#id78" role="doc-backlink">Filling the templates for a single repository</a><a class="headerlink" href="#filling-the-templates-for-a-single-repository" title="Link to this heading">¶</a></h5>
<p>If you need to fill in for a single repo, you might be faster off just passing the arguments for it directly to the
script, as in this example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>src/jinja_filler.py<span class="se">\</span>
<span class="w">    </span>-r<span class="w"> </span>bach_chorales<span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="s2">&quot;Johann Sebastian Bach – The Chorales&quot;</span><span class="se">\</span>
<span class="w">    </span>-cr<span class="w"> </span>v2.0
<span class="w">    </span><span class="c1"># include `-b` if the Zenodo badge ID is known at this point</span>
</pre></div>
</div>
<p>From here you may want to</p>
<ul class="simple">
<li><p>create a new branch in the corpus repository,</p></li>
<li><p>copy the desired parts of the filled-in README.md file into the README.md of the corresponding corpus repository
and commit</p></li>
<li><p>adapt it further, filling it with a little bit of life, such as a short introduction to the corpus (the pieces),
origin and history, and status of the files, annotations etc.</p></li>
</ul>
<p>If the repository has at least one previous version tag <strong>and is already public</strong>, you may include the following step,
the Zenodo integration, in the same branch and Pull Request. Otherwise, please create one just for the README.md.
<a class="reference external" href="https://github.com/DCMLab/bach_chorales/pull/1">Click here for an example PR</a>.</p>
</section>
</section>
<section id="zenodo-integration">
<span id="id2"></span><h4><a class="toc-backref" href="#id79" role="doc-backlink">Zenodo integration</a><a class="headerlink" href="#zenodo-integration" title="Link to this heading">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TL;DR: <a class="reference external" href="https://github.com/DCMLab/bach_chorales/pull/2">Checkout the example PR</a>.</p>
</div>
<p>The Zenodo integration has the purpose of automatically assigning a new DOI for each new version of a copurs that is
released on GitHub. In order to activate it, one needs to be the owner of a repository.</p>
<section id="activating-the-integration-for-a-corpus-repository">
<h5><a class="toc-backref" href="#id80" role="doc-backlink">Activating the integration for a corpus repository</a><a class="headerlink" href="#activating-the-integration-for-a-corpus-repository" title="Link to this heading">¶</a></h5>
<p>Being the owner of the repo in question (or admin of the owner organization), on can log into
<a class="reference external" href="https://zenodo.org/">Zenodo</a> with one’s GitHub account and use the menu to go
<a class="reference external" href="https://zenodo.org/account/settings/github/">GitHub</a>, a page showing all public repositories with a toggle that
shows whether the integration is activated or not.</p>
<figure class="align-center" id="id23">
<a class="reference internal image-reference" href="../_images/zenodo_toggle.png"><img alt="Zenodo GitHub integration page" src="../_images/zenodo_toggle.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text">Zenodo GitHub integration page where the toggle has been set to “on”.</span><a class="headerlink" href="#id23" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>From now on, every GitHub release will be sent to Zenodo and a DOI will be assigned to the new version. This involves
the creation of a new Zenodo record (which includes long-term archival of the data) which requires the presence of a
<code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> file (if we want the record to contain any useful information).</p>
</section>
<section id="getting-the-zenodo-badge-id">
<h5><a class="toc-backref" href="#id81" role="doc-backlink">Getting the Zenodo badge ID</a><a class="headerlink" href="#getting-the-zenodo-badge-id" title="Link to this heading">¶</a></h5>
<p>The Zenodo badge ID allows to display a blue badge at the top of a repository’s README file that always displays the DOI
that has been automatically assigned by Zenodo to the current release (looks like the one in the screenshot below).
Please note that the 9-digit ID is not to be confused with the 7-digit end of the DOI itself.</p>
<p>First we create a GitHub release (or have it automatically created by the workflow) and go (back) to the Zenodo
overview of our GitHub repositories. Clicking on the repository in question, hopefully, we should see something like
this:</p>
<figure class="align-center" id="id24">
<a class="reference internal image-reference" href="../_images/zenodo_status.png"><img alt="GitHub release successfully integrated into Zenodo" src="../_images/zenodo_status.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">GitHub release successfully integrated into Zenodo with a newly assigned DOI.</span><a class="headerlink" href="#id24" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The DOI has been successfully assigned and there is a green check saying “Published”. We now can extract the Zenodo
badge ID by clicking on the blue DOI badge and copying the 9-digit ID from one of the various fields:</p>
<figure class="align-center" id="id25">
<a class="reference internal image-reference" href="../_images/zenodo_badge_id.png"><img alt="Zenodo badge ID highlighted multiple times" src="../_images/zenodo_badge_id.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text">After clicking on the blue DOI badge, this pane shows up, displaying the badge ID multiple times.</span><a class="headerlink" href="#id25" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>We are now able to copy the ID and fill in the last two <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">zenodo_badge_id</span> <span class="pre">}}</span></code> placeholders in the README.md like so:</p>
<figure class="align-center" id="id26">
<a class="reference internal image-reference" href="../_images/zenodo_badge_id_readme_diff.png"><img alt="Replacing the placeholders in the README.md with the Zenodo badge ID" src="../_images/zenodo_badge_id_readme_diff.png" style="width: 99%;" /></a>
<figcaption>
<p><span class="caption-text">Replacing the two placeholders in the README.md with the Zenodo badge ID.</span><a class="headerlink" href="#id26" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Then we also copy it into the corresponding cell of <code class="docutils literal notranslate"><span class="pre">workflow_deployment/all_subcorpora.csv</span></code>.</p>
</section>
<section id="setting-up-the-zenodo-json-metadata-file">
<h5><a class="toc-backref" href="#id82" role="doc-backlink">Setting up the <code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> metadata file</a><a class="headerlink" href="#setting-up-the-zenodo-json-metadata-file" title="Link to this heading">¶</a></h5>
<p>We have two possibilities:</p>
<ul class="simple">
<li><p>Either we use the <code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> file that we get from the using the
<a class="reference internal" href="#template-filling"><span class="std std-ref">template filling script</span></a> above.</p></li>
<li><p>Or we use the Zenodo form to conveniently edit the metadata and then copy the JSON version generated by Zenodo.</p></li>
</ul>
<p>In both cases the contents of the file need to be carefully checked because once information ends up on Zenodo,
it quickly propagates throughout the internet and is hard to correct.</p>
<p><strong>Using the ``.zenodo.json`` generated by the template filler</strong></p>
<p>We can copy the file to the top level of the corpus repository and adapt it manually. It is highly recommended to use
a text editor with JSON syntax highlighting and validation to avoid failed releases where Zenodo rejects the file
(e.g. because of a trailing comma after the last item in an array). The
<a class="reference external" href="https://github.com/zenodraft/metadata-schema-zenodo">zenodraft/metadata-schema-zenodo</a> repository contains a
JSONschema file with the full specification, e.g. all possible license values etc.</p>
<p>The template filler leaves us with a file with</p>
<ul class="simple">
<li><p>(hopefully correctly) filled-in template fields</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">version</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">related_identifiers</span></code></p></li>
</ul>
</li>
<li><p>default values that probably can stay as they are</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">license</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code> (as of September 2023, we are using a default description)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grants</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">upload_type</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">communities</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">access_right</span></code></p></li>
</ul>
</li>
<li><p>default values that might need to be amended:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">contributors</span></code>, that is, engravers and annotators (<code class="docutils literal notranslate"><span class="pre">&quot;type&quot;:</span> <span class="pre">&quot;DataCollector&quot;,</span></code>), and curators
(<code class="docutils literal notranslate"><span class="pre">&quot;type&quot;:</span> <span class="pre">&quot;DataCurators&quot;,</span></code>); each person MUST come with an ORCID and CAN have an affiliation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keywords</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">creators</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">publication_date</span></code></p></li>
</ul>
</li>
</ul>
<p><strong>Using the Zenodo form</strong></p>
<p>From the Zenodo overview of our GitHub repositories shown in the screenshot above, we click on the DOI (the grey link,
not the blue badge), which takes us to the record. At first it might look very incomplete:</p>
<figure class="align-center" id="id27">
<a class="reference internal image-reference" href="../_images/zenodo_record_before.png"><img alt="Zenodo record with very little metadata" src="../_images/zenodo_record_before.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Zenodo record with very little metadata. It shows the record to be “Software” (instead of a “Dataset”),
shows a generic title and body generated from the GitHub release, and has an incomplete author list.</span><a class="headerlink" href="#id27" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Clicking on “Edit” we are taken to a form where we can fill in the missing information. The form is divided into
multiple sections which we ideally we click through and fill according to the default metadata listed in the previous
section. It is a good idea to click “Save” often; and when everything is edited, to click on “Publish”.</p>
<p>Then we can go back to the overview of GitHub repos (shown above), click on the release and on “Metadata”, from where
we can simply copy the generated JSON into a fresh <code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> file in the corpus repository; <strong>but with one
important exception</strong>: The <code class="docutils literal notranslate"><span class="pre">related_identifiers</span></code> array contains an entry that causes the Zenodo API to reject a
release containing it, so it is important to remove it. It is the entry that has the <code class="docutils literal notranslate"><span class="pre">&quot;relation&quot;:</span> <span class="pre">&quot;isVersionOf&quot;</span></code>
and might look like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;scheme&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doi&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;identifier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10.5281/zenodo.8364205&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;isVersionOf&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Bear in mind the above-said: When you remove an entry from an array, it is important to also remove the trailing
comma. Ideally your text editor will do it for you or at least warn you about it.</p>
</div>
<p>With the syntactically correct <code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> file pushed to the corpus repo, the next release will show with the
complete set of metadata and is looking <a class="reference external" href="https://zenodo.org/record/8364931">rather neat</a>:</p>
<figure class="align-center" id="id28">
<a class="reference internal image-reference" href="../_images/zenodo_record_after.png"><img alt="Zenodo record with complete metadata" src="../_images/zenodo_record_after.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Zenodo record with complete metadata. It shows the record to be a “Dataset”, a HTML version of the repo’s README,
creators and contributors with ORCID links, as well as keywords, funding information, and related identifiers.</span><a class="headerlink" href="#id28" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Additionally, listing “epfl” in the <code class="docutils literal notranslate"><span class="pre">communities</span></code> field results in a request being sent to EPFL’s research data
team who will scrutinize the record according to the
<a class="reference external" href="https://zenodo.org/communities/epfl/about/">EPFL community guidelines</a> and send us an email with the outcome.</p>
<p><a class="reference external" href="https://github.com/DCMLab/bach_chorales/pull/2">Click here for an example PR</a>.</p>
</section>
</section>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, École Polytechnique Fédérale de Lausanne.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>