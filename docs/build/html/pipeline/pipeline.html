<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>DCML Corpus Creation Pipeline &#8212; Harmonic Annotation Guidelines 2.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script>let toggleHintShow = 'Show answer';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Annotation Reference" href="../reference/reference.html" />
    <link rel="prev" title="Quick Git Reference" href="../git/git.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          DCML Guidelines</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Other pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../onboarding.html">Becoming a DCML annotator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#working-as-an-annotator">Working as an annotator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#how-to-get-involved">How to get involved</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../workflow/workflow.html">DCML annotation workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#short-summary">Short summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#annotating">Annotating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#upgrading-annotations">Upgrading annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#reviewing-a-set-of-annotations">Reviewing a set of annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#reacting-to-a-review-reaching-expert-consensus">Reacting to a review &amp; reaching expert consensus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#what-to-do-about-the-warnings">What to do about the warnings?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../openproject/openproject.html">Work package management with OpenProject</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#user-interface">User Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#work-packages-wps">Work Packages (WPs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#taking-on-an-assignment">Taking on an assignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#logging-unit-costs">Logging unit costs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#writing-invoices">Writing invoices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Annotation Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/musescore.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/first_label.html">The first label</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/first_phrase.html">The first phrase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/detail.html">Level of detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/localkey.html">Changing the local key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/counterpoint.html">Contrapuntal patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/features.html">Some more features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../git/git.html">Quick Git Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#installing-git">Installing Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#configuring-git">Configuring Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#cloning-a-repository-from-github">Cloning a Repository from GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#selecting-the-right-branch">Selecting the right Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#applying-changes-to-the-repository">Applying Changes to the Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#uploading-changes-to-github">Uploading Changes to GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#applying-changes-to-the-origin-directly">Applying Changes to the Origin Directly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#installing-github-desktop">Installing GitHub Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#first-start">First start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#cloning-a-repository">Cloning a repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#the-user-interface">The user interface</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DCML Corpus Creation Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">Collect and prepare the digital edition in the latest MuseScore format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#curating-and-enriching-metadata">Curating and enriching metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files">Creating a repository with unannotated MuseScore files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-and-adding-the-new-repo">Configuring and adding the new repo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Annotation Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#the-syntax">The syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#the-remainder-of-the-reference-is-currently-under-reconstruction">The remainder of the Reference is currently under reconstruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/examples.html">Questions &amp; Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#modulation-and-secondary-keys">Modulation and Secondary Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#phrase-structure">Phrase Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#figured-bass">Figured Bass</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/specs.html">Technical Specifications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#what-is-being-encoded">What is being encoded?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#the-regex-regular-expression">The regEx (Regular Expression)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#feature-processing">Feature Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#missing-features">Missing Features</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">This Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">DCML Corpus Creation Pipeline</a><ul>
<li><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">Collect and prepare the digital edition in the latest MuseScore format</a><ul>
<li><a class="reference internal" href="#prior-research">Prior research</a></li>
<li><a class="reference internal" href="#look-up-and-check-existing-scores">Look up and check existing scores</a></li>
<li><a class="reference internal" href="#typeset-non-existent-files">Typeset non-existent files</a></li>
<li><a class="reference internal" href="#file-curation">File curation</a></li>
<li><a class="reference internal" href="#create-metadata">Create metadata</a></li>
</ul>
</li>
<li><a class="reference internal" href="#curating-and-enriching-metadata">Curating and enriching metadata</a><ul>
<li><a class="reference internal" href="#default-fields">Default fields</a></li>
<li><a class="reference internal" href="#required-custom-fields">Required custom fields</a></li>
<li><a class="reference internal" href="#identifiers-where-available">Identifiers where available</a></li>
<li><a class="reference internal" href="#contributors-and-annotations">Contributors and annotations</a></li>
<li><a class="reference internal" href="#reconciling-metadata-with-wikidata">Reconciling metadata with Wikidata</a><ul>
<li><a class="reference internal" href="#creating-a-new-openrefine-project">Creating a new OpenRefine project</a></li>
<li><a class="reference internal" href="#reconciling-a-column">Reconciling a column</a></li>
<li><a class="reference internal" href="#pulling-additional-information">Pulling additional information</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files">Creating a repository with unannotated MuseScore files</a><ul>
<li><a class="reference internal" href="#variant-1-using-the-template-repository">Variant 1: Using the template repository</a></li>
<li><a class="reference internal" href="#variant-2-starting-from-scratch">Variant 2: Starting from scratch</a></li>
<li><a class="reference internal" href="#variant-3-splitting-an-existing-repository">Variant 3: Splitting an existing repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-and-adding-the-new-repo">Configuring and adding the new repo</a><ul>
<li><a class="reference internal" href="#adding-the-repo-to-one-or-several-meta-repos">Adding the repo to one or several meta-repos</a></li>
<li><a class="reference internal" href="#creating-work-packages-on-openproject">Creating work packages on OpenProject</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../git/git.html" title="Previous Chapter: Quick Git Reference"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Quick Git Reference</span>
    </a>
  </li>
  <li>
    <a href="../reference/reference.html" title="Next Chapter: Annotation Reference"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Annotation Reference &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/pipeline/pipeline.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="dcml-corpus-creation-pipeline">
<h1>DCML Corpus Creation Pipeline<a class="headerlink" href="#dcml-corpus-creation-pipeline" title="Permalink to this heading">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format" id="id9">Collect and prepare the digital edition in the latest MuseScore format</a></p>
<ul>
<li><p><a class="reference internal" href="#prior-research" id="id10">Prior research</a></p></li>
<li><p><a class="reference internal" href="#look-up-and-check-existing-scores" id="id11">Look up and check existing scores</a></p></li>
<li><p><a class="reference internal" href="#typeset-non-existent-files" id="id12">Typeset non-existent files</a></p></li>
<li><p><a class="reference internal" href="#file-curation" id="id13">File curation</a></p></li>
<li><p><a class="reference internal" href="#create-metadata" id="id14">Create metadata</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#curating-and-enriching-metadata" id="id15">Curating and enriching metadata</a></p>
<ul>
<li><p><a class="reference internal" href="#default-fields" id="id16">Default fields</a></p></li>
<li><p><a class="reference internal" href="#required-custom-fields" id="id17">Required custom fields</a></p></li>
<li><p><a class="reference internal" href="#identifiers-where-available" id="id18">Identifiers where available</a></p></li>
<li><p><a class="reference internal" href="#contributors-and-annotations" id="id19">Contributors and annotations</a></p></li>
<li><p><a class="reference internal" href="#reconciling-metadata-with-wikidata" id="id20">Reconciling metadata with Wikidata</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-a-new-openrefine-project" id="id21">Creating a new OpenRefine project</a></p></li>
<li><p><a class="reference internal" href="#reconciling-a-column" id="id22">Reconciling a column</a></p></li>
<li><p><a class="reference internal" href="#pulling-additional-information" id="id23">Pulling additional information</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files" id="id24">Creating a repository with unannotated MuseScore files</a></p>
<ul>
<li><p><a class="reference internal" href="#variant-1-using-the-template-repository" id="id25">Variant 1: Using the template repository</a></p></li>
<li><p><a class="reference internal" href="#variant-2-starting-from-scratch" id="id26">Variant 2: Starting from scratch</a></p></li>
<li><p><a class="reference internal" href="#variant-3-splitting-an-existing-repository" id="id27">Variant 3: Splitting an existing repository</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-and-adding-the-new-repo" id="id28">Configuring and adding the new repo</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-the-repo-to-one-or-several-meta-repos" id="id29">Adding the repo to one or several meta-repos</a></p></li>
<li><p><a class="reference internal" href="#creating-work-packages-on-openproject" id="id30">Creating work packages on OpenProject</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">
<span id="get-scores"></span><h2><a class="toc-backref" href="#id9">Collect and prepare the digital edition in the latest MuseScore format</a><a class="headerlink" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format" title="Permalink to this heading">¶</a></h2>
<section id="prior-research">
<h3><a class="toc-backref" href="#id10">Prior research</a><a class="headerlink" href="#prior-research" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Check which pieces make up the collection</p></li>
<li><p>how they are grouped</p></li>
<li><p>what naming or numbering conventions exist</p></li>
<li><p>which editions there are</p></li>
<li><p>if different versions of the pieces exist.</p></li>
<li><p>Come up with a list (and hierarchy) of names. Here, you can already think of a good naming/numbering convention for the corpus.</p></li>
<li><p>It might be good to create the list of the overarching group of works even if your corpus will contain only parts of it, for the sake of a better overview.</p></li>
<li><p>Example: Going from the <a class="reference external" href="http://www3.cpdl.org/wiki/index.php/Claudio_Monteverdi">list of Monteverdi’s Madrigal books</a>
to an <a class="reference external" href="https://github.com/DCMLab/monteverdi_madrigals/">initial README file</a>.</p></li>
</ul>
</section>
<section id="look-up-and-check-existing-scores">
<h3><a class="toc-backref" href="#id11">Look up and check existing scores</a><a class="headerlink" href="#look-up-and-check-existing-scores" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>All scores available need to be checked and compared:</dt><dd><ul>
<li><p>reference edition</p></li>
<li><p>completeness</p></li>
<li><p>quality &amp; errors</p></li>
<li><p>license (later publication!)</p></li>
<li><p>file format and expected conversion losses</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Where to check</dt><dd><ul>
<li><p>First: musescore.com because the scores are in the target format</p></li>
<li><p>musicalion.com (not free to publish: need to ask first)</p></li>
<li><p>choral music: CPDL</p></li>
<li><p><a class="reference external" href="http://kern.ccarh.org/">http://kern.ccarh.org/</a> lossless humdrum 2 musescore conversion needed</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="typeset-non-existent-files">
<h3><a class="toc-backref" href="#id12">Typeset non-existent files</a><a class="headerlink" href="#typeset-non-existent-files" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>pick reference edition and send commission to transcriber</p></li>
<li><p>depending on the music, prices may vary between 5 and 20 CHF per page</p></li>
</ul>
</section>
<section id="file-curation">
<h3><a class="toc-backref" href="#id13">File curation</a><a class="headerlink" href="#file-curation" title="Permalink to this heading">¶</a></h3>
<p>The scores need to be corrected on the basis of a reference edition/manuscript.
We have a collaborative document with detailed
<a class="reference external" href="https://docs.google.com/document/d/1Q2svEUSsE7OCetik8An__gsEwQCYNfFJlHFMF9dRce4/edit#heading=h.8hrcm7m3udll">Score correction guidelines</a>.
It also stipulates which information from the reference edition/manuscript needs to be encoded in what way.
Please send a request to be added to the document.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Convert to MuseScore format</dt><dd><ul>
<li><p>XML, CAP: can be done with MuseScore’s batch converter plugin or with <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">convert</span></code></p></li>
<li><p>CAPX: Conversion to CAP or XML with DCML’s Capella license</p></li>
<li><p>MUSX: Conversion to XML with private Finale copy</p></li>
<li><p>SIB: Conversion to XML with Sibelius on DCML’s iMac</p></li>
<li><p>LY: no good conversion available</p></li>
<li><p>KRN: hum2xml can be used but it would be preferable to have our own converter to MuseScore</p></li>
<li><p>results need to be checked; especially markup such as slurs, arpeggios, trills etc. often get screwed</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Renaming</dt><dd><ul>
<li><p>Decide on naming convention and create a map (without extensions) from old to new filenames</p></li>
<li><dl class="simple">
<dt>Sometimes, files need to be split at that point because they contain several movements</dt><dd><ul>
<li><p>For this, you introduce section breaks separating the movements</p></li>
<li><p>After every section break, you have to re-insert the time and key signature or add it into the split file</p></li>
<li><p>Start with the last movement, select it and do <cite>File -&gt; Save Selection</cite></p></li>
<li><p>Repeat for all movements</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Rename the files</p></li>
<li><p>Possibly add a small script that automatically renames the source files</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Use parser/checking tool and/or manual checks for consistency</dt><dd><ul>
<li><dl class="simple">
<dt>certain bars need to be excluded from the bar count:</dt><dd><ul>
<li><p>anacrusis</p></li>
<li><p>pickup measures throughout the piece</p></li>
<li><p>second voltas (i.e. second repeats)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>irregular measure lengths need to complete each other</dt><dd><ul>
<li><p>e.g. when a repeated section starts with a pickup measure, the last measure of the repeated section needs to be shorter</p></li>
<li><p>anacrusis is substracted from the last bar</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>if in the reference edition the bar count restarts in the middle of the piece (e.g. in some variation movements), you can</dt><dd><ul>
<li><p>either: split the movement into individual files (not preferable if you want to keep the movement as one coherent unit)</p></li>
<li><p>or: have two versions, one working version with continuous (unambiguous) measure numbers that depart from the reference edition, and one that is provided separately, that has the original (ambiguous) measure numbering but is not used for computational purposes. The reset of the counter should not be done via “add to measure count” using a negative number, but rather via section breaks.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="create-metadata">
<h3><a class="toc-backref" href="#id14">Create metadata</a><a class="headerlink" href="#create-metadata" title="Permalink to this heading">¶</a></h3>
<p>All metadata fields are automatically extracted by the dcml_corpus_workflow and represented in the repository’s
<code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file. However, at the beginning this file needs to be created using the command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span> <span class="pre">-a</span></code>.
The first column, <code class="docutils literal notranslate"><span class="pre">fname</span></code>, is used as IDs for the corpus and needs to be checked. In case the corpus contains
several alternative scores for the same piece, the main MuseScore file should have the shortest file name and the
alternative scores’ file names should begin with the same <code class="docutils literal notranslate"><span class="pre">fname</span></code> plus a suffix or a different file extension.
Upon creation of the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file, all scores will be listed and you can safely remove the rows corresponding
to the alternative versions to prevent them being processed by ms3.</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> is there and contains one row per piece, metadata curation is as straightforward as
updating values and adding columns to the file and then calling
<code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span></code> to write the updated values into the corresponding Musescore files. Be aware that calling
<code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code> will overwrite the manual changes in the TSV file with any value existing in the MuseScore files.
so make sure to commit your manual modifications to not loose them.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Although many editors open TSV files, many of them silently change values, e.g. by removing
<code class="docutils literal notranslate"><span class="pre">.0</span></code> from decimal values (LibreOffice) or turning a <code class="docutils literal notranslate"><span class="pre">4/4</span></code> time signature into a date (Excel,
Numbers). One editor that doesn’t to that is VScode. Make sure to <strong>always</strong> view the diff before
committing changes to <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> to avoid unwanted modifications or, worse, loss of data.</p>
</div>
<p>Once the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> is there and contains one row per piece, you can either continue with the following section
on enriching metadata, or first create the repository (see further below) so that the metadata curation is
part of the Git history.</p>
</section>
</section>
<section id="curating-and-enriching-metadata">
<h2><a class="toc-backref" href="#id15">Curating and enriching metadata</a><a class="headerlink" href="#curating-and-enriching-metadata" title="Permalink to this heading">¶</a></h2>
<p>In MuseScore, metadata is stored as <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">-&gt;</span> <span class="pre">value</span></code> pairs and can be accessed and modified via the menu
<code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Score</span> <span class="pre">Properties...</span></code>. Some fields are there by default, others have to be created using the <code class="docutils literal notranslate"><span class="pre">New</span></code> button.
It is very important that the fields are named correctly (double-check for spelling mistakes) and all lowercase.
The command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code> extracts the metadata fields from the MuseScore files, updating the
<code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file in a way that every row corresponds to a MuseScore file where every <code class="docutils literal notranslate"><span class="pre">key</span></code> is a column showing
the <code class="docutils literal notranslate"><span class="pre">value</span></code> from the corresponding file. Likewise, this can be used to batch-edit the metadata of several or all
MuseScore files in the corpus by editing the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file and calling the command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before manipulating <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> make sure to call <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code>, ensuring that it is up to date
with the metadata contained in the MuseScore files. Otherwise the command <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span></code> would overwrite
newer values, resulting in the criminal offense of undoing other people’s work.</p>
</div>
<p>DCML corpora usually come with one MuseScore file per movement, hence we follow the convention that anything related to
<code class="docutils literal notranslate"><span class="pre">work</span></code> describes the whole group (Suite, Symphony, etc.) or cycle (e.g. song cycle), and fields containing
<code class="docutils literal notranslate"><span class="pre">movement</span></code> or <code class="docutils literal notranslate"><span class="pre">mvt</span></code> its individual parts. It follows that in the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file titles, catalogue numbers,
URIs etc. are repeated and identical for the parts of a <code class="docutils literal notranslate"><span class="pre">work</span></code>. Identifiers for individual movements are often
hard to come by, but musicbrainz has already a good number of them. For compositions where the subdivision into
parts is somewhat arbitrary (consider the grouping into tracks for recordings of the same opera), the question of
unique identification is an open problem.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Whereas in filenames we avoid all diacritical signs, accents, Umlaute etc., the metadata needs to include them
accurately encoded in UTF-8. For example, write <code class="docutils literal notranslate"><span class="pre">Antonín</span> <span class="pre">Dvořák</span></code>, not <code class="docutils literal notranslate"><span class="pre">Antonin</span> <span class="pre">Dvorak</span></code>. Whenever in doubt,
go with the English Wikidata/Wikipedia.</p>
</div>
<section id="default-fields">
<h3><a class="toc-backref" href="#id16">Default fields</a><a class="headerlink" href="#default-fields" title="Permalink to this heading">¶</a></h3>
<p>The following default fields should be populated where applicable:</p>
<dl class="simple">
<dt>composer</dt><dd><p>Full name as displayed in the English Wikipedia. For example,
<a class="reference external" href="https://en.wikipedia.org/wiki/Pyotr_Ilyich_Tchaikovsky">Tchaikovsky</a> gets <code class="docutils literal notranslate"><span class="pre">Pyotr</span> <span class="pre">Ilyich</span> <span class="pre">Tchaikovsky</span></code>.</p>
</dd>
<dt>workTitle</dt><dd><p>Name of the entire work/cycle, e.g. <code class="docutils literal notranslate"><span class="pre">Winterreise</span></code> or <code class="docutils literal notranslate"><span class="pre">Piano</span> <span class="pre">Sonata</span> <span class="pre">No.</span> <span class="pre">1</span> <span class="pre">in</span> <span class="pre">C</span> <span class="pre">major</span></code> without any catalogue
or opus numbers. The title should largely correspond to the English <code class="docutils literal notranslate"><span class="pre">label</span></code> of the corresponding (or future)
Wikidata item.</p>
</dd>
<dt>workNumber</dt><dd><p>This is where opus and catalogue numbers go, e.g. <code class="docutils literal notranslate"><span class="pre">Op.</span> <span class="pre">33,</span> <span class="pre">No.</span> <span class="pre">3,</span> <span class="pre">BI</span> <span class="pre">115-3</span></code>.</p>
</dd>
<dt>movementNumer</dt><dd><p>Ordinal number of the movement or part. Should be an arabic integer, e.g. <code class="docutils literal notranslate"><span class="pre">2</span></code> (not <code class="docutils literal notranslate"><span class="pre">2.</span></code>, not <code class="docutils literal notranslate"><span class="pre">II</span></code>).</p>
</dd>
<dt>movementTitle</dt><dd><p>Title of the part, e.g. song title, or <code class="docutils literal notranslate"><span class="pre">Andante</span></code> (not <code class="docutils literal notranslate"><span class="pre">II.</span> <span class="pre">Andante</span></code>). If unclear, CD track titles might serve
as an orientation.</p>
</dd>
<dt>source</dt><dd><p>URL of the adapted digital edition, e.g. a link to musescore.com or kern.humdrum.org.</p>
</dd>
</dl>
</section>
<section id="required-custom-fields">
<h3><a class="toc-backref" href="#id17">Required custom fields</a><a class="headerlink" href="#required-custom-fields" title="Permalink to this heading">¶</a></h3>
<p>The following fields need to be populated.</p>
<dl>
<dt>composed_start, composed_end</dt><dd><p>Each of these two fields needs to contain a 4-digit year number such that taken together they represent the time span
during which the piece was composed according to <code class="docutils literal notranslate"><span class="pre">composed_source</span></code>. If the time span lies within the same year,
both fields contain the same number. If the source indicates an open interval (e.g. <code class="docutils literal notranslate"><span class="pre">?-1789</span></code>), we use the
<a class="reference external" href="https://www.loc.gov/standards/datetime/">EDTF</a> convention to indicate the unknown date (here <code class="docutils literal notranslate"><span class="pre">composed_start</span></code>)
as <code class="docutils literal notranslate"><span class="pre">..</span></code>. If no composition date is known, we use the following dates as fallback, in that order:</p>
<ol class="arabic simple">
<li><p>year of the princeps edition</p></li>
<li><p>musicologically informed time span (e.g. the composer’s “sad phase” from x-y)</p></li>
<li><p>composer’s life span</p></li>
</ol>
<p>In any of these cases, an explaining comment should be added to the <code class="docutils literal notranslate"><span class="pre">composed_source</span></code> field.</p>
</dd>
<dt>composed_source</dt><dd><p>The reference to where the <code class="docutils literal notranslate"><span class="pre">composed_start</span></code> and <code class="docutils literal notranslate"><span class="pre">composed_end</span></code> dates come from. Could be a URL such as
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_compositions_by_Edvard_Grieg">https://en.wikipedia.org/wiki/List_of_compositions_by_Edvard_Grieg</a>, the name of a dictionary or work catalogue,
or bibliographical data of a book. The latter would be required in the case of using a “musicologically informed
time span” (see above). This field is free text and, in the absence of composition dates, should contain additional
information on what exactly the years represent, e.g.
<code class="docutils literal notranslate"><span class="pre">dates</span> <span class="pre">represent</span> <span class="pre">the</span> <span class="pre">&quot;late</span> <span class="pre">period&quot;</span> <span class="pre">of</span> <span class="pre">composer</span> <span class="pre">X's</span> <span class="pre">work,</span> <span class="pre">as</span> <span class="pre">proposed</span> <span class="pre">by</span> <span class="pre">author</span> <span class="pre">Y</span> <span class="pre">in</span> <span class="pre">book</span> <span class="pre">Z,</span> <span class="pre">page</span> <span class="pre">n</span></code>.</p>
</dd>
</dl>
</section>
<section id="identifiers-where-available">
<h3><a class="toc-backref" href="#id18">Identifiers where available</a><a class="headerlink" href="#identifiers-where-available" title="Permalink to this heading">¶</a></h3>
<p>Identifiers are important for making data findable and interoperable but might not always be available. Nevertheless,
the goal should be to find minimum one of the work or part-of-work identifiers listed below. Wikidata identifiers
are the gold standard because they often come with a mapping to all other kinds of identifiers. In addition,
Wikidata is a knowledge graph which lets us easily pull additional metadata. The site has the drawback
that identifiers for less known works are mostly missing as of yet and so are identifiers for individual movements.
Until the fundamental problem of community-wide work identifiers is solved, we should aim at completing missing
Wikidata items and foster the graph’s function as a Linked Open Data hub and registry for all other sorts of
identifiers.</p>
<dl class="simple">
<dt>wikidata</dt><dd><p>This field is used to identify the <code class="docutils literal notranslate"><span class="pre">work</span></code> with the full URL of its corresponding Wikidata item, e.g.
<a class="reference external" href="http://www.wikidata.org/entity/Q2194957">http://www.wikidata.org/entity/Q2194957</a>. If the <code class="docutils literal notranslate"><span class="pre">composer</span></code> and <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> field are properly filled in,
they can be reconciled with, i.e. matched to,
Wikidata <a class="reference external" href="https://openrefine.org/docs/manual/reconciling">using OpenRefine</a>.</p>
</dd>
<dt>musicbrainz</dt><dd><p>musicbrainz.org has a whole lot of different identifiers, in particular for identifying individual recordings down
to the level of CD tracks. The ones we’re interested here are work identifiers (make sure the URI starts with
<code class="docutils literal notranslate"><span class="pre">https://musicbrainz.org/work/</span></code>). The project is very advanced with creating identifiers on the
sub-work (movement) level and we use those whenever available (see screenshot below).
If not, we repeat the the work ID for each movement.</p>
</dd>
</dl>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../_images/musicbrainz_work.png"><img alt="Example for a work displayed on musicbrainz." src="../_images/musicbrainz_work.png" style="width: 534.8px; height: 387.09999999999997px;" /></a>
<figcaption>
<p><span class="caption-text">Example of a work displayed on musicbrainz (note the URL). In this case, it lists identifiers for its three
movements so we would be using these.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<dl class="simple">
<dt>viaf</dt><dd><p>Work URI, e.g. <a class="reference external" href="https://viaf.org/viaf/181040674">https://viaf.org/viaf/181040674</a></p>
</dd>
<dt>imslp</dt><dd><p>URL of the work’s Wiki page, e.g.
<a class="reference external" href="https://imslp.org/wiki/Piano_Sonata_No.1_in_C_major%2C_K.279/189d_%28Mozart%2C_Wolfgang_Amadeus%29">https://imslp.org/wiki/Piano_Sonata_No.1_in_C_major%2C_K.279/189d_%28Mozart%2C_Wolfgang_Amadeus%29</a></p>
</dd>
<dt>pdf</dt><dd><p>We use this field, if applicable and available, to store the permanent link to the source PDF which the
digital score is supposed to represent. Most often this will be an IMSLP “permlink” pointing to a particular
edition through its ID, such as <a class="reference external" href="https://imslp.org/wiki/Special:ReverseLookup/1689">https://imslp.org/wiki/Special:ReverseLookup/1689</a> (the corresponding PDF file
name starts with <code class="docutils literal notranslate"><span class="pre">IMSLP01689</span></code>). Such a permlink is available via the edition’s menu, by clicking on
<code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">permlink</span></code>.</p>
</dd>
<dt>P&lt;number&gt; (&lt;description&gt;)</dt><dd><p>Columns with a Wikidata “P-number” are used for storing a reconciliation with the Wikidata knowledge graph. For
example, the column <code class="docutils literal notranslate"><span class="pre">P86</span> <span class="pre">(composer)</span></code> contains both the ID of the
<a class="reference external" href="https://www.wikidata.org/wiki/Property:P86">property ‘composer’</a> and in parenthesis the English label of the
property. The values of the column are the “Q-numbers” of the composer item. For more information, refer to
<a class="reference internal" href="#reconciling"><span class="std std-ref">Reconciling metadata with Wikidata</span></a> below.</p>
</dd>
</dl>
</section>
<section id="contributors-and-annotations">
<h3><a class="toc-backref" href="#id19">Contributors and annotations</a><a class="headerlink" href="#contributors-and-annotations" title="Permalink to this heading">¶</a></h3>
<p>Custom fields to give credit to contributors and to keep track of versions of annotation standards and the likes.
The preferred identifiers for persons are ORCIDs such as <code class="docutils literal notranslate"><span class="pre">0000-0002-1986-9545</span></code> or given as URL, such as
<a class="reference external" href="https://orcid.org/0000-0002-1986-9545">https://orcid.org/0000-0002-1986-9545</a>.</p>
<dl class="simple">
<dt>typesetter</dt><dd><p>Name/identifier/homepage of the person(s) or company who engraved the digital edition or major parts of it.</p>
</dd>
<dt>score_integrity</dt><dd><p>Name/identifier/homepage of the person(s) or company who reviewed and corrected the score to make it
match the reference edition/manuscript (potentially referenced under <code class="docutils literal notranslate"><span class="pre">pdf</span></code>).</p>
</dd>
<dt>annotators</dt><dd><p>Name/identifier of each person who contributed new labels. If the file contains several types/versions/iterations,
specify in parenthesis who did what.</p>
</dd>
<dt>reviewers</dt><dd><p>Name/identifier of each person who reviewed annotation labels, potentially modifying them.
If a review pertained only to a particular type/version/iteration, specify in parenthesis which one.</p>
</dd>
<dt>harmony_version</dt><dd><p>Version of the DCML harmony annotation standard used, e.g. <code class="docutils literal notranslate"><span class="pre">2.3.0</span></code>.</p>
</dd>
</dl>
</section>
<section id="reconciling-metadata-with-wikidata">
<span id="reconciling"></span><h3><a class="toc-backref" href="#id20">Reconciling metadata with Wikidata</a><a class="headerlink" href="#reconciling-metadata-with-wikidata" title="Permalink to this heading">¶</a></h3>
<p>Wikidata is a knowledge graph in which</p>
<ul class="simple">
<li><p>each node (a noun considered as subject or object of a relation) is identified by a “Q-number” such as <code class="docutils literal notranslate"><span class="pre">Q636399</span></code>
(<a class="reference external" href="https://www.wikidata.org/wiki/Q636399">the song “Smoke on the Water”</a>),</p></li>
<li><p>each edge (a verb or property) by a “P-number” such as <code class="docutils literal notranslate"><span class="pre">P921</span></code>
(<a class="reference external" href="https://www.wikidata.org/wiki/Property:P921">the property “main subject”</a>, in this example pointing to the node
<a class="reference external" href="https://www.wikidata.org/wiki/Q81085137">Q81085137</a>).</p></li>
</ul>
<p>Reconciling metadata with Wikidata means linking values to nodes in the graph by assigning the relevant Q-numbers,
which can be comfortably achieved with the software <code class="docutils literal notranslate"><span class="pre">OpenRefine</span> <span class="pre">&lt;https://openrefine.org/&gt;</span></code>. As an example,
we take the insufficiently populated <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> from the Annotated Beethoven Corpus version 2.1
(<a class="reference external" href="https://raw.githubusercontent.com/DCMLab/ABC/v2.1/metadata.tsv">link</a>).</p>
<section id="creating-a-new-openrefine-project">
<h4><a class="toc-backref" href="#id21">Creating a new OpenRefine project</a><a class="headerlink" href="#creating-a-new-openrefine-project" title="Permalink to this heading">¶</a></h4>
<p>The goal is to reconcile the composer and his 16 string quartets with Wikidata. As a first step, we need to make sure
that our metadata table contains values that OpenRefine can reconcile with Wikidata’s node labels. Here, we can
use the file names and some regular expression magic to fill the columns:</p>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="../_images/abc_metadata.png"><img alt="ABC metadata.tsv with populated columns." src="../_images/abc_metadata.png" style="width: 825.6px; height: 387.20000000000005px;" /></a>
<figcaption>
<p><span class="caption-text">ABC metadata.tsv with populated <code class="docutils literal notranslate"><span class="pre">composer</span></code>, <code class="docutils literal notranslate"><span class="pre">workTitle</span></code>, <code class="docutils literal notranslate"><span class="pre">movementNumber</span></code>, and <code class="docutils literal notranslate"><span class="pre">workNumber</span></code> columns.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Next, we load the file into OpenRefine, click on <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">»</span></code>, check the preview, adapt the setting for loading the
TSV file if needed (usually it isn’t), name the project and click on <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">project</span> <span class="pre">»</span></code>.</p>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="../_images/openrefine_project.png"><img alt="Creating a project by loading the metadata.tsv file into OpenRefine." src="../_images/openrefine_project.png" style="width: 484.0px; height: 274.40000000000003px;" /></a>
<figcaption>
<p><span class="caption-text">Creating a project by loading the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file into OpenRefine.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="reconciling-a-column">
<h4><a class="toc-backref" href="#id22">Reconciling a column</a><a class="headerlink" href="#reconciling-a-column" title="Permalink to this heading">¶</a></h4>
<p>Now we can start reconciling the values of a column by opening it’s menu <code class="docutils literal notranslate"><span class="pre">Reconcile</span> <span class="pre">-&gt;</span> <span class="pre">Start</span> <span class="pre">reconciling...</span></code>.</p>
<figure class="align-default" id="id4">
<a class="reference internal image-reference" href="../_images/openrefine_start.png"><img alt="Opening the reconciliation pane in OpenRefine." src="../_images/openrefine_start.png" style="width: 372.8px; height: 372.0px;" /></a>
<figcaption>
<p><span class="caption-text">Opening the reconciliation pane in OpenRefine.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The upcoming pane has a list of services on the left side that should include at least <code class="docutils literal notranslate"><span class="pre">Wikidata</span> <span class="pre">(en)</span></code>, which is
what we click on. OpenRefine tries to guess the item type that the values could be matched with and correctly suggests
<code class="docutils literal notranslate"><span class="pre">Q5</span> <span class="pre">(human)</span></code>. Since the correct type Q5 is already selected we can go ahead with <code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">reconciling...</span></code>. Once
the process is complete, a new facet appears on the left side that lets us view the different types of match results.
In this example, all 70 movements have type <code class="docutils literal notranslate"><span class="pre">none</span></code> and we need to pick the correct item that corresponds to the
composer in question.</p>
<figure class="align-default" id="id5">
<a class="reference internal image-reference" href="../_images/openrefine_match.png"><img alt="Selecting the corresponding Wikidata item." src="../_images/openrefine_match.png" style="width: 779.8px; height: 236.6px;" /></a>
<figcaption>
<p><span class="caption-text">Selecting the corresponding Wikidata item to automatically assign it to all cells.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Sometimes, OpenRefine does not suggest any item. In this case, supposing an item does indeed exist, we can go to
the column’s menu <code class="docutils literal notranslate"><span class="pre">Reconcile</span> <span class="pre">-&gt;</span> <span class="pre">Actions</span> <span class="pre">-&gt;</span> <span class="pre">Match</span> <span class="pre">all</span> <span class="pre">filtered</span> <span class="pre">cells</span> <span class="pre">to...</span></code> and manually search for the item.</p>
<p>Once everything has been correctly matched, we can automatically create a new column to store the Q-numbers.
This is as easy as accessing the column menu <code class="docutils literal notranslate"><span class="pre">Reconcile</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">entity</span> <span class="pre">identifiers</span> <span class="pre">column...</span></code>. When asked for the
new column name, we use the
<a class="reference external" href="https://www.wikidata.org/wiki/Help:QuickStatements#CSV_file_syntax">QuickStatements CSV logic</a> which boils down to
thinking of each row as the subject of a <code class="docutils literal notranslate"><span class="pre">(subject,</span> <span class="pre">verb,</span> <span class="pre">object)</span></code> triple, and storing <code class="docutils literal notranslate"><span class="pre">object</span></code> Q-numbers in
<code class="docutils literal notranslate"><span class="pre">verb</span></code> columns. In this example, we are storing Q-numbers that correspond to the pieces
<a class="reference external" href="https://www.wikidata.org/wiki/Property:P86">‘composer’ property</a> and therefore we name the new column
<code class="docutils literal notranslate"><span class="pre">P86</span> <span class="pre">(composer)</span></code>:</p>
<figure class="align-default" id="id6">
<a class="reference internal image-reference" href="../_images/openrefine_composer_ids.png"><img alt="Metadata table with the newly created column &quot;P86 (composer)&quot; pointing to the matched Q-number(s)." src="../_images/openrefine_composer_ids.png" style="width: 198.79999999999998px; height: 265.3px;" /></a>
<figcaption>
<p><span class="caption-text">Metadata table with the newly created column <code class="docutils literal notranslate"><span class="pre">P86</span> <span class="pre">(composer)</span></code> pointing to the matched Q-number(s).</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The result can now easily written back to the original file using the menu <code class="docutils literal notranslate"><span class="pre">Export</span> <span class="pre">-&gt;</span> <span class="pre">Tab-separated</span> <span class="pre">value</span></code> in order
to then insert the new values into the MuseScore files. Please make sure to check the diff of the updated
<code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> before committing to prevent committing unwanted changes or, even worse, having them written
into the scores.</p>
</section>
<section id="pulling-additional-information">
<h4><a class="toc-backref" href="#id23">Pulling additional information</a><a class="headerlink" href="#pulling-additional-information" title="Permalink to this heading">¶</a></h4>
<p>Obviously, with all cells having the same composer value we would have obtained this result faster manually. But using
OpenRefine gives us the advantage that, from here on, we can pull additional information on the composer item
from the Wikidata knowledge graph. For that we simply access the matched composer column’s menu
<code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">column</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">columns</span> <span class="pre">from</span> <span class="pre">reconciled</span> <span class="pre">values</span></code> which will lead us to a list of properties that we can simply
click on to create additional columns. For example, we can easily add columns called
“country of citizenship”, “native language”, “place of birth”, “place of death” and “religion or worldview”.
In this example, we have created the additional column <code class="docutils literal notranslate"><span class="pre">P27</span> <span class="pre">(country</span> <span class="pre">of</span> <span class="pre">citizenship)</span></code> which would allow other people
to access the reconciled item and pull additional information such as geographic coordinates.</p>
<figure class="align-default" id="id7">
<a class="reference internal image-reference" href="../_images/openrefine_pull.png"><img alt="Additional columns pulled from the Wikidata knowledge graph based on the reconciled composer items." src="../_images/openrefine_pull.png" style="width: 621.5999999999999px; height: 304.5px;" /></a>
<figcaption>
<p><span class="caption-text">Additional columns pulled from the Wikidata knowledge graph based on the reconciled composer items.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Now that the composer column is reconciled we can see if the works in question already have IDs on Wikidata.
We repeat the steps above for the column <code class="docutils literal notranslate"><span class="pre">workTitle</span></code> but with the difference that this time we can help
OpenRefine with lookup by constraining the items based on the previous work.</p>
<figure class="align-default" id="id8">
<a class="reference internal image-reference" href="../_images/openrefine_constrain.png"><img alt="Matching the workTitle column constraint by the reconciled composer column." src="../_images/openrefine_constrain.png" style="width: 604.0999999999999px; height: 163.1px;" /></a>
<figcaption>
<p><span class="caption-text">Matching the workTitle column constraint by the reconciled composer column.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section id="creating-a-repository-with-unannotated-musescore-files">
<span id="score-repo"></span><h2><a class="toc-backref" href="#id24">Creating a repository with unannotated MuseScore files</a><a class="headerlink" href="#creating-a-repository-with-unannotated-musescore-files" title="Permalink to this heading">¶</a></h2>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>After we start the annotation workflow, no MuseScore files should be added. removed, or renamed! The edition
needs to be complete and the file names final.</p>
</div>
<p>Before starting annotating a corpus, a repo with the standard folder structure needs to be created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── MS3
└── pdf
</pre></div>
</div>
<p>The directory <code class="docutils literal notranslate"><span class="pre">MS3</span></code> contains the unannotated MuseScore files and <code class="docutils literal notranslate"><span class="pre">PDF</span></code> the print edition or manuscript which they
encode. In order to activate the annotation workflow (i.e. the automatic scripts triggered on the GitHub servers
by certain events related to annotation and review), the folder <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code> needs to be copied from
the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a>. It also contains our
standard <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file which prevents temporary files from being tracked and uploaded.</p>
<section id="variant-1-using-the-template-repository">
<h3><a class="toc-backref" href="#id25">Variant 1: Using the template repository</a><a class="headerlink" href="#variant-1-using-the-template-repository" title="Permalink to this heading">¶</a></h3>
<p>You can create the new repo directly from the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a>
by heading there and clicking on ‘Use this template’. In this variant, every push to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch results
in metadata, measures and notes being extracted from all changed <code class="docutils literal notranslate"><span class="pre">.mscx</span></code> files. Note that renaming and deleting
files will lead to undesired effects that will have to be checked and corrected manually.</p>
</section>
<section id="variant-2-starting-from-scratch">
<h3><a class="toc-backref" href="#id26">Variant 2: Starting from scratch</a><a class="headerlink" href="#variant-2-starting-from-scratch" title="Permalink to this heading">¶</a></h3>
<p>Or you simply create the new repo with the above-mentioned folder structure and add the workflow scripts when
the scores are prepared. In this case, you will have to use the <a class="reference external" href="https://pypi.org/project/ms3">Python library ms3</a>
to extract metadata, notes, and measures manually.</p>
</section>
<section id="variant-3-splitting-an-existing-repository">
<h3><a class="toc-backref" href="#id27">Variant 3: Splitting an existing repository</a><a class="headerlink" href="#variant-3-splitting-an-existing-repository" title="Permalink to this heading">¶</a></h3>
<p>This is for the special case that the MuseScore files in question are already sitting in a subfolder of an existing
repository which is to be transferred into the new repo including the files’ Git histories. This variant is a bit
more involved and requires prior installation of the <a class="reference external" href="https://github.com/newren/git-filter-repo">git filter-repo</a>
command which is recommended by the Git developers for replacing <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">filter-branch</span></code>.</p>
<dl>
<dt>Setting</dt><dd><p>As an example, we will create a new repository <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> (Repo B) which will include all files situated in the
existing repository <code class="docutils literal notranslate"><span class="pre">corpora</span></code> (Repo A) in the subfolder <code class="docutils literal notranslate"><span class="pre">annotations/Chopin-Mazurkas</span></code>, with the workflow scripts
added on top.</p>
</dd>
<dt>Create the new repo B</dt><dd><p>On GitHub, we use the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a> to create
the target repo <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> with the workflow files and the standard <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>. Locally, we initialize
an empty Git repo that will be connected upstream at a later point:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">chopin_mazurkas</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">chopin_mazurkas</span> <span class="o">&amp;&amp;</span> <span class="n">git</span> <span class="n">init</span>
</pre></div>
</div>
<p>Make sure that your Git is configured to use the name <code class="docutils literal notranslate"><span class="pre">main</span></code> for the default branch, which can be achieved using
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">--global</span> <span class="pre">init.defaultBranch</span> <span class="pre">main</span></code>.</p>
</dd>
<dt>Clone repo A and transfer files</dt><dd><p>We start off with a fresh clone of <code class="docutils literal notranslate"><span class="pre">corpora</span></code>, head into it and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="nb">filter</span><span class="o">-</span><span class="n">repo</span> <span class="o">--</span><span class="n">subdirectory</span><span class="o">-</span><span class="nb">filter</span> <span class="n">annotations</span><span class="o">/</span><span class="n">Chopin</span><span class="o">-</span><span class="n">Mazurkas</span><span class="o">/</span> <span class="o">--</span><span class="n">target</span> <span class="o">../</span><span class="n">chopin_mazurkas</span>
</pre></div>
</div>
<p>which will copy all files from <code class="docutils literal notranslate"><span class="pre">annotations/Chopin-Mazurkas/</span></code> to the freshly initialized repo
<code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> together with their full commit histories. If there is a README file, rename it to <code class="docutils literal notranslate"><span class="pre">README.md</span></code>.</p>
</dd>
<dt>Connect local repo B to the remote repo B</dt><dd><p>The local <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> now contains the files at the top level together with the full commit
history (check out <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code>). Now we can connect it to the remote and merge the workflow scripts from there:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">origin</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">DCMLab</span><span class="o">/</span><span class="n">chopin_mazurkas</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">pull</span> <span class="n">origin</span> <span class="n">main</span> <span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">unrelated</span><span class="o">-</span><span class="n">histories</span>
<span class="n">git</span> <span class="n">push</span> <span class="o">-</span><span class="n">u</span> <span class="n">origin</span> <span class="n">main</span>
</pre></div>
</div>
</dd>
<dt>Clean metadata</dt><dd><p>In case there was an older <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> it should now be automatically updated and you might have to clean it.
This may involve naming the first two columns <code class="docutils literal notranslate"><span class="pre">rel_paths</span></code> and <code class="docutils literal notranslate"><span class="pre">fnames</span></code>. For the Mazurka example,
<a class="reference external" href="https://github.com/DCMLab/chopin_mazurkas/pull/1">this Pull Request</a> shows the metadata cleaning and update
of the existing files from an older MuseScore and annotation standard.</p>
</dd>
</dl>
</section>
</section>
<section id="configuring-and-adding-the-new-repo">
<h2><a class="toc-backref" href="#id28">Configuring and adding the new repo</a><a class="headerlink" href="#configuring-and-adding-the-new-repo" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>Set the standard repo settings on GitHub:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/pr_settings.png"><img alt="Repository settings on GitHub" src="../_images/pr_settings.png" style="width: 395.0px; height: 239.0px;" /></a>
</figure>
</li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Branches</span></code>, create a branch protection rule for the main branch:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/branch_protection.png"><img alt="Protecting the main branch on GitHub" src="../_images/branch_protection.png" style="width: 392.0px; height: 250.0px;" /></a>
</figure>
</li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Collaborators</span> <span class="pre">and</span> <span class="pre">teams</span></code> give write access to the <code class="docutils literal notranslate"><span class="pre">annotators</span></code> team.</p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Pages</span></code> set the Source to the root <code class="docutils literal notranslate"><span class="pre">/</span></code> of the branch <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> (which should have been
automatically created by the workflow when pushing the first MuseScore files). Add the page’s URL as the
repo’s website.</p></li>
<li><p>Add the new repo to the corresponding meta-repositories (at least to <code class="docutils literal notranslate"><span class="pre">all_subcorpora</span></code>, see below).</p></li>
<li><p>Add the new repo to the annotation workflow (drop-down menus, OpenProject, WebHooks etc.)</p></li>
</ul>
<section id="adding-the-repo-to-one-or-several-meta-repos">
<span id="metarepos"></span><h3><a class="toc-backref" href="#id29">Adding the repo to one or several meta-repos</a><a class="headerlink" href="#adding-the-repo-to-one-or-several-meta-repos" title="Permalink to this heading">¶</a></h3>
<p>The individual subcorpora can be embedded as submodules in meta-repositories. These meta-repos are listed in the private
<a class="reference external" href="https://github.com/DCMLab/meta_repositories">meta_repositories</a> repo. Currently, the most important ones are:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/DCMLab/dcml_corpora">dcml_corpora</a> for published corpora</p></li>
<li><p><a class="reference external" href="https://github.com/DCMLab/all_subcorpora">all_subcorpora</a> (private) for all published and unpublished corpora.</p></li>
</ol>
<p>To add the new repo, head into the meta-repo and do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">submodule</span> <span class="n">add</span> <span class="o">-</span><span class="n">b</span> <span class="n">main</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">DCMLab</span><span class="o">/</span><span class="n">chopin_mazurkas</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Just to be sure, update all submodules: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--remote</span></code> and push the whole thing.</p>
</section>
<section id="creating-work-packages-on-openproject">
<h3><a class="toc-backref" href="#id30">Creating work packages on OpenProject</a><a class="headerlink" href="#creating-work-packages-on-openproject" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Follow the instructions for <cite>create_work_packages.py</cite> under <a class="reference external" href="https://github.com/DCMLab/openproject_scripts/">https://github.com/DCMLab/openproject_scripts/</a></p>
<ul class="simple">
<li><p>set the column <code class="docutils literal notranslate"><span class="pre">parent</span></code> to the name of the repository</p></li>
<li><p>rename the columns <code class="docutils literal notranslate"><span class="pre">fnames</span> <span class="pre">=&gt;</span> <span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">last_mn</span> <span class="pre">=&gt;</span> <span class="pre">measures</span></code></p></li>
<li><p>if the new work packages are for annotation upgrades rather than new annotations, add the column <code class="docutils literal notranslate"><span class="pre">work_package_type</span></code>
with value <code class="docutils literal notranslate"><span class="pre">Annotation</span> <span class="pre">Upgrade</span></code></p></li>
<li><p>find out the status of all pieces and fill the column <code class="docutils literal notranslate"><span class="pre">status</span></code>. Accordingly:</p></li>
<li><p>if annotations are present and need to be updated, rename <code class="docutils literal notranslate"><span class="pre">annotators</span> <span class="pre">=&gt;</span> <span class="pre">reviewer</span></code> and make sure that every cell contains exactly one
user name (<code class="docutils literal notranslate"><span class="pre">First</span> <span class="pre">Last</span></code>) known to OpenProject;</p></li>
<li><p>if review is done or ongoing, do the same for the renamed column <code class="docutils literal notranslate"><span class="pre">reviewers</span> <span class="pre">=&gt;</span> <span class="pre">reviewer</span></code></p></li>
<li><p>if annotations are present and finalized, the work package, in theory, does not need to be created; if it is,
it should have status “Not available”. Filling the fields <code class="docutils literal notranslate"><span class="pre">assignee</span></code> and <code class="docutils literal notranslate"><span class="pre">reviewer</span></code>, is not needed unless for invoicing purposes</p></li>
</ul>
</li>
<li><p>Create a new view in OpenProject:</p>
<ul class="simple">
<li><p>open any of the existing corpora views</p></li>
<li><p>replace the <code class="docutils literal notranslate"><span class="pre">Parent</span></code> filter with the repo name</p></li>
<li><p>in the menu, select <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">as...</span></code></p></li>
<li><p>enter the repo name and check <code class="docutils literal notranslate"><span class="pre">Public</span></code></p></li>
</ul>
</li>
<li><p>Add the webhook to the repo</p>
<ul class="simple">
<li><p>go to a repo for which the webhook is already set up</p></li>
<li><p>in the repo settings, go to <code class="docutils literal notranslate"><span class="pre">Webhooks</span></code>, click <code class="docutils literal notranslate"><span class="pre">Edit</span></code>, and copy the <code class="docutils literal notranslate"><span class="pre">Payload</span> <span class="pre">URL</span></code></p></li>
<li><p>in the new repo, go to <code class="docutils literal notranslate"><span class="pre">Settings</span> <span class="pre">-&gt;</span> <span class="pre">Webhooks</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">webhook</span></code> and insert the copied <code class="docutils literal notranslate"><span class="pre">Payload</span> <span class="pre">URL</span></code></p></li>
<li><p>set the <code class="docutils literal notranslate"><span class="pre">Content</span> <span class="pre">type</span></code> to “application/json”</p></li>
<li><p>Below, select “Send me <strong>everything</strong>” and click <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">webhook</span></code></p></li>
</ul>
</li>
<li><p>Add the new work packages to the master sheet for the administrative staff</p></li>
</ol>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, École Polytechnique Fédérale de Lausanne.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>