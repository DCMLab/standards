<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>DCML Corpus Creation Pipeline &#8212; Harmonic Annotation Guidelines 2.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script>let toggleHintShow = 'Show answer';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Annotation Reference" href="../reference/reference.html" />
    <link rel="prev" title="Quick Git Reference" href="../git/git.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          DCML Guidelines</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Other pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../onboarding.html">Becoming a DCML annotator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#working-as-an-annotator">Working as an annotator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../onboarding.html#how-to-get-involved">How to get involved</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../workflow/workflow.html">DCML annotation workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#short-summary">Short summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#annotating">Annotating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#upgrading-annotations">Upgrading annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#reviewing-a-set-of-annotations">Reviewing a set of annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#reacting-to-a-review-reaching-expert-consensus">Reacting to a review &amp; reaching expert consensus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/workflow.html#what-to-do-about-the-warnings">What to do about the warnings?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../openproject/openproject.html">Work package management with OpenProject</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#user-interface">User Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#work-packages-wps">Work Packages (WPs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#taking-on-an-assignment">Taking on an assignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#logging-unit-costs">Logging unit costs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openproject/openproject.html#writing-invoices">Writing invoices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Annotation Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/musescore.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/first_label.html">The first label</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/first_phrase.html">The first phrase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/detail.html">Level of detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/localkey.html">Changing the local key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/counterpoint.html">Contrapuntal patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/features.html">Some more features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../git/git.html">Quick Git Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#installing-git">Installing Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#configuring-git">Configuring Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#cloning-a-repository-from-github">Cloning a Repository from GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#selecting-the-right-branch">Selecting the right Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#applying-changes-to-the-repository">Applying Changes to the Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#uploading-changes-to-github">Uploading Changes to GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#applying-changes-to-the-origin-directly">Applying Changes to the Origin Directly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#installing-github-desktop">Installing GitHub Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#first-start">First start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#cloning-a-repository">Cloning a repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git/git.html#the-user-interface">The user interface</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DCML Corpus Creation Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">Collect and prepare the digital edition in the latest MuseScore format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files">Creating a repository with unannotated MuseScore files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-and-adding-the-new-repo">Configuring and adding the new repo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Annotation Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#the-syntax">The syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html#the-remainder-of-the-reference-is-currently-under-reconstruction">The remainder of the Reference is currently under reconstruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/examples.html">Questions &amp; Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#modulation-and-secondary-keys">Modulation and Secondary Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#phrase-structure">Phrase Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html#figured-bass">Figured Bass</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/specs.html">Technical Specifications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#what-is-being-encoded">What is being encoded?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#the-regex-regular-expression">The regEx (Regular Expression)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#feature-processing">Feature Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/specs.html#missing-features">Missing Features</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">This Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">DCML Corpus Creation Pipeline</a><ul>
<li><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">Collect and prepare the digital edition in the latest MuseScore format</a><ul>
<li><a class="reference internal" href="#prior-research">Prior research</a></li>
<li><a class="reference internal" href="#look-up-and-check-existing-scores">Look up and check existing scores</a></li>
<li><a class="reference internal" href="#typeset-non-existent-files">Typeset non-existent files</a></li>
<li><a class="reference internal" href="#file-curation">File curation</a></li>
<li><a class="reference internal" href="#create-metadata">Create metadata</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files">Creating a repository with unannotated MuseScore files</a><ul>
<li><a class="reference internal" href="#variant-1-using-the-template-repository">Variant 1: Using the template repository</a></li>
<li><a class="reference internal" href="#variant-2-starting-from-scratch">Variant 2: Starting from scratch</a></li>
<li><a class="reference internal" href="#variant-3-splitting-an-existing-repository">Variant 3: Splitting an existing repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-and-adding-the-new-repo">Configuring and adding the new repo</a><ul>
<li><a class="reference internal" href="#adding-the-repo-to-one-or-several-meta-repos">Adding the repo to one or several meta-repos</a></li>
<li><a class="reference internal" href="#creating-work-packages-on-openproject">Creating work packages on OpenProject</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../git/git.html" title="Previous Chapter: Quick Git Reference"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Quick Git Reference</span>
    </a>
  </li>
  <li>
    <a href="../reference/reference.html" title="Next Chapter: Annotation Reference"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Annotation Reference &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/pipeline/pipeline.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="dcml-corpus-creation-pipeline">
<h1>DCML Corpus Creation Pipeline<a class="headerlink" href="#dcml-corpus-creation-pipeline" title="Permalink to this heading">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format" id="id1">Collect and prepare the digital edition in the latest MuseScore format</a></p>
<ul>
<li><p><a class="reference internal" href="#prior-research" id="id2">Prior research</a></p></li>
<li><p><a class="reference internal" href="#look-up-and-check-existing-scores" id="id3">Look up and check existing scores</a></p></li>
<li><p><a class="reference internal" href="#typeset-non-existent-files" id="id4">Typeset non-existent files</a></p></li>
<li><p><a class="reference internal" href="#file-curation" id="id5">File curation</a></p></li>
<li><p><a class="reference internal" href="#create-metadata" id="id6">Create metadata</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-a-repository-with-unannotated-musescore-files" id="id7">Creating a repository with unannotated MuseScore files</a></p>
<ul>
<li><p><a class="reference internal" href="#variant-1-using-the-template-repository" id="id8">Variant 1: Using the template repository</a></p></li>
<li><p><a class="reference internal" href="#variant-2-starting-from-scratch" id="id9">Variant 2: Starting from scratch</a></p></li>
<li><p><a class="reference internal" href="#variant-3-splitting-an-existing-repository" id="id10">Variant 3: Splitting an existing repository</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-and-adding-the-new-repo" id="id11">Configuring and adding the new repo</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-the-repo-to-one-or-several-meta-repos" id="id12">Adding the repo to one or several meta-repos</a></p></li>
<li><p><a class="reference internal" href="#creating-work-packages-on-openproject" id="id13">Creating work packages on OpenProject</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="collect-and-prepare-the-digital-edition-in-the-latest-musescore-format">
<span id="get-scores"></span><h2><a class="toc-backref" href="#id1">Collect and prepare the digital edition in the latest MuseScore format</a><a class="headerlink" href="#collect-and-prepare-the-digital-edition-in-the-latest-musescore-format" title="Permalink to this heading">¶</a></h2>
<section id="prior-research">
<h3><a class="toc-backref" href="#id2">Prior research</a><a class="headerlink" href="#prior-research" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Check which pieces make up the collection</p></li>
<li><p>how they are grouped</p></li>
<li><p>what naming or numbering conventions exist</p></li>
<li><p>which editions there are</p></li>
<li><p>if different versions of the pieces exist.</p></li>
<li><p>Come up with a list (and hierarchy) of names. Here, you can already think of a good naming/numbering convention for the corpus.</p></li>
<li><p>It might be good to create the list of the overarching group of works even if your corpus will contain only parts of it, for the sake of a better overview.</p></li>
<li><p>Example: Going from the <a class="reference external" href="http://www3.cpdl.org/wiki/index.php/Claudio_Monteverdi">list of Monteverdi’s Madrigal books</a>
to an <a class="reference external" href="https://github.com/DCMLab/monteverdi_madrigals/">initial README file</a>.</p></li>
</ul>
</section>
<section id="look-up-and-check-existing-scores">
<h3><a class="toc-backref" href="#id3">Look up and check existing scores</a><a class="headerlink" href="#look-up-and-check-existing-scores" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>All scores available need to be checked and compared:</dt><dd><ul>
<li><p>reference edition</p></li>
<li><p>completeness</p></li>
<li><p>quality &amp; errors</p></li>
<li><p>license (later publication!)</p></li>
<li><p>file format and expected conversion losses</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Where to check</dt><dd><ul>
<li><p>First: musescore.com because the scores are in the target format</p></li>
<li><p>musicalion.com (not free to publish: need to ask first)</p></li>
<li><p>choral music: CPDL</p></li>
<li><p><a class="reference external" href="http://kern.ccarh.org/">http://kern.ccarh.org/</a> lossless humdrum 2 musescore conversion needed</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="typeset-non-existent-files">
<h3><a class="toc-backref" href="#id4">Typeset non-existent files</a><a class="headerlink" href="#typeset-non-existent-files" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>pick reference edition and send commission to transcriber</p></li>
<li><p>depending on the music, prices may vary between 5 and 20 CHF per page</p></li>
</ul>
</section>
<section id="file-curation">
<h3><a class="toc-backref" href="#id5">File curation</a><a class="headerlink" href="#file-curation" title="Permalink to this heading">¶</a></h3>
<p>The scores need to be corrected on the basis of a reference edition/manuscript.
We have a collaborative document with detailed
<a class="reference external" href="https://docs.google.com/document/d/1Q2svEUSsE7OCetik8An__gsEwQCYNfFJlHFMF9dRce4/edit#heading=h.8hrcm7m3udll">Score correction guidelines</a>.
It also stipulates which information from the reference edition/manuscript needs to be encoded in what way.
Please send a request to be added to the document.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Convert to MuseScore format</dt><dd><ul>
<li><p>XML, CAP: can be done with MuseScore’s batch converter plugin or with <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">convert</span></code></p></li>
<li><p>CAPX: Conversion to CAP or XML with DCML’s Capella license</p></li>
<li><p>MUSX: Conversion to XML with private Finale copy</p></li>
<li><p>SIB: Conversion to XML with Sibelius on DCML’s iMac</p></li>
<li><p>LY: no good conversion available</p></li>
<li><p>KRN: hum2xml can be used but it would be preferable to have our own converter to MuseScore</p></li>
<li><p>results need to be checked; especially markup such as slurs, arpeggios, trills etc. often get screwed</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Renaming</dt><dd><ul>
<li><p>Decide on naming convention and create a map (without extensions) from old to new filenames</p></li>
<li><dl class="simple">
<dt>Sometimes, files need to be split at that point because they contain several movements</dt><dd><ul>
<li><p>For this, you introduce section breaks separating the movements</p></li>
<li><p>After every section break, you have to re-insert the time and key signature or add it into the split file</p></li>
<li><p>Start with the last movement, select it and do <cite>File -&gt; Save Selection</cite></p></li>
<li><p>Repeat for all movements</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Rename the files</p></li>
<li><p>Possibly add a small script that automatically renames the source files</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Use parser/checking tool and/or manual checks for consistency</dt><dd><ul>
<li><dl class="simple">
<dt>certain bars need to be excluded from the bar count:</dt><dd><ul>
<li><p>anacrusis</p></li>
<li><p>pickup measures throughout the piece</p></li>
<li><p>second voltas (i.e. second repeats)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>irregular measure lengths need to complete each other</dt><dd><ul>
<li><p>e.g. when a repeated section starts with a pickup measure, the last measure of the repeated section needs to be shorter</p></li>
<li><p>anacrusis is substracted from the last bar</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>if in the reference edition the bar count restarts in the middle of the piece (e.g. in some variation movements), you can</dt><dd><ul>
<li><p>either: split the movement into individual files (not preferable if you want to keep the movement as one coherent unit)</p></li>
<li><p>or: have two versions, one working version with continuous (unambiguous) measure numbers that depart from the reference edition, and one that is provided separately, that has the original (ambiguous) measure numbering but is not used for computational purposes. The reset of the counter should not be done via “add to measure count” using a negative number, but rather via section breaks.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="create-metadata">
<h3><a class="toc-backref" href="#id6">Create metadata</a><a class="headerlink" href="#create-metadata" title="Permalink to this heading">¶</a></h3>
<p>All metadata fields are automatically extracted (by our workflow script that use <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">extract</span> <span class="pre">-D</span></code>) and represented
in the <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> file. To conveniently populate the metadata fields in the MSCX files, you can also create
the corresponding columns in the existing <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> files and use <code class="docutils literal notranslate"><span class="pre">ms3</span> <span class="pre">metadata</span></code> to update the
Musescore files.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Although many editors open TSV files, many of them silently change values, e.g. by removing
<code class="docutils literal notranslate"><span class="pre">.0</span></code> from decimal values (LibreOffice) or turning a <code class="docutils literal notranslate"><span class="pre">4/4</span></code> time signature into a date (Excel,
Numbers). One editor that doesn’t to that is VScode. Make sure to <strong>always</strong> view the diff before
committing changes to <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> to avoid unwanted modifications or, worse, loss of data.</p>
</div>
<p>Populate the following default fields (if applicable):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">composer</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">movementNumer</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">movementTitle</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> (URL of the adapted digital edition)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">workNumber</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">workTitle</span></code></p></li>
</ul>
<p>Add to that the following custom fields (if applicable):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">composed_start</span></code>, <code class="docutils literal notranslate"><span class="pre">composed_end</span></code> (identical values if one exact year is known)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typesetter</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">score_integrity</span></code> (person who made the score match the reference edition/manuscript)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">annotators</span></code> (name, if several annotations or iterations, specify in parenthesis who did what)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reviewers</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">harmony_version</span></code> (version of the DCML harmony annotation standard used)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imslp</span></code> (URL of the work’s Wiki page, e.g. <a class="reference external" href="https://imslp.org/wiki/Piano_Sonata_No.1_in_C_major%2C_K.279/189d_%28Mozart%2C_Wolfgang_Amadeus%29">https://imslp.org/wiki/Piano_Sonata_No.1_in_C_major%2C_K.279/189d_%28Mozart%2C_Wolfgang_Amadeus%29</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">musicbrainz</span></code> (work URI)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">viaf</span></code> (work URI)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wikidata</span></code> (e.g. <a class="reference external" href="http://www.wikidata.org/entity/Q2194957">http://www.wikidata.org/entity/Q2194957</a>)</p></li>
</ul>
</section>
</section>
<section id="creating-a-repository-with-unannotated-musescore-files">
<span id="score-repo"></span><h2><a class="toc-backref" href="#id7">Creating a repository with unannotated MuseScore files</a><a class="headerlink" href="#creating-a-repository-with-unannotated-musescore-files" title="Permalink to this heading">¶</a></h2>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>After we start the annotation workflow, no MuseScore files should be added. removed, or renamed! The edition
needs to be complete and the file names final.</p>
</div>
<p>Before starting annotating a corpus, a repo with the standard folder structure needs to be created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── MS3
└── pdf
</pre></div>
</div>
<p>The directory <code class="docutils literal notranslate"><span class="pre">MS3</span></code> contains the unannotated MuseScore files and <code class="docutils literal notranslate"><span class="pre">PDF</span></code> the print edition or manuscript which they
encode. In order to activate the annotation workflow (i.e. the automatic scripts triggered on the GitHub servers
by certain events related to annotation and review), the folder <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code> needs to be copied from
the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a>. It also contains our
standard <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file which prevents temporary files from being tracked and uploaded.</p>
<section id="variant-1-using-the-template-repository">
<h3><a class="toc-backref" href="#id8">Variant 1: Using the template repository</a><a class="headerlink" href="#variant-1-using-the-template-repository" title="Permalink to this heading">¶</a></h3>
<p>You can create the new repo directly from the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a>
by heading there and clicking on ‘Use this template’. In this variant, every push to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch results
in metadata, measures and notes being extracted from all changed <code class="docutils literal notranslate"><span class="pre">.mscx</span></code> files. Note that renaming and deleting
files will lead to undesired effects that will have to be checked and corrected manually.</p>
</section>
<section id="variant-2-starting-from-scratch">
<h3><a class="toc-backref" href="#id9">Variant 2: Starting from scratch</a><a class="headerlink" href="#variant-2-starting-from-scratch" title="Permalink to this heading">¶</a></h3>
<p>Or you simply create the new repo with the above-mentioned folder structure and add the workflow scripts when
the scores are prepared. In this case, you will have to use the <a class="reference external" href="https://pypi.org/project/ms3">Python library ms3</a>
to extract metadata, notes, and measures manually.</p>
</section>
<section id="variant-3-splitting-an-existing-repository">
<h3><a class="toc-backref" href="#id10">Variant 3: Splitting an existing repository</a><a class="headerlink" href="#variant-3-splitting-an-existing-repository" title="Permalink to this heading">¶</a></h3>
<p>This is for the special case that the MuseScore files in question are already sitting in a subfolder of an existing
repository which is to be transferred into the new repo including the files’ Git histories. This variant is a bit
more involved and requires prior installation of the <a class="reference external" href="https://github.com/newren/git-filter-repo">git filter-repo</a>
command which is recommended by the Git developers for replacing <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">filter-branch</span></code>.</p>
<dl>
<dt>Setting</dt><dd><p>As an example, we will create a new repository <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> (Repo B) which will include all files situated in the
existing repository <code class="docutils literal notranslate"><span class="pre">corpora</span></code> (Repo A) in the subfolder <code class="docutils literal notranslate"><span class="pre">annotations/Chopin-Mazurkas</span></code>, with the workflow scripts
added on top.</p>
</dd>
<dt>Create the new repo B</dt><dd><p>On GitHub, we use the <a class="reference external" href="https://github.com/DCMLab/annotation_workflow_template">template repository</a> to create
the target repo <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> with the workflow files and the standard <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>. Locally, we initialize
an empty Git repo that will be connected upstream at a later point:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">chopin_mazurkas</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">chopin_mazurkas</span> <span class="o">&amp;&amp;</span> <span class="n">git</span> <span class="n">init</span>
</pre></div>
</div>
<p>Make sure that your Git is configured to use the name <code class="docutils literal notranslate"><span class="pre">main</span></code> for the default branch, which can be achieved using
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">--global</span> <span class="pre">init.defaultBranch</span> <span class="pre">main</span></code>.</p>
</dd>
<dt>Clone repo A and transfer files</dt><dd><p>We start off with a fresh clone of <code class="docutils literal notranslate"><span class="pre">corpora</span></code>, head into it and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="nb">filter</span><span class="o">-</span><span class="n">repo</span> <span class="o">--</span><span class="n">subdirectory</span><span class="o">-</span><span class="nb">filter</span> <span class="n">annotations</span><span class="o">/</span><span class="n">Chopin</span><span class="o">-</span><span class="n">Mazurkas</span><span class="o">/</span> <span class="o">--</span><span class="n">target</span> <span class="o">../</span><span class="n">chopin_mazurkas</span>
</pre></div>
</div>
<p>which will copy all files from <code class="docutils literal notranslate"><span class="pre">annotations/Chopin-Mazurkas/</span></code> to the freshly initialized repo
<code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> together with their full commit histories. If there is a README file, rename it to <code class="docutils literal notranslate"><span class="pre">README.md</span></code>.</p>
</dd>
<dt>Connect local repo B to the remote repo B</dt><dd><p>The local <code class="docutils literal notranslate"><span class="pre">chopin_mazurkas</span></code> now contains the files at the top level together with the full commit
history (check out <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code>). Now we can connect it to the remote and merge the workflow scripts from there:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">origin</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">DCMLab</span><span class="o">/</span><span class="n">chopin_mazurkas</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">pull</span> <span class="n">origin</span> <span class="n">main</span> <span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">unrelated</span><span class="o">-</span><span class="n">histories</span>
<span class="n">git</span> <span class="n">push</span> <span class="o">-</span><span class="n">u</span> <span class="n">origin</span> <span class="n">main</span>
</pre></div>
</div>
</dd>
<dt>Clean metadata</dt><dd><p>In case there was an older <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> it should now be automatically updated and you might have to clean it.
This may involve naming the first two columns <code class="docutils literal notranslate"><span class="pre">rel_paths</span></code> and <code class="docutils literal notranslate"><span class="pre">fnames</span></code>. For the Mazurka example,
<a class="reference external" href="https://github.com/DCMLab/chopin_mazurkas/pull/1">this Pull Request</a> shows the metadata cleaning and update
of the existing files from an older MuseScore and annotation standard.</p>
</dd>
</dl>
</section>
</section>
<section id="configuring-and-adding-the-new-repo">
<h2><a class="toc-backref" href="#id11">Configuring and adding the new repo</a><a class="headerlink" href="#configuring-and-adding-the-new-repo" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>Set the standard repo settings on GitHub:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/pr_settings.png"><img alt="Repository settings on GitHub" src="../_images/pr_settings.png" style="width: 395.0px; height: 239.0px;" /></a>
</figure>
</li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Branches</span></code>, create a branch protection rule for the main branch:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/branch_protection.png"><img alt="Protecting the main branch on GitHub" src="../_images/branch_protection.png" style="width: 392.0px; height: 250.0px;" /></a>
</figure>
</li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Collaborators</span> <span class="pre">and</span> <span class="pre">teams</span></code> give write access to the <code class="docutils literal notranslate"><span class="pre">annotators</span></code> team.</p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Pages</span></code> set the Source to the root <code class="docutils literal notranslate"><span class="pre">/</span></code> of the branch <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> (which should have been
automatically created by the workflow when pushing the first MuseScore files). Add the page’s URL as the
repo’s website.</p></li>
<li><p>Add the new repo to the corresponding meta-repositories (at least to <code class="docutils literal notranslate"><span class="pre">all_subcorpora</span></code>, see below).</p></li>
<li><p>Add the new repo to the annotation workflow (drop-down menus, OpenProject, WebHooks etc.)</p></li>
</ul>
<section id="adding-the-repo-to-one-or-several-meta-repos">
<span id="metarepos"></span><h3><a class="toc-backref" href="#id12">Adding the repo to one or several meta-repos</a><a class="headerlink" href="#adding-the-repo-to-one-or-several-meta-repos" title="Permalink to this heading">¶</a></h3>
<p>The individual subcorpora can be embedded as submodules in meta-repositories. These meta-repos are listed in the private
<a class="reference external" href="https://github.com/DCMLab/meta_repositories">meta_repositories</a> repo. Currently, the most important ones are:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/DCMLab/dcml_corpora">dcml_corpora</a> for published corpora</p></li>
<li><p><a class="reference external" href="https://github.com/DCMLab/all_subcorpora">all_subcorpora</a> (private) for all published and unpublished corpora.</p></li>
</ol>
<p>To add the new repo, head into the meta-repo and do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">submodule</span> <span class="n">add</span> <span class="o">-</span><span class="n">b</span> <span class="n">main</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">DCMLab</span><span class="o">/</span><span class="n">chopin_mazurkas</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Just to be sure, update all submodules: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--remote</span></code> and push the whole thing.</p>
</section>
<section id="creating-work-packages-on-openproject">
<h3><a class="toc-backref" href="#id13">Creating work packages on OpenProject</a><a class="headerlink" href="#creating-work-packages-on-openproject" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Follow the instructions for <cite>create_work_packages.py</cite> under <a class="reference external" href="https://github.com/DCMLab/openproject_scripts/">https://github.com/DCMLab/openproject_scripts/</a></p>
<ul class="simple">
<li><p>set the column <code class="docutils literal notranslate"><span class="pre">parent</span></code> to the name of the repository</p></li>
<li><p>rename the columns <code class="docutils literal notranslate"><span class="pre">fnames</span> <span class="pre">=&gt;</span> <span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">last_mn</span> <span class="pre">=&gt;</span> <span class="pre">measures</span></code></p></li>
<li><p>if the new work packages are for annotation upgrades rather than new annotations, add the column <code class="docutils literal notranslate"><span class="pre">work_package_type</span></code>
with value <code class="docutils literal notranslate"><span class="pre">Annotation</span> <span class="pre">Upgrade</span></code></p></li>
<li><p>find out the status of all pieces and fill the column <code class="docutils literal notranslate"><span class="pre">status</span></code>. Accordingly:</p></li>
<li><p>if annotations are present and need to be updated, rename <code class="docutils literal notranslate"><span class="pre">annotators</span> <span class="pre">=&gt;</span> <span class="pre">reviewer</span></code> and make sure that every cell contains exactly one
user name (<code class="docutils literal notranslate"><span class="pre">First</span> <span class="pre">Last</span></code>) known to OpenProject;</p></li>
<li><p>if review is done or ongoing, do the same for the renamed column <code class="docutils literal notranslate"><span class="pre">reviewers</span> <span class="pre">=&gt;</span> <span class="pre">reviewer</span></code></p></li>
<li><p>if annotations are present and finalized, the work package, in theory, does not need to be created; if it is,
it should have status “Not available”. Filling the fields <code class="docutils literal notranslate"><span class="pre">assignee</span></code> and <code class="docutils literal notranslate"><span class="pre">reviewer</span></code>, is not needed unless for invoicing purposes</p></li>
</ul>
</li>
<li><p>Create a new view in OpenProject:</p>
<ul class="simple">
<li><p>open any of the existing corpora views</p></li>
<li><p>replace the <code class="docutils literal notranslate"><span class="pre">Parent</span></code> filter with the repo name</p></li>
<li><p>in the menu, select <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">as...</span></code></p></li>
<li><p>enter the repo name and check <code class="docutils literal notranslate"><span class="pre">Public</span></code></p></li>
</ul>
</li>
<li><p>Add the webhook to the repo</p>
<ul class="simple">
<li><p>go to a repo for which the webhook is already set up</p></li>
<li><p>in the repo settings, go to <code class="docutils literal notranslate"><span class="pre">Webhooks</span></code>, click <code class="docutils literal notranslate"><span class="pre">Edit</span></code>, and copy the <code class="docutils literal notranslate"><span class="pre">Payload</span> <span class="pre">URL</span></code></p></li>
<li><p>in the new repo, go to <code class="docutils literal notranslate"><span class="pre">Settings</span> <span class="pre">-&gt;</span> <span class="pre">Webhooks</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">webhook</span></code> and insert the copied <code class="docutils literal notranslate"><span class="pre">Payload</span> <span class="pre">URL</span></code></p></li>
<li><p>set the <code class="docutils literal notranslate"><span class="pre">Content</span> <span class="pre">type</span></code> to “application/json”</p></li>
<li><p>Below, select “Send me <strong>everything</strong>” and click <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">webhook</span></code></p></li>
</ul>
</li>
<li><p>Add the new work packages to the master sheet for the administrative staff</p></li>
</ol>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, École Polytechnique Fédérale de Lausanne.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>